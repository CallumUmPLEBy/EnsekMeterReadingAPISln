"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5296,6092],{44927:(se,z,o)=>{o.d(z,{E:()=>e,z:()=>p});const p=()=>({type:"query",query:{params:["A","5m","now"]},reducer:{type:"avg",params:[]},evaluator:{type:"gt",params:[null]},operator:{type:"and"}}),e=async(I,N,H,v)=>{if(N.length===0)return"Could not find any metric queries";if(I&&I.length)return"Transformations are not supported in alert queries";let T=0,y=0;for(const E of N){const M=E.datasource||v,D=await H.get(M);D.meta.alerting?D.targetContainsTemplate&&D.targetContainsTemplate(E)&&y++:T++}return T===N.length?"The datasource does not support alerting queries":y===N.length?"Template variables are not supported in alert queries":""}},53051:(se,z,o)=>{o.r(z),o.d(z,{DashboardPage:()=>at,UnthemedDashboardPage:()=>nt,default:()=>zs,mapStateToProps:()=>tn});var p=o(52423),e=o(68404),I=o(36635),N=o(24844),H=o(83383),v=o(68183),T=o(37932),y=o(35645),E=o(72648),M=o(659),D=o(79396),A=o(34177),K=o(60499),Q=o(96694),B=o(86245),R=o(30992),J=o(60265),O=o(81168),U=o(45984),Ee=o(85803),rt=o(92624),Fe=o(39514),_=o(31460),oe=o(77839),Z=o(82897),ie=o(70356),st=o(5191),an=o(97063),le=o(82002),be=o(22350),rn=o(70197),ne=o(35029),ye=o(46967),G=o(39904),x=o(31403),sn=o(86648),on=o(74391),ln=o(2313);const ot=({panel:n,folderUid:t,isUnsavedPrompt:a,onDismiss:r,onConfirm:s,onDiscard:i})=>{const[l,c]=(0,e.useState)(""),d=(0,be.Z)(async()=>{const C=await(0,sn.E8)(n.libraryPanel.uid);return C.length>0?C.map(F=>F.title):[]},[n.libraryPanel.uid]),[m,u]=(0,e.useState)([]);(0,rn.Z)(()=>d.value?u(d.value.filter(C=>C.toLowerCase().includes(l.toLowerCase()))):u([]),300,[d.value,l]);const{saveLibraryPanel:g}=(0,ln.E)(),f=(0,E.wW)(on.J),h=(0,e.useCallback)(()=>{i()},[i]),b=a?"Unsaved library panel changes":"Save library panel";return e.createElement(ne.u,{title:b,icon:"save",onDismiss:r,isOpen:!0},e.createElement("div",null,e.createElement("p",{className:f.textInfo},"This update will affect ",e.createElement("strong",null,n.libraryPanel.meta?.connectedDashboards," ",n.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."),"The following dashboards using the panel will be affected:"),e.createElement(ye.I,{className:f.dashboardSearch,prefix:e.createElement(G.J,{name:"search"}),placeholder:"Search affected dashboards",value:l,onChange:C=>c(C.currentTarget.value)}),d.loading?e.createElement("p",null,"Loading connected dashboards..."):e.createElement("table",{className:f.myTable},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",null,"Dashboard name"))),e.createElement("tbody",null,m.map((C,F)=>e.createElement("tr",{key:`dashrow-${F}`},e.createElement("td",null,C))))),e.createElement(ne.u.ButtonRow,null,e.createElement(x.zx,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),a&&e.createElement(x.zx,{variant:"destructive",onClick:h},"Discard"),e.createElement(x.zx,{onClick:()=>{g(n,t).then(()=>{s()})}},"Update all"))))};var cn=o(82302),ze=o(58379),Pe=o(32294),it=o(46732),Y=o(36281);function dn(n,t){return async a=>{const r=t.initEditPanel(n);a((0,Y.Hl)({panel:r,sourcePanel:n}))}}function lt(){return async(n,t)=>{const{getPanel:a}=t().panelEditor;a().configRev=0,n((0,Y.yi)(!0))}}function un(n,t){return a=>{if(n.libraryPanel?.uid===void 0||!t)return;const r=n.getSaveModel();for(const s of t.panels){if(pn(n,s))continue;s.restoreModel({...r,...(0,Z.pick)(s,"gridPos","id")});const i=s.plugin?.meta.id!==n.plugin?.meta.id;s.plugin=n.plugin,s.configRev++,i&&(s.generateNewKey(),a((0,it.bc)({key:s.key,plugin:s.plugin}))),setTimeout(()=>{s.getQueryRunner().useLastResultFrom(n.getQueryRunner())},20)}n.repeat&&setTimeout(()=>t.processRepeats(),20)}}function pn(n,t){return!!(t.libraryPanel?.uid!==n.libraryPanel.uid||t.id&&t.id===n.id||t.repeatPanelId)}function mn(){return async(n,t)=>{const a=t().dashboard.getModel(),{getPanel:r,getSourcePanel:s,shouldDiscardChanges:i}=t().panelEditor,l=r();if(a&&a.exitPanelEditor(),gn(l)&&!i){const c=l.getSaveModel(),d=s(),m=d.type!==l.type;n(un(l,a)),d.restoreModel(c),d.configRev++,m&&(d.plugin=l.plugin,d.generateNewKey(),await n((0,it.bc)({key:d.key,plugin:l.plugin}))),setTimeout(()=>{d.getQueryRunner().useLastResultFrom(l.getQueryRunner()),d.render(),l.hasSavedPanelEditChange&&!l.hasChanged&&(d.configRev=0)},20)}n((0,Pe.qj)(l.key)),n((0,Y.my)())}}function gn(n){return n.hasChanged||n.hasSavedPanelEditChange||n.isAngularPlugin()}function Be(n){return(t,a)=>{const r={...a().panelEditor.ui,...n};t((0,Y.K9)(r));try{ze.Z.setObject(Y.jy,r)}catch(s){console.error(s)}}}var hn=o(84135);const fn=({dashboard:n,onSaveSuccess:t,onDiscard:a,onDismiss:r})=>e.createElement(ne.u,{isOpen:!0,title:"Unsaved changes",onDismiss:r,icon:"exclamation-triangle",className:p.css`
        width: 500px;
      `},e.createElement("h5",null,"Do you want to save your changes?"),e.createElement(ne.u.ButtonRow,null,e.createElement(x.zx,{variant:"secondary",onClick:r,fill:"outline"},"Cancel"),e.createElement(x.zx,{variant:"destructive",onClick:a},"Discard"),e.createElement(hn.i,{dashboard:n,onSaveSuccess:t}))),ct=e.memo(({dashboard:n})=>{const[t,a]=(0,e.useState)({original:null}),r=(0,O.useDispatch)(),{original:s,originalPath:i}=t,{showModal:l,hideModal:c}=(0,e.useContext)(st.kr);(0,e.useEffect)(()=>{const m=setTimeout(()=>{const g=T.E1.getLocation().pathname,f=n.getSaveModelClone();a({originalPath:g,original:f})},1e3),u=an.h.subscribe(U.Jd,()=>{const g=n.getSaveModelClone();a({originalPath:i,original:g})});return()=>{clearTimeout(m),u.unsubscribe()}},[n,i]),(0,e.useEffect)(()=>{const m=u=>{dt(n,s)||pt(n,s)&&(u.preventDefault(),u.returnValue="")};return window.addEventListener("beforeunload",m),()=>window.removeEventListener("beforeunload",m)},[n,s]);const d=m=>{const u=n.panelInEdit,g=new URLSearchParams(m.search);return u&&u.libraryPanel&&u.hasChanged&&!g.has("editPanel")?(l(ot,{isUnsavedPrompt:!0,panel:n.panelInEdit,folderUid:n.meta.folderUid??"",onConfirm:()=>{c(),Ce(m)},onDiscard:()=>{r(lt()),Ce(m),c()},onDismiss:c}),!1):i===m.pathname||!s?(u&&!g.has("editPanel")&&r(mn()),!0):dt(n,s)||!pt(n,s)?!0:(l(fn,{dashboard:n,onSaveSuccess:()=>{c(),Ce(m)},onDiscard:()=>{a({...t,original:null}),c(),Ce(m)},onDismiss:c}),!1)};return e.createElement(ie.NL,{when:!0,message:d})});ct.displayName="DashboardPrompt";function Ce(n){n&&setTimeout(()=>T.E1.push(n),10)}function dt(n,t){if(!t||!le.Vt.isSignedIn||!n)return!0;const{canSave:a,fromScript:r,fromFile:s}=n.meta;return!le.Vt.isEditor&&!a?!0:!a||r||s}function ut(n){const t=new cn.f(n);t.expandRows();const a=t.getSaveModelClone();return a.time=0,a.refresh="",a.schemaVersion=0,a.timezone=0,a.panels=[],(0,Z.each)(a.getVariables(),r=>{r.current=null,r.options=null,r.filters=null}),a}function pt(n,t){if(n.hasUnsavedChanges())return!0;const a=ut(n.getSaveModelClone()),r=ut(t),s=(0,Z.find)(a.nav,{type:"timepicker"}),i=(0,Z.find)(r.nav,{type:"timepicker"});s&&i&&(s.now=i.now);const l=JSON.stringify(a,null),c=JSON.stringify(r,null);return l!==c}var vn=o(36182),$=o(39653),Se=o(73952),Te=o(89050),mt=o(40400),De=o(26418),gt=o(30979),En=o(26338),We=o(72142),ce=o(79841),bn=o(67487),ee=o(45253),de=o(24799),ht=o(53217),Ve=o(94599),yn=o(9405),W=o(52081),ae=o(8944),Pn=o(3574),Cn=o.n(Pn),Sn=o(38849),xe=o(20112),Tn=o(38535),ue=o(19349),Oe=o(87464),ft=o(78197),pe=(n=>(n[n.Support=0]="Support",n[n.Data=1]="Data",n))(pe||{}),we=(n=>(n[n.PanelSnapshot=0]="PanelSnapshot",n[n.GithubComment=1]="GithubComment",n))(we||{});class Dn extends Tn.b{constructor(t){super({panel:t,panelTitle:t.replaceVariables(t.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,r=Math.pow(1024,2)*1.5;return a.length>r?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:r}=this.state,s=new Blob([a],{type:"text/plain"}),i=`debug-${r}-${(0,Sn.dq)(new Date)}.json.txt`;Cn()(s,i)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:r}=this.state;this.setState({randomize:{...r,[a]:!r[a]}})},this.onPreviewDashboard=()=>{const{snapshot:a}=this.state;a&&((0,Oe.$M)({meta:{},dashboard:a}),o.g.open(y.v.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:t,randomize:a,snapshotUpdate:r,iframeLoading:s,currentTab:i}=this.state,l=await(0,ft.$R)(t,a,(0,ue.$t)().timeRange()),c=JSON.stringify(l,null,2),d=(0,ft.S$)(t,c),m=(0,xe.zc)((0,xe.Cf)("bytes")(c?.length??0));s&&i===0&&(0,Oe.$M)({meta:{},dashboard:l}),this.setState({snapshot:l,snapshotText:c,markdownText:d,snapshotSize:m,snapshotUpdate:r+1})}subscribeToIframeLoadingMessage(){const t=a=>{a.data==="GrafanaAppInit"&&((0,Oe.$M)({meta:{},dashboard:this.state.snapshot}),this.setState({iframeLoading:!0}))};return window.addEventListener("message",t,!1),function(){window.removeEventListener("message",t)}}}function xn({panel:n,plugin:t,onClose:a}){const r=(0,E.wW)(On),s=(0,e.useMemo)(()=>new Dn(n),[n]),{currentTab:i,loading:l,error:c,iframeLoading:d,options:m,showMessage:u,snapshotSize:g,markdownText:f,snapshotText:h,randomize:b,panelTitle:C,snapshotUpdate:F}=s.useState();if((0,e.useEffect)(()=>{s.buildDebugDashboard()},[s,t,b]),(0,e.useEffect)(()=>s.subscribeToIframeLoadingMessage(),[s]),!t)return null;const P=[{label:"Snapshot",value:pe.Support},{label:"Data",value:pe.Data}];return e.createElement(gt.d,{title:"Get help with this panel",width:"90%",onClose:a,expandable:!0,scrollableContent:!0,subtitle:e.createElement(De.Stack,{direction:"column",gap:1},e.createElement(De.Stack,{direction:"row",gap:1},e.createElement(En.a,{featureState:mt.CQ.beta}),e.createElement("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer"},"Troubleshooting docs ",e.createElement(G.J,{name:"external-link-alt"}))),e.createElement("span",{className:"muted"},"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings.")),tabs:e.createElement(We.J,null,P.map((S,V)=>e.createElement(ce.O,{key:`${S.value}-${V}`,label:S.label,active:S.value===i,onChangeTab:()=>s.onCurrentTabChange(S.value)})))},l&&e.createElement(bn.$,null),c&&e.createElement(ee.b,{title:c.title},c.message),i===pe.Data&&e.createElement("div",{className:r.code},e.createElement("div",{className:r.opts},e.createElement(de.g,{label:"Template",className:r.field},e.createElement(ht.Ph,{options:m,value:u,onChange:s.onShowMessageChange})),u===we.GithubComment?e.createElement(Ve.m,{icon:"copy",getText:s.onGetMarkdownForClipboard},"Copy to clipboard"):e.createElement(x.zx,{icon:"download-alt",onClick:s.onDownloadDashboard},"Download (",g,")")),e.createElement(Te.Z,{disableWidth:!0},({height:S})=>e.createElement(yn.p,{width:"100%",height:S,language:u===we.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:u===we.GithubComment?f:h,readOnly:!1,onBlur:s.onSetSnapshotText}))),i===pe.Support&&e.createElement(e.Fragment,null,e.createElement(de.g,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal."},e.createElement(W.Lh,null,e.createElement(ae.x,{label:"Labels",id:"randomize-labels",showLabel:!0,value:Boolean(b.labels),onChange:()=>s.onToggleRandomize("labels")}),e.createElement(ae.x,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:Boolean(b.names),onChange:()=>s.onToggleRandomize("names")}),e.createElement(ae.x,{label:"String values",id:"randomize-string-values",showLabel:!0,value:Boolean(b.values),onChange:()=>s.onToggleRandomize("values")}))),e.createElement(de.g,{label:"Support snapshot",description:`Panel: ${C}`},e.createElement(De.Stack,null,e.createElement(x.zx,{icon:"download-alt",onClick:s.onDownloadDashboard},"Dashboard (",g,")"),e.createElement(Ve.m,{icon:"github",getText:s.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard"},"Copy to clipboard"),e.createElement(x.zx,{onClick:s.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab"},"Preview"))),e.createElement(Te.Z,{disableWidth:!0},({height:S})=>e.createElement(e.Fragment,null,e.createElement("iframe",{title:"Support snapshot preview",src:`${y.v.appUrl}dashboard/new?orgId=${le.Vt.user.orgId}&kiosk&${F}`,width:"100%",height:S-100,frameBorder:"0",style:{display:d?"block":"none",marginTop:16}}),!d&&e.createElement("div",null,"\xA0")))))}const On=n=>({code:p.css`
    flex-grow: 1;
    height: 100%;
    overflow: scroll;
  `,field:p.css`
    width: 100%;
  `,opts:p.css`
    display: flex;
    display: flex;
    width: 100%;
    flex-grow: 0;
    align-items: center;
    justify-content: flex-end;

    button {
      margin-left: 8px;
    }
  `});var wn=o(49922);const He=(n,t,a)=>{const r=(0,e.useRef)(),[s,i]=(0,e.useState)();return(0,e.useEffect)(()=>{let l=-1,c=0;return r.current=n.getQueryRunner().getData(t).subscribe({next:d=>{if(a){if(l===d.structureRev){const m=Date.now();if(m-c<1e4)return;c=m}l=d.structureRev??-1}i(d)}}),()=>{r.current&&r.current.unsubscribe()}},[n,t.withFieldConfig,t.withTransforms]),{data:s,error:s&&s.error,isLoading:s?s.state===wn.Gu.Loading:!0,hasSeries:s?!!s.series:!1}};var In=o(40885),j=o(35287),Rn=o(21957),Nn=o(46835),Mn=o(18893);const An=({data:n,metadataDatasource:t})=>!t||!t.components?.MetadataInspector?e.createElement(j.cC,{i18nKey:"dashboard.inspect-meta.no-inspector"},"No Metadata Inspector"):e.createElement(t.components.MetadataInspector,{datasource:t,data:n.series});var $n=o(82090),Ln=o(72062);const Un=({panel:n,plugin:t,dashboard:a,tabs:r,data:s,isDataLoading:i,dataOptions:l,metadataDatasource:c,defaultTab:d,onDataOptionsChange:m,onClose:u})=>{const[g,f]=(0,e.useState)(d??$.q.Data);if(!t)return null;const h=s?.error;let b=g;r.find(P=>P.value===g)||(b=$.q.JSON);const C=(0,In.J)().replace(n.title,n.scopedVars,"text")||"Panel",F=(0,j.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:C});return e.createElement(gt.d,{title:F,subtitle:s&&Fn(s),width:"50%",onClose:u,expandable:!0,scrollableContent:!0,tabs:e.createElement(We.J,null,r.map((P,S)=>e.createElement(ce.O,{key:`${P.value}-${S}`,label:P.label,active:P.value===b,onChangeTab:()=>f(P.value||$.q.Data)})))},b===$.q.Data&&e.createElement(Rn.E,{panel:n,data:s&&s.series,isLoading:i,options:l,onOptionsChange:m,timeZone:a.timezone,app:mt.zj.Dashboard}),s&&b===$.q.Meta&&e.createElement(An,{data:s,metadataDatasource:c}),b===$.q.JSON&&e.createElement(Mn.W,{panel:n,dashboard:a,data:s,onClose:u}),b===$.q.Error&&e.createElement(Nn.l,{error:h}),s&&b===$.q.Stats&&e.createElement($n.f,{data:s,timeZone:a.getTimezone()}),s&&b===$.q.Query&&e.createElement(Ln.D,{panel:n,data:s.series,onRefreshQuery:()=>n.refresh()}))};function Fn(n){const{request:t}=n;if(!t)return"";const a=t.targets.length,r=t.endTime?t.endTime-t.startTime:0,s=(0,xe.zc)((0,xe.Cf)("ms")(r));return e.createElement(j.cC,{i18nKey:"dashboard.inspect.subtitle"},{queryCount:a}," queries with total query time of ",{formatted:s})}var zn=o(50700),vt=o(86647),ke=o(13505);const Bn=n=>(0,zn.Z)(async()=>{const a=n?.request?.targets||[];if(n&&n.series&&a.length){for(const r of n.series)if(r.meta&&r.meta.custom){const s=await(0,vt.F)().get(a[0].datasource);if(s&&s.components?.MetadataInspector)return s}}},[n]).value,Wn=(n,t,a,r,s)=>(0,e.useMemo)(()=>{const i=[];(0,ke.sY)(a)&&(i.push({label:(0,j.t)("dashboard.inspect.data-tab","Data"),value:$.q.Data}),i.push({label:(0,j.t)("dashboard.inspect.stats-tab","Stats"),value:$.q.Stats})),s&&i.push({label:(0,j.t)("dashboard.inspect.meta-tab","Meta Data"),value:$.q.Meta}),i.push({label:(0,j.t)("dashboard.inspect.json-tab","JSON"),value:$.q.JSON}),r&&r.message&&i.push({label:(0,j.t)("dashboard.inspect.error-tab","Error"),value:$.q.Error});const l=window.grafanaPanelInspectActionSupplier;return l&&l.getActions(n)?.length&&i.push({label:(0,j.t)("dashboard.inspect.actions-tab","Actions"),value:$.q.Actions}),t.meta.canEdit&&(0,ke.sY)(a)&&i.push({label:(0,j.t)("dashboard.inspect.query-tab","Query"),value:$.q.Query}),i},[n,a,s,t,r]),Vn=({panel:n,dashboard:t,plugin:a})=>{const[r,s]=(0,e.useState)({withTransforms:!1,withFieldConfig:!0}),i=(0,ie.TH)(),{data:l,isLoading:c,error:d}=He(n,r,!0),m=Bn(l),u=Wn(n,t,a,d,m),g=new URLSearchParams(i.search).get("inspectTab"),f=()=>{T.E1.partial({inspect:null,inspectTab:null})};return a?g===$.q.Help?e.createElement(xn,{panel:n,plugin:a,onClose:f}):e.createElement(Un,{dashboard:t,panel:n,plugin:a,defaultTab:g,tabs:u,data:l,isDataLoading:c,dataOptions:r,onDataOptionsChange:s,metadataDatasource:m,onClose:f}):null},Hn=(n,t)=>{const a=(0,Se.i)(n,t.panel);return a?{plugin:a.plugin}:{plugin:null}},kn=(0,I.connect)(Hn)(Vn);var Et=o(95484),Ie=o(2594),Re=o(64319),Kn=o(8125),Qn=o(35224),Zn=o(7804),Gn=o(95379),bt=o(80177),jn=o(77582),me=o(61860),Jn=o(22323),Ke=o(10672);const Yn=n=>{const t=(0,e.useMemo)(()=>Jn.z.get(n.variable.type).picker,[n.variable]);return n.variable?e.createElement("div",{className:"gf-form"},e.createElement(Xn,{variable:n.variable}),n.variable.hide!==Ke.bU.hideVariable&&t&&e.createElement(t,{variable:n.variable,readOnly:n.readOnly??!1})):e.createElement("div",null,"Couldn't load variable")};function Xn({variable:n}){const t=(0,e.useMemo)(()=>n.label||n.name,[n]);if(n.hide!==Ke.bU.dontHide)return null;const a=`var-${n.id}`;return n.description?e.createElement(me.u,{content:n.description,placement:"bottom"},e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":v.wl.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a},t)):e.createElement("label",{className:"gf-form-label gf-form-label--variable","data-testid":v.wl.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a},t)}const yt=({variables:n,readOnly:t})=>{const[a,r]=(0,e.useState)([]);return(0,e.useEffect)(()=>{r(n.filter(s=>s.hide!==Ke.bU.hideVariable))},[n]),a.length===0?null:e.createElement(e.Fragment,null,a.map(s=>e.createElement("div",{key:s.id,className:"submenu-item gf-form-inline","data-testid":v.wl.pages.Dashboard.SubMenu.submenuItem},e.createElement(Yn,{variable:s,readOnly:t}))))};var qn=o(54294),_n=o(81283),ge=o(6297),Qe=o(87095),ea=o(61802),ta=o(37877),na=o(7196),Pt=o(14747),he=o(68226),Ct=o(11484);function aa(n,t){ze.Z.set(`panel-edit-section-${n}`,t?"true":"false")}function ra(n,t){return ze.Z.getBool(`panel-edit-section-${n}`,t)}const St=(n,t)=>({angularPanelComponent:(0,Se.i)(n,t.panel)?.angularComponent}),Tt={changePanelPlugin:Pe.Kc},Ws=(0,I.connect)(St,Tt);class sa extends e.PureComponent{constructor(t){super(t)}componentDidMount(){this.loadAngularOptions()}componentDidUpdate(t){(this.props.plugin!==t.plugin||this.props.angularPanelComponent!==t.angularPanelComponent)&&this.cleanUpAngularOptions(),this.loadAngularOptions()}componentWillUnmount(){this.cleanUpAngularOptions()}cleanUpAngularOptions(){this.angularOptions&&(this.angularOptions.destroy(),this.angularOptions=null)}loadAngularOptions(){const{panel:t,angularPanelComponent:a,changePanelPlugin:r}=this.props;if(!this.element||!a||this.angularOptions)return;const s=a.getScope();if(!s.$$childHead){setTimeout(()=>{this.forceUpdate()});return}const i=s.$$childHead.ctrl;i.initEditMode(),i.onPluginTypeChange=m=>{r({panel:t,pluginId:m.id})};let l="";for(let m=0;m<i.editorTabs.length;m++){const u=i.editorTabs[m];u.isOpen=ra(u.title,m===0),l+=`
      <div class="panel-options-group" ng-cloak>
        <div class="panel-options-group__header" ng-click="toggleOptionGroup(${m})" aria-label="${u.title} section">
          <div class="panel-options-group__icon">
            <icon name="ctrl.editorTabs[${m}].isOpen ? 'angle-down' : 'angle-right'"></icon>
          </div>
          <div class="panel-options-group__title">${u.title}</div>
        </div>
        <div class="panel-options-group__body" ng-if="ctrl.editorTabs[${m}].isOpen">
          <panel-editor-tab editor-tab="ctrl.editorTabs[${m}]" ctrl="ctrl"></panel-editor-tab>
        </div>
      </div>
      `}const c=(0,Ct.w)(),d={ctrl:i,toggleOptionGroup:m=>{const u=i.editorTabs[m];u.isOpen=!u.isOpen,aa(u.title,Boolean(u.isOpen))}};this.angularOptions=c.load(this.element,d,l),this.angularOptions.digest()}render(){return e.createElement("div",{ref:t=>this.element=t})}}const oa=(0,I.connect)(St,Tt)(sa);var Ze=o(91183),Ne=o(68061),Dt=o(43714),xt=o(15670),Me=o(64703),ia=o(14677),la=o.n(ia),ca=o(64353),da=o(51275),Ae=o(8180);const ua=({property:n,context:t,registry:a,onChange:r,onRemove:s,isSystemOverride:i,searchQuery:l})=>{const c=(0,E.wW)(pa),d=a?.getIfExists(n.id);if(!d)return null;const m=Array.isArray(n.value)||n.id===Ne.qb.Thresholds||n.id===Ne.qb.Links||n.id===Ne.qb.Mappings,u=d.category?.filter(h=>h!==d.name);let g;const f=(h=!0,b=!1)=>(C=!1)=>e.createElement(W.Lh,{justify:"space-between"},e.createElement(ca._,{category:u,description:h?d.description:void 0},e.createElement(la(),{textToHighlight:d.name,searchWords:[l],highlightClassName:"search-fragment-highlight"}),!C&&b&&d.getItemsCount&&e.createElement(da.A,{value:d.getItemsCount(n.value)})),!i&&e.createElement("div",null,e.createElement(Ae.h,{name:"times",onClick:s})));return m?g=e.createElement(Ze.u,{id:d.name,renderTitle:f(!1,!0),className:p.css`
          padding-left: 0;
          padding-right: 0;
        `,isNested:!0,isOpenDefault:n.value!==void 0},e.createElement(d.override,{value:n.value,onChange:h=>{r(h)},item:d,context:t})):g=e.createElement("div",null,e.createElement(de.g,{label:f()(),description:d.description},e.createElement(d.override,{value:n.value,onChange:h=>{r(h)},item:d,context:t}))),e.createElement("div",{className:(0,p.cx)(m&&c.collapsibleOverrideEditor,!m&&"dynamicConfigValueEditor--nonCollapsible")},g)},pa=n=>({collapsibleOverrideEditor:p.css`
      label: collapsibleOverrideEditor;
      & + .dynamicConfigValueEditor--nonCollapsible {
        margin-top: ${n.spacing(1)};
      }
    `});var te=o(91752),k=o(66352);const Ot=({isExpanded:n,registry:t,matcherUi:a,overrideName:r,override:s,onOverrideRemove:i})=>{const l=(0,E.wW)(ma),d=s.properties.map(u=>t.getIfExists(u.id)).filter(u=>!!u).map(u=>u?.name).join(", "),m=a.optionsToLabel(s.matcher.options);return e.createElement("div",null,e.createElement(W.Lh,{justify:"space-between"},e.createElement("div",null,r),e.createElement(Ae.h,{name:"trash-alt",onClick:i,title:"Remove override"})),!n&&e.createElement("div",{className:l.overrideDetails},e.createElement("div",{className:l.options,title:m},m," ",e.createElement(G.J,{name:"angle-right"})," ",d)))};Ot.displayName="OverrideTitle";const ma=n=>({matcherUi:p.css`
      padding: ${n.spacing(1)};
    `,propertyPickerWrapper:p.css`
      margin-top: ${n.spacing(2)};
    `,overrideDetails:p.css`
      font-size: ${n.typography.bodySmall.fontSize};
      color: ${n.colors.text.secondary};
      font-weight: ${n.typography.fontWeightRegular};
    `,options:p.css`
      overflow: hidden;
      padding-right: ${n.spacing(4)};
    `,unknownLabel:p.css`
      margin-bottom: 0;
    `});function ga(n,t){const a=[],r=n.panel.fieldConfig,s=n.plugin.fieldConfigRegistry,i=n.data?.series??[];if(s.isEmpty())return[];const l=(u,g)=>{let f=(0,Z.cloneDeep)(r.overrides);f[u]=g,n.onFieldConfigsChange({...r,overrides:f})},c=u=>{let g=(0,Z.cloneDeep)(r.overrides);g.splice(u,1),n.onFieldConfigsChange({...r,overrides:g})},d=u=>{n.onFieldConfigsChange({...r,overrides:[...r.overrides,{matcher:{id:u.value},properties:[]}]})},m={data:i,getSuggestions:u=>(0,Me.PW)(i,u),isOverride:!0};for(let u=0;u<r.overrides.length;u++){const g=r.overrides[u],f=`Override ${u+1}`,h=Dt.i.get(g.matcher.id),b=ha(s),C=(0,Ne.v3)(g),F=g.properties.length===0?1:0,P=new te.j({title:f,id:f,forceOpen:F,renderTitle:function(q){return e.createElement(Ot,{override:g,isExpanded:q,registry:s,overrideName:f,matcherUi:h,onOverrideRemove:()=>c(u)})}}),S=L=>{g.matcher.options=L,l(u,g)},V=(L,q)=>{const ve=s.get(q.value),Ue={id:ve.id,value:ve.defaultValue};g.properties?L.properties.push(Ue):L.properties=[Ue],l(u,L)};P.addItem(new k.a({title:h.name,render:function(){return e.createElement(h.component,{id:`${h.matcher.id}-${u}`,matcher:h.matcher,data:n.data?.series??[],options:g.matcher.options,onChange:S})}}));for(let L=0;L<g.properties.length;L++){const q=g.properties[L],ve=s.getIfExists(q.id);if(!ve)continue;const Ue=nn=>{g.properties[L].value=nn,l(u,g)},Bs=()=>{g.properties.splice(L,1),l(u,g)};P.addItem(new k.a({title:ve.name,skipField:!0,render:function(){return e.createElement(ua,{key:`${q.id}/${L}`,isSystemOverride:C,onChange:Ue,onRemove:Bs,property:q,registry:s,context:m,searchQuery:t})}}))}!C&&g.matcher.options&&P.addItem(new k.a({title:"----------",skipField:!0,render:function(){return e.createElement(xt.b,{key:"Add override property",label:"Add override property",variant:"secondary",isFullWidth:!0,icon:"plus",menuPlacement:"auto",options:b,onChange:q=>V(g,q)})}})),a.push(P)}return a.push(new te.j({title:"add button",id:"add button",customRender:function(){return e.createElement(fa,{key:"Add override"},e.createElement(xt.b,{icon:"plus",label:"Add field override",variant:"secondary",menuPlacement:"auto",isFullWidth:!0,size:"md",options:Dt.i.list().filter(g=>!g.excludeFromPicker).map(g=>({label:g.name,value:g.id,description:g.description})),onChange:g=>d(g)}))}})),a}function ha(n){return n.list().filter(t=>!t.hideFromOverrides).map(t=>{let a=t.name;return t.category&&(a=[...t.category,t.name].join(" > ")),{label:a,value:t.id,description:t.description}})}function fa({children:n}){const t=(0,E.wW)(va);return e.createElement("div",{className:t},n)}function va(n){return(0,p.css)({borderTop:`1px solid ${n.colors.border.weak}`,padding:`${n.spacing(2)}`,display:"flex"})}const Ea=({panel:n,formatDate:t})=>{const a=(0,E.wW)(ba),r=n.libraryPanel?.meta;return r?e.createElement("div",{className:a.info},e.createElement("div",{className:a.libraryPanelInfo},`Used on ${r.connectedDashboards} `,r.connectedDashboards===1?"dashboard":"dashboards"),e.createElement("div",{className:a.libraryPanelInfo},"Last edited on ",t?.(r.updated,"L")??r.updated," by",r.updatedBy.avatarUrl&&e.createElement("img",{width:"22",height:"22",className:a.userAvatar,src:r.updatedBy.avatarUrl,alt:`Avatar for ${r.updatedBy.name}`}),r.updatedBy.name)):null},ba=n=>({info:p.css`
      line-height: 1;
    `,libraryPanelInfo:p.css`
      color: ${n.colors.text.secondary};
      font-size: ${n.typography.bodySmall.fontSize};
    `,userAvatar:p.css`
      border-radius: 50%;
      box-sizing: content-box;
      width: 22px;
      height: 22px;
      padding-left: ${n.spacing(1)};
      padding-right: ${n.spacing(1)};
    `});function ya(n){const{panel:t,onPanelConfigChange:a,dashboard:r}=n,s=new te.j({title:"Library panel options",id:"Library panel options",isOpenDefault:!0});return(0,ge.V)(t)&&s.addItem(new k.a({title:"Name",value:t.libraryPanel.name,popularRank:1,render:function(){return e.createElement(ye.I,{id:"LibraryPanelFrameName",defaultValue:t.libraryPanel.name,onBlur:l=>a("libraryPanel",{...t.libraryPanel,name:l.currentTarget.value})})}})).addItem(new k.a({title:"Information",render:function(){return e.createElement(Ea,{panel:t,formatDate:r.formatDate})}})),s}var Pa=o(97379),Ca=o(68037),Sa=o(21599);function Ta(n){const{panel:t,onPanelConfigChange:a}=n;return new te.j({title:"Panel options",id:"Panel options",isOpenDefault:!0}).addItem(new k.a({title:"Title",value:t.title,popularRank:1,render:function(){return e.createElement(ye.I,{id:"PanelFrameTitle",defaultValue:t.title,onBlur:i=>a("title",i.currentTarget.value)})}})).addItem(new k.a({title:"Description",description:t.description,value:t.description,render:function(){return e.createElement(Pa.K,{id:"description-text-area",defaultValue:t.description,onBlur:i=>a("description",i.currentTarget.value)})}})).addItem(new k.a({title:"Transparent background",render:function(){return e.createElement(ae.r,{value:t.transparent,id:"transparent-background",onChange:i=>a("transparent",i.currentTarget.checked)})}})).addCategory(new te.j({title:"Panel links",id:"Panel links",isOpenDefault:!1,itemsCount:t.links?.length}).addItem(new k.a({title:"Panel links",render:function(){return e.createElement(Ca.d,{links:t.links,onChange:i=>a("links",i),getSuggestions:Me.PR,data:[]})}}))).addCategory(new te.j({title:"Repeat options",id:"Repeat options",isOpenDefault:!1}).addItem(new k.a({title:"Repeat by variable",description:"Repeat this panel for each value in the selected variable. This is not visible while in edit mode. You need to go back to dashboard and then update the variable or reload the dashboard.",render:function(){return e.createElement(Sa.X,{id:"repeat-by-variable-select",repeat:t.repeat,onChange:i=>{a("repeat",i)}})}})).addItem(new k.a({title:"Repeat direction",showIf:()=>!!t.repeat,render:function(){const i=[{label:"Horizontal",value:"h"},{label:"Vertical",value:"v"}];return e.createElement(Ie.S,{options:i,value:t.repeatDirection||"h",onChange:l=>a("repeatDirection",l)})}})).addItem(new k.a({title:"Max per row",showIf:()=>Boolean(t.repeat&&t.repeatDirection==="h"),render:function(){const i=[2,3,4,6,8,12].map(l=>({label:l.toString(),value:l}));return e.createElement(ht.Ph,{options:i,value:t.maxPerRow,onChange:l=>a("maxPerRow",l.value)})}})))}var Da=o(57054);class xa{constructor(t,a){this.categories=t,this.overrides=a}search(t){const a=new RegExp(t,"i"),s=this.collectHits(this.categories,a,[]).sort(wt).map(c=>c.item),l=this.collectHits(this.overrides,a,[]).sort(wt).map(c=>c.item);return{optionHits:s,overrideHits:this.buildOverrideHitCategories(l),totalCount:this.getAllOptionsCount(this.categories)}}collectHits(t,a,r){for(const s of t){const i=a.test(s.props.title);for(const l of s.items){if(a.test(l.props.title)){r.push({item:l,rank:1});continue}if(l.props.description&&a.test(l.props.description)){r.push({item:l,rank:2});continue}i&&r.push({item:l,rank:3})}s.categories.length>0&&this.collectHits(s.categories,a,r)}return r}getAllOptionsCount(t){let a=0;for(const r of t)a+=r.items.length,r.categories.length>0&&(a+=this.getAllOptionsCount(r.categories));return a}buildOverrideHitCategories(t){const a={};for(const r of t){let s=a[r.parent.props.title];s||(s=a[r.parent.props.title]=new te.j(r.parent.props),s.addItem(r.parent.items[0])),s.items[0].props.title!==r.props.title&&s.addItem(r)}return Object.values(a)}}function wt(n,t){return n.rank-t.rank}function Oa(n){const t=[];for(const a of n)for(const r of a.items)r.props.title==="Unit"&&(r.props.popularRank=2),r.props.title==="Min"&&(r.props.popularRank=3),r.props.title==="Max"&&(r.props.popularRank=4),r.props.title==="Display name"&&(r.props.popularRank=5),r.props.popularRank&&t.push(r);return t.sort((a,r)=>a.props.popularRank-r.props.popularRank)}const wa=n=>{const{plugin:t,dashboard:a,panel:r}=n,[s,i]=(0,e.useState)(""),[l,c]=(0,e.useState)(X.All),d=(0,E.wW)(Na),[m,u,g]=(0,e.useMemo)(()=>[Ta(n),(0,Da.AL)(n),ya(n)],[r.configRev,n.data,n.instanceState,s]),f=(0,e.useMemo)(()=>ga(n,s),[r.configRev,n.data,n.instanceState,s]),h=[],b=s.length>0,C=(0,e.useMemo)(Ia,[]),F=(0,ge.V)(r)?[g,m,...u]:[m,...u];if(b)h.push(Ra(F,f,s)),n.plugin.angularPanelCtrl&&h.push(e.createElement("div",{className:d.searchNotice,key:"Search notice"},"This is an old visualization type that does not support searching all options."));else switch(l){case X.All:(0,ge.V)(r)&&h.push(g.render()),h.push(m.render()),n.plugin.angularPanelCtrl&&h.push(e.createElement(oa,{plugin:t,dashboard:a,panel:r,key:"AngularOptions"}));for(const S of u)h.push(S.render());for(const S of f)h.push(S.render());break;case X.Overrides:for(const S of f)h.push(S.render());break;case X.Recent:h.push(e.createElement(Ze.u,{id:"Recent options",title:"Recent options",key:"Recent options",forceOpen:1},Oa(F).map(S=>S.render())));break}const P=!b&&!t.fieldConfigRegistry.isEmpty();return e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.formBox},e.createElement("div",{className:d.formRow},e.createElement(Pt.H,{width:0,value:s,onChange:i,placeholder:"Search options"})),P&&e.createElement("div",{className:d.formRow},e.createElement(Ie.S,{options:C,value:l,fullWidth:!0,onChange:c}))),e.createElement("div",{className:d.scrollWrapper},e.createElement(he.$,{autoHeightMin:"100%"},e.createElement("div",{className:d.mainBox},h))))};function Ia(){return[{label:X.All,value:X.All},{label:X.Overrides,value:X.Overrides}]}var X=(n=>(n.All="All",n.Overrides="Overrides",n.Recent="Recent",n))(X||{});function Ra(n,t,a){const r=new xa(n,t),{optionHits:s,totalCount:i,overrideHits:l}=r.search(a);return e.createElement("div",{key:"search results"},e.createElement(Ze.u,{id:"Found options",title:`Matched ${s.length}/${i} options`,key:"Normal options",forceOpen:1},s.map(c=>c.render(a))),l.map(c=>c.render(a)))}const Na=n=>({wrapper:p.css`
    height: 100%;
    display: flex;
    flex-direction: column;
    flex: 1 1 0;

    .search-fragment-highlight {
      color: ${n.colors.warning.text};
      background: transparent;
    }
  `,searchBox:p.css`
    display: flex;
    flex-direction: column;
    min-height: 0;
  `,formRow:p.css`
    margin-bottom: ${n.spacing(1)};
  `,formBox:p.css`
    padding: ${n.spacing(1)};
    background: ${n.colors.background.primary};
    border: 1px solid ${n.components.panel.borderColor};
    border-top-left-radius: ${n.shape.borderRadius(1.5)};
    border-bottom: none;
  `,closeButton:p.css`
    margin-left: ${n.spacing(1)};
  `,searchHits:p.css`
    padding: ${n.spacing(1,1,0,1)};
  `,scrollWrapper:p.css`
    flex-grow: 1;
    min-height: 0;
  `,searchNotice:p.css`
    font-size: ${n.typography.size.sm};
    color: ${n.colors.text.secondary};
    padding: ${n.spacing(1)};
    text-align: center;
  `,mainBox:p.css`
    background: ${n.colors.background.primary};
    border: 1px solid ${n.components.panel.borderColor};
    border-top: none;
    flex-grow: 1;
  `});var Ma=o(26202),Aa=o(35974);const It=n=>t=>t.plugins.panels[n]||(0,Aa.X)(`Panel plugin not found (${n})`,!0),Ge=({panel:n})=>{const t=(0,O.useDispatch)(),a=(0,O.useSelector)(It(n.type)),r=(0,O.useSelector)(c=>c.panelEditor.ui.isPanelOptionsVisible),s=(0,O.useSelector)(c=>c.panelEditor.isVizPickerOpen),i=()=>{t((0,Y.g_)(!s))},l=()=>{t(Be({isPanelOptionsVisible:!r}))};return a?e.createElement("div",{className:Rt.wrapper},e.createElement(Ma.h,null,e.createElement(Re.h,{className:Rt.vizButton,tooltip:"Click to change visualization",imgSrc:a.meta.info.logos.small,isOpen:s,onClick:i,"aria-label":v.wl.components.PanelEditor.toggleVizPicker,variant:"canvas",fullWidth:!0},a.meta.name),e.createElement(Re.h,{tooltip:r?"Close options pane":"Show options pane",icon:r?"angle-right":"angle-left",onClick:l,variant:"canvas","aria-label":v.wl.components.PanelEditor.toggleVizOptions}))):null};Ge.displayName="VisualizationTab";const Rt={wrapper:p.css`
    display: flex;
    flex-direction: column;
  `,vizButton:p.css`
    text-align: left;
  `};var $a=o(24664),La=o(84952),Ua=o(9398),Fa=o(53708),za=o(76647),Nt=o(98102);const Ba=({onConfirm:n,onDismiss:t,panel:a})=>{const r=(0,ge.V)(a),s=`${r?"Changing":"Replace with"} library panel`,i=`${r?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return e.createElement(Nt.s,{onConfirm:n,onDismiss:t,confirmText:r?"Change":"Replace",title:s,body:i,dismissText:"Cancel",isOpen:!0})};var Wa=o(18027);const Va=({panel:n,searchQuery:t})=>{const[a,r]=(0,e.useState)(!1),[s,i]=(0,e.useState)(void 0),[l,c]=(0,e.useState)([]),d=(0,e.useCallback)(b=>{c(b.map(C=>C.id))},[c]),m=(0,Ua.h4)().getCurrent(),u=(0,O.useDispatch)(),g=async()=>{s&&(i(void 0),u((0,Pe.ih)(n,s)))},f=()=>r(!0),h=()=>i(void 0);return e.createElement(W.wc,{spacing:"md"},!n.libraryPanel&&e.createElement(W.wc,{align:"center"},e.createElement(x.zx,{icon:"plus",onClick:f,variant:"secondary",fullWidth:!0},"Create new library panel")),e.createElement(Fa.j,{onChange:d}),e.createElement("div",{className:Ha.libraryPanelsView},e.createElement(Wa.u,{currentPanelId:n.libraryPanel?.uid,searchString:t,panelFilter:l,onClickCard:i,showSecondaryActions:!0})),a&&e.createElement(za.c,{panel:n,onDismiss:()=>r(!1),initialFolderUid:m?.meta.folderUid,isOpen:a}),s&&e.createElement(Ba,{panel:n,onDismiss:h,onConfirm:g}))},Ha={libraryPanelsView:p.css`
    width: 100%;
  `};var je=o(20251),ka=o(38490);const Ka=["timeseries","barchart","gauge","stat","piechart","bargauge","table","state-timeline","status-history","logs","candlestick"];async function Qa(n,t){const a=new je.mi(n,t);for(const s of Ka){const l=(await(0,ka.Ub)(s)).getSuggestionsSupplier();l&&l.getSuggestionsForData(a)}const r=a.getList();if(a.dataSummary.fieldCount===0)for(const s of Object.values(y.v.panels))!s.skipDataQuery||s.hideFromList||r.push({name:s.name,pluginId:s.id,description:s.info.description,cardOptions:{imgSrc:s.info.logos.small}});return r.sort((s,i)=>(i.score??je._.OK)-(s.score??je._.OK))}var Mt=o(98141);function Za({data:n,suggestion:t,onChange:a,width:r}){const s=(0,E.wW)(Ga),{innerStyles:i,outerStyles:l,renderWidth:c,renderHeight:d}=ja(r),m=t.cardOptions??{},u={"aria-label":t.name,className:s.vizBox,"data-testid":v.wl.components.VisualizationPreview.card(t.name),style:l,onClick:()=>{a({pluginId:t.pluginId,options:t.options,fieldConfig:t.fieldConfig})}};if(m.imgSrc)return e.createElement(me.u,{content:t.description??t.name},e.createElement("button",{...u,className:(0,p.cx)(s.vizBox,s.imgBox)},e.createElement("div",{className:s.name},t.name),e.createElement("img",{className:s.img,src:m.imgSrc,alt:t.name})));let g=t;return t.cardOptions?.previewModifier&&(g=(0,Z.cloneDeep)(t),t.cardOptions.previewModifier(g)),e.createElement("button",{...u},e.createElement(me.u,{content:t.name},e.createElement("div",{style:i,className:s.renderContainer},e.createElement(Mt.$,{title:"",data:n,pluginId:t.pluginId,width:c,height:d,options:g.options,fieldConfig:g.fieldConfig}),e.createElement("div",{className:s.hoverPane}))))}const Ga=n=>({hoverPane:(0,p.css)({position:"absolute",top:0,right:0,left:0,borderRadius:n.spacing(2),bottom:0}),vizBox:p.css`
      position: relative;
      background: none;
      border-radius: ${n.shape.borderRadius(1)};
      cursor: pointer;
      border: 1px solid ${n.colors.border.medium};

      transition: ${n.transitions.create(["background"],{duration:n.transitions.duration.short})};

      &:hover {
        background: ${n.colors.background.secondary};
      }
    `,imgBox:p.css`
      display: flex;
      flex-direction: column;
      height: 100%;

      justify-self: center;
      color: ${n.colors.text.primary};
      width: 100%;
      display: flex;

      justify-content: center;
      align-items: center;
      text-align: center;
    `,name:p.css`
      padding-bottom: ${n.spacing(.5)};
      margin-top: ${n.spacing(-1)};
      font-size: ${n.typography.bodySmall.fontSize};
      white-space: nowrap;
      overflow: hidden;
      color: ${n.colors.text.secondary};
      font-weight: ${n.typography.fontWeightMedium};
      text-overflow: ellipsis;
    `,img:p.css`
      max-width: ${n.spacing(8)};
      max-height: ${n.spacing(8)};
    `,renderContainer:p.css`
      position: absolute;
      transform-origin: left top;
      top: 6px;
      left: 6px;
    `});function ja(n){const a=n,r=n*(1/1.6),s=350,i=s*(1/1.6),l=6,c=(a-l*2)/s,d=(r-l*2)/i;return{renderHeight:i,renderWidth:s,outerStyles:{width:a,height:r},innerStyles:{width:s,height:i,transform:`scale(${c}, ${d})`}}}function Ja({onChange:n,data:t,panel:a,searchQuery:r}){const s=(0,E.wW)(Xa),{value:i}=(0,be.Z)(()=>Qa(t,a),[t,a]),l=Ya(r,i);return e.createElement(Te.Z,{disableHeight:!0,style:{width:"100%",height:"100%"}},({width:c})=>{if(!c)return null;const d=Math.floor(c/170),m=8*(d-1),u=(c-m)/d;return e.createElement("div",null,e.createElement("div",{className:s.filterRow},e.createElement("div",{className:s.infoText},"Based on current data")),e.createElement("div",{className:s.grid,style:{gridTemplateColumns:`repeat(auto-fill, ${u-1}px)`}},l.map((g,f)=>e.createElement(Za,{key:f,data:t,suggestion:g,onChange:n,width:u})),r&&l.length===0&&e.createElement("div",{className:s.infoText},"No results matched your query")))})}function Ya(n,t){if(!n||!t)return t||[];const a=new RegExp(n,"i");return t.filter(r=>a.test(r.name)||a.test(r.pluginId))}const Xa=n=>({heading:(0,p.css)({...n.typography.h5,margin:n.spacing(0,.5,1)}),filterRow:(0,p.css)({display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",paddingBottom:"8px"}),infoText:(0,p.css)({fontSize:n.typography.bodySmall.fontSize,color:n.colors.text.secondary,fontStyle:"italic"}),grid:(0,p.css)({display:"grid",gridGap:n.spacing(1),gridTemplateColumns:"repeat(auto-fill, 144px)",marginBottom:n.spacing(1),justifyContent:"space-evenly"})});var qa=o(69097),At=o(13440),_a=o(89710);const $t=({isCurrent:n,plugin:t,onClick:a,disabled:r})=>e.createElement(_a.X,{title:t.name,plugin:t,description:t.info.description,onClick:a,isCurrent:n,disabled:r,showBadge:!0});$t.displayName="VizTypePickerPlugin";function er({searchQuery:n,onChange:t,current:a,data:r}){const s=(0,E.wW)(tr),i=(0,e.useMemo)(()=>(0,At.x)(),[]),l=(0,e.useMemo)(()=>(0,At.r)(i,n,a),[a,i,n]);return l.length===0?e.createElement(qa.K,null,"Could not find anything matching your query"):e.createElement("div",{className:s.grid},l.map((c,d)=>e.createElement($t,{disabled:!1,key:c.id,isCurrent:c.id===a.id,plugin:c,onClick:m=>t({pluginId:c.id,withModKey:Boolean(m.metaKey||m.ctrlKey||m.altKey)})})))}const tr=n=>({grid:p.css`
      max-width: 100%;
      display: grid;
      grid-gap: ${n.spacing(.5)};
    `,heading:(0,p.css)({...n.typography.h5,margin:n.spacing(0,.5,1)})});var w=o(16200);const Lt=({panel:n,data:t})=>{const a=(0,O.useSelector)(It(n.type)),[r,s]=(0,e.useState)(""),[i,l]=(0,$a.Z)(La.FL,w.Ok.Visualizations),c=(0,O.useDispatch)(),d=(0,E.wW)(nr),m=(0,e.useRef)(null),u=(0,e.useCallback)(h=>{c((0,Pe.Kc)({panel:n,...h})),h.withModKey||c((0,Y.g_)(!1))},[c,n]),g=()=>{c((0,Y.g_)(!1))};if(!a)return null;const f=[{label:"Visualizations",value:w.Ok.Visualizations},{label:"Suggestions",value:w.Ok.Suggestions},{label:"Library panels",value:w.Ok.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return e.createElement("div",{className:d.openWrapper},e.createElement("div",{className:d.formBox},e.createElement("div",{className:d.searchRow},e.createElement(Pt.H,{value:r,onChange:s,ref:m,autoFocus:!0,placeholder:"Search for..."}),e.createElement(x.zx,{title:"Close",variant:"secondary",icon:"angle-up",className:d.closeButton,"aria-label":v.wl.components.PanelEditor.toggleVizPicker,onClick:g})),e.createElement(de.g,{className:d.customFieldMargin},e.createElement(Ie.S,{options:f,value:i,onChange:l,fullWidth:!0}))),e.createElement("div",{className:d.scrollWrapper},e.createElement(he.$,{autoHeightMin:"100%"},e.createElement("div",{className:d.scrollContent},i===w.Ok.Visualizations&&e.createElement(er,{current:a.meta,onChange:u,searchQuery:r,data:t,onClose:()=>{}}),i===w.Ok.Suggestions&&e.createElement(Ja,{current:a.meta,onChange:u,searchQuery:r,panel:n,data:t,onClose:()=>{}}),i===w.Ok.LibraryPanels&&e.createElement(Va,{searchQuery:r,panel:n,key:"Panel Library"})))))};Lt.displayName="VisualizationSelectPane";const nr=n=>({icon:p.css`
      color: ${n.v1.palette.gray33};
    `,wrapper:p.css`
      display: flex;
      flex-direction: column;
      flex: 1 1 0;
      height: 100%;
    `,vizButton:p.css`
      text-align: left;
    `,scrollWrapper:p.css`
      flex-grow: 1;
      min-height: 0;
    `,scrollContent:p.css`
      padding: ${n.spacing(1)};
    `,openWrapper:p.css`
      display: flex;
      flex-direction: column;
      flex: 1 1 100%;
      height: 100%;
      background: ${n.colors.background.primary};
      border: 1px solid ${n.colors.border.weak};
    `,searchRow:p.css`
      display: flex;
      margin-bottom: ${n.spacing(1)};
    `,closeButton:p.css`
      margin-left: ${n.spacing(1)};
    `,customFieldMargin:p.css`
      margin-bottom: ${n.spacing(1)};
    `,formBox:p.css`
      padding: ${n.spacing(1)};
      padding-bottom: 0;
    `}),ar=({plugin:n,panel:t,onFieldConfigsChange:a,onPanelOptionsChanged:r,onPanelConfigChange:s,dashboard:i,instanceState:l})=>{const c=(0,E.wW)(rr),d=(0,O.useSelector)(u=>u.panelEditor.isVizPickerOpen),{data:m}=He(t,{withTransforms:!0,withFieldConfig:!1},!0);return e.createElement("div",{className:c.wrapper,"aria-label":v.wl.components.PanelEditor.OptionsPane.content},!d&&e.createElement(e.Fragment,null,e.createElement("div",{className:c.vizButtonWrapper},e.createElement(Ge,{panel:t})),e.createElement("div",{className:c.optionsWrapper},e.createElement(wa,{panel:t,dashboard:i,plugin:n,instanceState:l,data:m,onFieldConfigsChange:a,onPanelOptionsChanged:r,onPanelConfigChange:s}))),d&&e.createElement(Lt,{panel:t,data:m}))},rr=n=>({wrapper:p.css`
      height: 100%;
      width: 100%;
      display: flex;
      flex: 1 1 0;
      flex-direction: column;
      padding: 0;
    `,optionsWrapper:p.css`
      flex-grow: 1;
      min-height: 0;
    `,vizButtonWrapper:p.css`
      padding: 0 ${n.spacing(2,2)} 0;
    `,legacyOptions:p.css`
      label: legacy-options;
      .panel-options-grid {
        display: flex;
        flex-direction: column;
      }
      .panel-options-group {
        margin-bottom: 0;
      }
      .panel-options-group__body {
        padding: ${n.spacing(2)} 0;
      }

      .section {
        display: block;
        margin: ${n.spacing(2)} 0;

        &:first-child {
          margin-top: 0;
        }
      }
    `});var Ut=o(82378),sr=o(86635),or=o(2476),ir=o(53821);function lr({width:n,height:t,panel:a,dashboard:r}){const{data:s}=He(a,{withTransforms:!0,withFieldConfig:!1},!1),[i,l]=(0,e.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});return(0,e.useEffect)(()=>{const c=(0,ue.$t)(),d=a.events.subscribe(Ut.U5,()=>{const m=(0,or.W1)(a,c.timeRange());a.runAllPanelQueries({dashboardId:r.id,dashboardUID:r.uid,dashboardTimezone:r.getTimezone(),timeData:m,width:n})});return()=>{d.unsubscribe()}},[a,r,n]),s?e.createElement(sr.fm,{width:n,height:t,padding:"none"},(c,d)=>e.createElement(e.Fragment,null,e.createElement(ir.Z,{panel:a,error:s?.error?.message}),e.createElement(Mt.$,{title:"Raw data",pluginId:"table",width:c,height:d,data:s,options:i,onOptionsChange:l}))):null}var Ft=o(32434),Je=o(40419),cr=o(94893),dr=o(85081),ur=o(69142);function zt({message:n}){const t=(0,e.useCallback)(()=>{T.E1.partial({tab:w.Ip.Query})},[]);return e.createElement(W.Ar,{justify:"center",style:{marginTop:"100px"}},e.createElement(W.wc,{spacing:"md"},e.createElement("h2",null,n),e.createElement("div",null,e.createElement(x.zx,{size:"md",variant:"secondary",icon:"arrow-left",onClick:t},"Go back to Queries"))))}var Ye=o(54899),pr=o(71657),Bt=o(67162);class mr extends e.PureComponent{constructor(){super(...arguments),this.state={stateHistoryItems:[]},this.clearHistory=async()=>{const{dashboard:t,panelId:a,onRefresh:r}=this.props;await(0,Ye.i)().post("/api/annotations/mass-delete",{dashboardId:t.id,panelId:a}),this.setState({stateHistoryItems:[]}),r()}}componentDidMount(){const{dashboard:t,panelId:a}=this.props;(0,Ye.i)().get(`/api/annotations?dashboardId=${t.id}&panelId=${a}&limit=50&type=alert`,{},`state-history-${t.id}-${a}`).then(r=>{const s=r.map(i=>({stateModel:Bt.Z.getStateDisplayModel(i.newState),time:t.formatDate(i.time,"MMM D, YYYY HH:mm:ss"),info:Bt.Z.getAlertAnnotationInfo(i)}));this.setState({stateHistoryItems:s})})}render(){const{stateHistoryItems:t}=this.state;return e.createElement("div",null,t.length>0&&e.createElement("div",{className:"p-b-1"},e.createElement("span",{className:"muted"},"Last 50 state changes"),e.createElement(pr.p,{onConfirm:this.clearHistory,confirmVariant:"destructive",confirmText:"Clear"},e.createElement(x.zx,{className:p.css`
                  direction: ltr;
                `,variant:"destructive",icon:"trash-alt"},"Clear history"))),e.createElement("ol",{className:"alert-rule-list"},t.length>0?t.map((a,r)=>e.createElement("li",{className:"alert-rule-item",key:`${a.time}-${r}`},e.createElement("div",{className:`alert-rule-item__icon ${a.stateModel.stateClass}`},e.createElement(G.J,{name:a.stateModel.iconClass,size:"xl"})),e.createElement("div",{className:"alert-rule-item__body"},e.createElement("div",{className:"alert-rule-item__header"},e.createElement("p",{className:"alert-rule-item__name"},a.alertName),e.createElement("div",{className:"alert-rule-item__text"},e.createElement("span",{className:`${a.stateModel.stateClass}`},a.stateModel.text))),a.info),e.createElement("div",{className:"alert-rule-item__time"},a.time))):e.createElement("i",null,"No state changes recorded")))}}const gr=mr;var Wt=o(61744),Xe=o(16065);class hr extends e.PureComponent{constructor(){super(...arguments),this.state={isLoading:!1,allNodesExpanded:null,testRuleResponse:{}},this.setFormattedJson=t=>{this.formattedJson=t},this.getTextForClipboard=()=>JSON.stringify(this.formattedJson,null,2),this.onToggleExpand=()=>{this.setState(t=>({...t,allNodesExpanded:!this.state.allNodesExpanded}))},this.getNrOfOpenNodes=()=>this.state.allNodesExpanded===null?3:this.state.allNodesExpanded?20:1,this.renderExpandCollapse=()=>{const{allNodesExpanded:t}=this.state,a=e.createElement(e.Fragment,null,e.createElement(G.J,{name:"minus-circle"})," Collapse All"),r=e.createElement(e.Fragment,null,e.createElement(G.J,{name:"plus-circle"})," Expand All");return t?a:r}}componentDidMount(){this.testRule()}async testRule(){const{dashboard:t,panel:a}=this.props,r=t.getSaveModelClone();r.panels=r.panels.map(l=>l.id===a.id?a.getSaveModel():l);const s={dashboard:r,panelId:a.id};this.setState({isLoading:!0});const i=await(0,Ye.i)().post("/api/alerts/test",s);this.setState({isLoading:!1,testRuleResponse:i})}render(){const{testRuleResponse:t,isLoading:a}=this.state;if(a===!0)return e.createElement(Wt.u,{text:"Evaluating rule"});const r=this.getNrOfOpenNodes();return e.createElement(e.Fragment,null,e.createElement("div",{className:"pull-right"},e.createElement(W.Lh,{spacing:"md"},e.createElement("div",{onClick:this.onToggleExpand},this.renderExpandCollapse()),e.createElement(Ve.m,{getText:this.getTextForClipboard,icon:"copy"},"Copy to Clipboard"))),e.createElement(Xe.g,{json:t,open:r,onDidRender:this.setFormattedJson}))}}var fr=o(44927);class vr extends e.PureComponent{constructor(){super(...arguments),this.state={validationMessage:"",showStateHistory:!1,showDeleteConfirmation:!1,showTestRule:!1},this.onAngularPanelUpdated=()=>{this.forceUpdate()},this.onAddAlert=()=>{this.panelCtrl?._enableAlert(),this.component?.digest(),this.forceUpdate()},this.onToggleModal=t=>{const a=this.state[t];this.setState({...this.state,[t]:!a})},this.renderTestRule=()=>{if(!this.state.showTestRule)return null;const{panel:t,dashboard:a}=this.props,r=()=>this.onToggleModal("showTestRule");return e.createElement(ne.u,{isOpen:!0,icon:"bug",title:"Testing rule",onDismiss:r,onClickBackdrop:r},e.createElement(hr,{panel:t,dashboard:a}))},this.renderDeleteConfirmation=()=>{if(!this.state.showDeleteConfirmation)return null;const{panel:t}=this.props,a=()=>this.onToggleModal("showDeleteConfirmation");return e.createElement(Nt.s,{isOpen:!0,icon:"trash-alt",title:"Delete",body:e.createElement("div",null,"Are you sure you want to delete this alert rule?",e.createElement("br",null),e.createElement("small",null,"You need to save dashboard for the delete to take effect.")),confirmText:"Delete alert",onDismiss:a,onConfirm:()=>{delete t.alert,t.thresholds=[],this.panelCtrl&&(this.panelCtrl.alertState=null,this.panelCtrl.render()),this.component?.digest(),a()}})},this.renderStateHistory=()=>{if(!this.state.showStateHistory)return null;const{panel:t,dashboard:a}=this.props,r=()=>this.onToggleModal("showStateHistory");return e.createElement(ne.u,{isOpen:!0,icon:"history",title:"State history",onDismiss:r,onClickBackdrop:r},e.createElement(gr,{dashboard:a,panelId:t.id,onRefresh:()=>this.panelCtrl?.refresh()}))}}async componentDidMount(){y.v.angularSupportEnabled?(await o.e(5718).then(o.bind(o,30789)),this.loadAlertTab()):alert("Angular support disabled, legacy alerting cannot function without angular support")}componentDidUpdate(t){this.loadAlertTab()}componentWillUnmount(){this.component&&this.component.destroy()}async loadAlertTab(){const{panel:t,angularPanelComponent:a}=this.props;if(!this.element||this.component)return;if(a){const c=a.getScope();if(!c.$$childHead){setTimeout(()=>{this.forceUpdate()});return}this.panelCtrl=c.$$childHead.ctrl}else this.panelCtrl=this.getReactAlertPanelCtrl();const r=(0,Ct.w)(),s="<alert-tab />",i={ctrl:this.panelCtrl};this.component=r.load(this.element,i,s);const l=await(0,fr.E)(t.transformations,t.targets,(0,vt.F)(),t.datasource);l&&this.setState({validationMessage:l})}getReactAlertPanelCtrl(){return{panel:this.props.panel,events:new dr.F,render:()=>{this.props.panel.render()}}}render(){const{alert:t,transformations:a}=this.props.panel,{validationMessage:r}=this.state,s=a&&a.length>0;if(!t&&r)return e.createElement(zt,{message:r});const i={title:"Panel has no alert rule defined",buttonIcon:"bell",onClick:this.onAddAlert,buttonTitle:"Create Alert"};return e.createElement(e.Fragment,null,e.createElement(he.$,{autoHeightMin:"100%"},e.createElement(W.W2,{padding:"md"},e.createElement("div",{"aria-label":v.wl.components.AlertTab.content},t&&s&&e.createElement(ee.b,{severity:O.AppNotificationSeverity.Error,title:"Transformations are not supported in alert queries"}),e.createElement("div",{ref:l=>this.element=l}),t&&e.createElement(W.Lh,null,e.createElement(x.zx,{onClick:()=>this.onToggleModal("showStateHistory"),variant:"secondary"},"State history"),e.createElement(x.zx,{onClick:()=>this.onToggleModal("showTestRule"),variant:"secondary"},"Test rule"),e.createElement(x.zx,{onClick:()=>this.onToggleModal("showDeleteConfirmation"),variant:"destructive"},"Delete")),!t&&!r&&e.createElement(ur.Z,{...i})))),this.renderTestRule(),this.renderDeleteConfirmation(),this.renderStateHistory())}}const Er=(n,t)=>({angularPanelComponent:(0,Se.i)(n,t.panel)?.angularComponent}),br={},yr=(0,I.connect)(Er,br)(vr);var Pr=o(27677),Cr=o(54408),Sr=o(41904),Tr=o(21767);const Vt=({dashboard:n,panel:t,className:a})=>{const r=(0,O.useSelector)(d=>d.templating),s=(0,ie.TH)(),{loading:i,value:l}=(0,be.Z)(()=>(0,Tr.aR)(t,n),[t,n,r]);if(i)return e.createElement(x.zx,{disabled:!0},"Create alert rule from this panel");if(!l)return e.createElement(ee.b,{severity:"info",title:"No alerting capable query found"},"Cannot create alerts from this panel because no query to an alerting capable datasource is found.");const c=Pr.Cj.renderUrl("alerting/new",{defaults:JSON.stringify(l),returnTo:s.pathname+s.search});return e.createElement(x.Qj,{icon:"bell",onClick:()=>(0,Cr.PN)(Sr.z7.alertRuleFromPanel),href:c,className:a,"data-testid":"create-alert-rule-button"},"Create alert rule from this panel")};var Dr=o(25048),Ht=o(72004),qe=o(37190),re=o(45849),kt=o(46818),xr=o(61627),Kt=o(69945);function Qt({dashboard:n,panel:t,poll:a=!1}){const r=(0,O.useDispatch)(),s=(0,Kt._)(u=>u.promRules[re.GC])??kt.oq,i=(0,Kt._)(u=>u.rulerRules[re.GC])??kt.oq;(0,e.useEffect)(()=>{const u=()=>{r((0,Ht.y6)({rulesSourceName:re.GC,filter:{dashboardUID:n.uid,panelId:t.id}})),r((0,Ht.UR)({rulesSourceName:re.GC,filter:{dashboardUID:n.uid,panelId:t.id}}))};if(u(),a){const g=setInterval(u,qe.p4);return()=>{clearInterval(g)}}return()=>{}},[r,a,t.id,n.uid]);const l=s.loading||i.loading,c=[s.error,i.error].filter(u=>!!u),d=(0,xr.Zo)(re.GC);return{rules:(0,e.useMemo)(()=>d.flatMap(u=>u.groups).flatMap(u=>u.rules).filter(u=>u.annotations[qe.q6.dashboardUID]===n.uid&&u.annotations[qe.q6.panelID]===String(t.id)),[d,n,t]),errors:c,loading:l}}var Zt=o(97953);const Or=({dashboard:n,panel:t})=>{const a=(0,E.wW)(wr),{errors:r,loading:s,rules:i}=Qt({dashboard:n,panel:t,poll:!0}),l=(0,Zt.Bz)("grafana"),c=le.Vt.hasPermission(l.create),d=r.length?e.createElement(ee.b,{title:"Errors loading rules",severity:"error"},r.map((m,u)=>e.createElement("div",{key:u},"Failed to load Grafana rules state: ",m.message||"Unknown error."))):null;return s&&!i.length?e.createElement("div",{className:a.innerWrapper},d,e.createElement(Wt.u,{text:"Loading rules..."})):i.length?e.createElement(he.$,{autoHeightMin:"100%"},e.createElement("div",{className:a.innerWrapper},d,e.createElement(Dr.i,{rules:i}),!!n.meta.canSave&&c&&e.createElement(Vt,{className:a.newButton,panel:t,dashboard:n}))):e.createElement("div",{"aria-label":v.wl.components.PanelAlertTabContent.content,className:a.noRulesWrapper},d,!!n.uid&&e.createElement(e.Fragment,null,e.createElement("p",null,"There are no alert rules linked to this panel."),!!n.meta.canSave&&c&&e.createElement(Vt,{panel:t,dashboard:n})),!n.uid&&!!n.meta.canSave&&e.createElement(ee.b,{severity:"info",title:"Dashboard not saved"},"Dashboard must be saved before alerts can be added."))},wr=n=>({newButton:p.css`
    margin-top: ${n.spacing(3)};
  `,innerWrapper:p.css`
    padding: ${n.spacing(2)};
  `,noRulesWrapper:p.css`
    margin: ${n.spacing(2)};
    background-color: ${n.colors.background.secondary};
    padding: ${n.spacing(3)};
  `}),Ir=y.v.unifiedAlertingEnabled?Or:yr,Rr=({panel:n,dashboard:t,...a})=>{const{rules:r,loading:s}=Qt({panel:n,dashboard:t});return e.createElement(ce.O,{...a,counter:s?null:r.length})};var Gt=o(19677),_e=o(20256),$e=o(80548),Le=o(72948),Nr=o(59796);const Mr={[$e.x.Transformations]:"https://grafana.com/docs/grafana/latest/panels/transformations",[$e.x.FieldConfig]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/",[$e.x.FieldConfigOverrides]:"https://grafana.com/docs/grafana/latest/panels/field-configuration-options/#override-a-field"},Ar=n=>Mr[n];var jt=o(81731),Jt=o(86253),$r=o(85854),Lr=o(19117),fe=o(1029),Ur=o(67254),Fr=o(98356),zr=o(3249),et=o(79720);const Br=({debugMode:n,index:t,data:a,uiConfig:r,configs:s,onChange:i})=>{const l=(0,E.wW)(Wr),[c,d]=(0,e.useState)([]),[m,u]=(0,e.useState)([]),g=(0,e.useMemo)(()=>s[t],[s,t]);(0,e.useEffect)(()=>{const h=s[t].transformation,b=h.filter?.options?(0,zr.b9)(h.filter):void 0,C=s.slice(0,t).map(V=>V.transformation),F=s.slice(t,t+1).map(V=>V.transformation),P=(0,et.H)(C,a).subscribe(V=>{b&&(V=a.filter(L=>b(L))),d(V)}),S=(0,et.H)(C,a).pipe((0,Fr.z)(V=>(0,et.H)(F,V))).subscribe(u);return function(){P.unsubscribe(),S.unsubscribe()}},[t,a,s]);const f=(0,e.useMemo)(()=>e.createElement(r.editor,{options:{...r.transformation.defaultOptions,...g.transformation.options},input:c,onChange:h=>{i(t,{...g.transformation,options:h})}}),[r.editor,r.transformation.defaultOptions,g.transformation,c,i,t]);return e.createElement("div",{className:l.editor,"aria-label":v.wl.components.TransformTab.transformationEditor(r.name)},f,n&&e.createElement("div",{className:l.debugWrapper,"aria-label":v.wl.components.TransformTab.transformationEditorDebugger(r.name)},e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Transformation input data"),e.createElement("div",{className:l.debugJson},e.createElement(Xe.g,{json:c}))),e.createElement("div",{className:l.debugSeparator},e.createElement(G.J,{name:"arrow-right"})),e.createElement("div",{className:l.debug},e.createElement("div",{className:l.debugTitle},"Transformation output data"),e.createElement("div",{className:l.debugJson},m&&e.createElement(Xe.g,{json:m})))))},Wr=n=>{const t=n.isLight?n.v1.palette.gray85:n.v1.palette.gray15;return{title:p.css`
      display: flex;
      padding: 4px 8px 4px 8px;
      position: relative;
      height: 35px;
      border-radius: 4px 4px 0 0;
      flex-wrap: nowrap;
      justify-content: space-between;
      align-items: center;
    `,name:p.css`
      font-weight: ${n.typography.fontWeightMedium};
      color: ${n.colors.primary.text};
    `,iconRow:p.css`
      display: flex;
    `,icon:p.css`
      background: transparent;
      border: none;
      box-shadow: none;
      cursor: pointer;
      color: ${n.colors.text.secondary};
      margin-left: ${n.spacing(1)};
      &:hover {
        color: ${n.colors.text};
      }
    `,editor:p.css``,debugWrapper:p.css`
      display: flex;
      flex-direction: row;
    `,debugSeparator:p.css`
      width: 48px;
      min-height: 300px;
      display: flex;
      align-items: center;
      align-self: stretch;
      justify-content: center;
      margin: 0 ${n.spacing(.5)};
      color: ${n.colors.primary.text};
    `,debugTitle:p.css`
      padding: ${n.spacing(1)} ${n.spacing(.25)};
      font-family: ${n.typography.fontFamilyMonospace};
      font-size: ${n.typography.bodySmall.fontSize};
      color: ${n.colors.text};
      border-bottom: 1px solid ${t};
      flex-grow: 0;
      flex-shrink: 1;
    `,debug:p.css`
      margin-top: ${n.spacing(1)};
      padding: 0 ${n.spacing(1,1,1)};
      border: 1px solid ${t};
      background: ${n.isLight?n.v1.palette.white:n.v1.palette.gray05};
      border-radius: ${n.shape.borderRadius(1)};
      width: 100%;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-self: stretch;
    `,debugJson:p.css`
      flex-grow: 1;
      height: 100%;
      overflow: hidden;
      padding: ${n.spacing(.5)};
    `}};var Vr=o(92465);const Hr=({index:n,data:t,config:a,onChange:r})=>{const s=(0,E.wW)(kr),i=(0,e.useMemo)(()=>({data:t}),[t]);return e.createElement("div",{className:s.wrapper},e.createElement("h5",null,"Apply tranformation to"),e.createElement(Vr.M,{value:a.filter,context:i,item:{},onChange:l=>r(n,{...a,filter:l})}))},kr=n=>{const t=n.shape.borderRadius();return{wrapper:p.css`
      padding: ${n.spacing(2)};
      border: 2px solid ${n.colors.background.secondary};
      border-top: none;
      border-radius: 0 0 ${t} ${t};
      position: relative;
      top: -4px;
    `}},Kr=({onRemove:n,index:t,id:a,data:r,configs:s,uiConfig:i,onChange:l})=>{const[c,d]=(0,Jt.Z)(!1),[m,u]=(0,Jt.Z)(!1),g=s[t].transformation.disabled,f=s[t].transformation.filter!=null,h=f||r.length>1,b=(0,e.useCallback)(P=>{const S=s[P].transformation;l(P,{...S,disabled:S.disabled?void 0:!0})},[l,s]),C=(0,e.useCallback)(()=>{let P={...s[t].transformation};P.filter?delete P.filter:P.filter={id:$r.E4.byRefId,options:""},l(t,P)},[l,t,s]),F=({isOpen:P})=>e.createElement(W.Lh,{align:"center",width:"auto"},i.state&&e.createElement(jt.u,{state:i.state}),e.createElement(fe.y,{title:"Show/hide transform help",icon:"info-circle",onClick:u,active:m}),h&&e.createElement(fe.y,{title:"Filter",icon:"filter",onClick:C,active:f}),e.createElement(fe.y,{title:"Debug",disabled:!P,icon:"bug",onClick:d,active:c}),e.createElement(fe.y,{title:"Disable/Enable transformation",icon:g?"eye-slash":"eye",onClick:()=>b(t),active:g}),e.createElement(fe.y,{title:"Remove",icon:"trash-alt",onClick:()=>n(t)}));return e.createElement(Ur.t,{id:a,index:t,title:i.name,draggable:!0,actions:F,disabled:g},m&&e.createElement(Lr.h,{markdown:Qr(i)}),f&&e.createElement(Hr,{index:t,config:s[t].transformation,data:r,onChange:l}),e.createElement(Br,{debugMode:c,index:t,data:r,configs:s,uiConfig:i,onChange:l}))};function Qr(n){return`
${n.help??n.description}

Go the <a href="https://grafana.com/docs/grafana/latest/panels/transformations/?utm_source=grafana" target="_blank" rel="noreferrer">
transformation documentation
</a> for more.
`}const Zr=({data:n,onChange:t,onRemove:a,configs:r})=>e.createElement(e.Fragment,null,r.map((s,i)=>{const l=_e.Z.getIfExists(s.transformation.id);return l?e.createElement(Kr,{index:i,id:`${s.id}`,key:`${s.id}`,data:n,configs:r,uiConfig:l,onRemove:a,onChange:t}):null})),Gr="dashboard.components.TransformationEditor.featureInfoBox.isDismissed";class jr extends e.PureComponent{constructor(t){super(t),this.onSearchChange=s=>{this.setState({search:s.target.value})},this.onSearchKeyDown=s=>{if(s.key==="Enter"){const{search:i}=this.state;if(i){const l=i.toLowerCase(),c=_e.Z.list().filter(d=>(d.name+d.description).toLowerCase().indexOf(l)>=0);c.length>0&&this.onTransformationAdd({value:c[0].id})}}else s.keyCode===27&&(this.setState({search:"",showPicker:!1}),s.stopPropagation())},this.getTransformationNextId=s=>{const{transformations:i}=this.state;let l=0;const c=i.filter(d=>d.id.startsWith(s)).map(d=>d.id);return c.length!==0&&(l=Math.max(...c.map(d=>parseInt(d.match(/\d+/)[0],10)))+1),`${s}-${l}`},this.onTransformationAdd=s=>{const{transformations:i}=this.state,l=this.getTransformationNextId(s.value);this.setState({search:"",showPicker:!1}),this.onChange([...i,{id:l,transformation:{id:s.value,options:{}}}])},this.onTransformationChange=(s,i)=>{const{transformations:l}=this.state,c=Array.from(l);c[s].transformation=i,this.onChange(c)},this.onTransformationRemove=s=>{const{transformations:i}=this.state,l=Array.from(i);l.splice(s,1),this.onChange(l)},this.onDragEnd=s=>{const{transformations:i}=this.state;if(!s||!s.destination)return;const l=s.source.index,c=s.destination.index;if(l===c)return;const d=Array.from(i),[m]=d.splice(l,1);d.splice(c,0,m),this.onChange(d)},this.renderTransformationEditors=()=>{const{data:s,transformations:i}=this.state;return e.createElement(Gt.Z5,{onDragEnd:this.onDragEnd},e.createElement(Gt.bK,{droppableId:"transformations-list",direction:"vertical"},l=>e.createElement("div",{ref:l.innerRef,...l.droppableProps},e.createElement(Zr,{configs:i,data:s,onRemove:this.onTransformationRemove,onChange:this.onTransformationChange}),l.placeholder)))};const a=t.panel.transformations||[],r=this.buildTransformationIds(a);this.state={transformations:a.map((s,i)=>({transformation:s,id:r[i]})),data:[],search:""}}buildTransformationIds(t){const a={},r=[];for(let s=0;s<t.length;s++){const i=t[s];a[i.id]===void 0?a[i.id]=0:a[i.id]+=1,r.push(`${t[s].id}-${a[t[s].id]}`)}return r}componentDidMount(){this.subscription=this.props.panel.getQueryRunner().getData({withTransforms:!1,withFieldConfig:!1}).subscribe({next:t=>this.setState({data:t.series})})}componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}onChange(t){this.setState({transformations:t}),this.props.panel.setTransformations(t.map(a=>a.transformation))}renderTransformsPicker(){const{transformations:t,search:a}=this.state;let r=null,s=_e.Z.list().sort((c,d)=>c.name>d.name?1:d.name>c.name?-1:0);if(a){const c=a.toLowerCase(),d=s.filter(m=>(m.name+m.description).toLowerCase().indexOf(c)>=0);r=e.createElement(e.Fragment,null,d.length," / ",s.length," \xA0\xA0",e.createElement(Ae.h,{name:"times",onClick:()=>{this.setState({search:""})}})),s=d}const i=!t?.length,l=i||this.state.showPicker;return!r&&l&&!i&&(r=e.createElement(Ae.h,{name:"times",onClick:()=>{this.setState({showPicker:!1})}})),e.createElement(e.Fragment,null,i&&e.createElement(W.W2,{grow:1},e.createElement(Nr.G,{storageKey:Gr,defaultValue:!1},(c,d)=>c?null:e.createElement(ee.b,{title:"Transformations",severity:"info",onRemove:()=>{d(!0)}},e.createElement("p",null,"Transformations allow you to join, calculate, re-order, hide, and rename your query results before they are visualized. ",e.createElement("br",null),"Many transforms are not suitable if you're using the Graph visualization, as it currently only supports time series data. ",e.createElement("br",null),"It can help to switch to the Table visualization to understand what a transformation is doing."," "),e.createElement("a",{href:Ar($e.x.Transformations),className:"external-link",target:"_blank",rel:"noreferrer"},"Read more")))),l?e.createElement(W.wc,null,e.createElement(ye.I,{"aria-label":v.wl.components.Transforms.searchInput,value:a??"",autoFocus:!i,placeholder:"Add transformation",onChange:this.onSearchChange,onKeyDown:this.onSearchKeyDown,suffix:r}),s.map(c=>e.createElement(Jr,{key:c.name,transform:c,onClick:()=>{this.onTransformationAdd({value:c.id})}}))):e.createElement(x.zx,{icon:"plus",variant:"secondary",onClick:()=>{this.setState({showPicker:!0})}},"Add transformation"))}render(){const{panel:{alert:t}}=this.props,{transformations:a}=this.state,r=a.length>0;return!r&&t?e.createElement(zt,{message:"Transformations can't be used on a panel with existing alerts"}):e.createElement(he.$,{autoHeightMin:"100%"},e.createElement(W.W2,{padding:"md"},e.createElement("div",{"aria-label":v.wl.components.TransformTab.content},r&&t?e.createElement(ee.b,{severity:O.AppNotificationSeverity.Error,title:"Transformations can't be used on a panel with alerts"}):null,r&&this.renderTransformationEditors(),this.renderTransformsPicker())))}}function Jr({transform:n,onClick:t}){const a=(0,E.wW)(Yr);return e.createElement(Le.Z,{className:a.card,"aria-label":v.wl.components.TransformTab.newTransform(n.name),onClick:t},e.createElement(Le.Z.Heading,null,n.name),e.createElement(Le.Z.Description,null,n.description),n.state&&e.createElement(Le.Z.Tags,null,e.createElement(jt.u,{state:n.state})))}const Yr=n=>({card:p.css`
      margin: 0;
      padding: ${n.spacing(1)};
    `}),Xr=(0,E.Zz)(jr);var qr=o(5916),Yt=o(91162),_r=o(98016);class es extends e.PureComponent{constructor(t){super(t),this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{T.E1.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:r}=this.props;r.updateQueries(a),a.dataSource.uid!==r.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(t){const a=t.datasource??{default:!0},r=(0,Yt.ak)().getInstanceSettings(a);return{cacheTimeout:r?.meta.queryOptions?.cacheTimeout?t.cacheTimeout:void 0,dataSource:{default:r?.isDefault,type:r?.type,uid:r?.uid},queries:t.targets,maxDataPoints:t.maxDataPoints,minInterval:t.interval,savedQueryUid:t.savedQueryLink?.ref.uid??null,timeRange:{from:t.timeFrom,shift:t.timeShift,hide:t.hideTimeOverride}}}async componentDidMount(){const{panel:t}=this.props;if(!t.datasource){const a=(0,Yt.ak)().getInstanceSettings(null);t.datasource=(0,qr.iU)(a),this.forceUpdate()}}render(){const{panel:t}=this.props;if(!t.datasource)return null;const a=this.buildQueryOptions(t);return e.createElement(_r.D,{options:a,queryRunner:t.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const Xt=e.memo(({panel:n,dashboard:t,tabs:a,onChangeTab:r})=>{const s=(0,Ft.N)(),i=(0,E.wW)(ns);(0,e.useEffect)(()=>{const c=new Et.w0;return c.add(n.events.subscribe(U.pO,s)),c.add(n.events.subscribe(U.Xw,s)),()=>c.unsubscribe()},[n,t,s]);const l=a.find(c=>c.active);return a.length===0?null:e.createElement("div",{className:i.wrapper},e.createElement(We.J,{className:i.tabBar,hideBorder:!0},a.map(c=>c.id===w.Ip.Alert?ts(c,n,t,r):e.createElement(ce.O,{key:c.id,label:c.text,active:c.active,onChangeTab:()=>r(c),icon:(0,Je.toIconName)(c.icon),counter:qt(n,c)}))),e.createElement(cr.I,{className:i.tabContent},l.id===w.Ip.Query&&e.createElement(es,{panel:n,queries:n.targets}),l.id===w.Ip.Alert&&e.createElement(Ir,{panel:n,dashboard:t}),l.id===w.Ip.Transform&&e.createElement(Xr,{panel:n})))});Xt.displayName="PanelEditorTabs";function qt(n,t){switch(t.id){case w.Ip.Query:return n.targets.length;case w.Ip.Alert:return n.alert?1:0;case w.Ip.Transform:return(n.getTransformations()??[]).length}return null}function ts(n,t,a,r){return!y.v.alertingEnabled&&!y.v.unifiedAlertingEnabled?null:y.v.unifiedAlertingEnabled?e.createElement(Rr,{key:n.id,label:n.text,active:n.active,onChangeTab:()=>r(n),icon:(0,Je.toIconName)(n.icon),panel:t,dashboard:a}):y.v.alertingEnabled?e.createElement(ce.O,{key:n.id,label:n.text,active:n.active,onChangeTab:()=>r(n),icon:(0,Je.toIconName)(n.icon),counter:qt(t,n)}):null}const ns=n=>({wrapper:p.css`
      display: flex;
      flex-direction: column;
      height: 100%;
    `,tabBar:p.css`
      padding-left: ${n.spacing(2)};
    `,tabContent:p.css`
      padding: 0;
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      min-height: 0;
      background: ${n.colors.background.primary};
      border: 1px solid ${n.components.panel.borderColor};
      border-left: none;
      border-bottom: none;
      border-top-right-radius: ${n.shape.borderRadius(1.5)};
    `});var as=o(58635),rs=o(47694);const ss=(0,as.Z)((n,t)=>{const a=[];if(!t)return a;let r=w.Ip.Visualize;if(t.meta.skipDataQuery)return[];t.meta.skipDataQuery||(r=w.Ip.Query,a.push({id:w.Ip.Query,text:"Query",icon:"database",active:!1}),a.push({id:w.Ip.Transform,text:"Transform",icon:"process",active:!1}));const{alertingEnabled:s,unifiedAlertingEnabled:i}=(0,rs.iE)(),l=le.Vt.hasPermission((0,Zt.Bz)(re.GC).read),c=s||i&&l,d=t.meta.id==="graph",m=t.meta.id==="timeseries";(c&&d||m)&&a.push({id:w.Ip.Alert,text:"Alert",icon:"bell",active:!1});const u=a.find(g=>g.id===(n||r))??a[0];return u.active=!0,a}),os=(n,t)=>{const a=n.panelEditor.getPanel(),r=(0,Se.i)(n,a);return{panel:a,plugin:r?.plugin,instanceState:r?.instanceState,initDone:n.panelEditor.initDone,uiState:n.panelEditor.ui,tableViewEnabled:n.panelEditor.tableViewEnabled,variables:(0,Qe.gt)(t.dashboard.uid,n)}},is={initPanelEditor:dn,discardPanelChanges:lt,updatePanelEditorUIState:Be,updateTimeZoneForSession:qn.YT,toggleTableView:Y.OT,notifyApp:M.$l},ls=(0,I.connect)(os,is);class cs extends e.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{T.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{jn.h$.publish(new U.Dn({component:na.d,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,ge.V)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=t=>{T.E1.partial({tab:t.id})},this.onFieldConfigChange=t=>{this.props.panel.updateFieldConfig({...t})},this.onPanelOptionsChanged=t=>{this.props.panel.updateOptions(t)},this.onPanelConfigChanged=(t,a)=>{this.props.panel.setProperty(t,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=t=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:t})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{T.E1.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:t,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new Et.w0,this.eventSubs.add(t.events.subscribe(U.Wj,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(t,a){const{dashboard:r,panel:s,uiState:i,tableViewEnabled:l,theme:c}=this.props;return e.createElement("div",{className:t.mainPaneWrapper,key:"panel"},this.renderPanelToolbar(t),e.createElement("div",{className:t.panelWrapper},e.createElement(Te.Z,null,({width:d,height:m})=>{if(d<3||m<3)return null;if(a&&(m-=c.spacing.gridSize*2),l)return e.createElement(lr,{width:d,height:m,panel:s,dashboard:r});const u=(0,ke.jF)(i.mode,d,m,s);return e.createElement("div",{className:t.centeringContainer,style:{width:d,height:m}},e.createElement("div",{style:u,"data-panelid":s.id},e.createElement(ea.l,{key:s.key,stateKey:s.key,dashboard:r,panel:s,isEditing:!0,isViewing:!1,lazy:!1,width:u.width,height:u.height})))})))}renderPanelAndEditor(t,a){const{panel:r,dashboard:s,plugin:i,tab:l}=this.props,c=ss(l,i),d=c.length===0,m=this.renderPanel(a,d);return c.length===0?e.createElement("div",{className:a.onlyPanel},m):e.createElement(bt.U,{splitOrientation:"horizontal",maxSize:-200,paneSize:t.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:u=>{u&&Be({topPaneSize:u/window.innerHeight})}},m,e.createElement("div",{className:a.tabsWrapper,"aria-label":v.wl.components.PanelEditor.DataPane.content,key:"panel-editor-tabs"},e.createElement(Xt,{key:r.key,panel:r,dashboard:s,tabs:c,onChangeTab:this.onChangeTab})))}renderTemplateVariables(t){const{variables:a}=this.props;return a.length?e.createElement("div",{className:t.variablesWrapper},e.createElement(yt,{variables:a})):null}renderPanelToolbar(t){const{dashboard:a,uiState:r,variables:s,updateTimeZoneForSession:i,panel:l,tableViewEnabled:c}=this.props;return e.createElement("div",{className:t.panelToolbar},e.createElement(W.Lh,{justify:s.length>0?"space-between":"flex-end",align:"flex-start"},this.renderTemplateVariables(t),e.createElement(De.Stack,{gap:1},e.createElement(ae.x,{label:"Table view",showLabel:!0,id:"table-view",value:c,onClick:this.onToggleTableView,"aria-label":v.wl.components.PanelEditor.toggleTableView}),e.createElement(Ie.S,{value:r.mode,options:w.d7,onChange:this.onDisplayModeChange}),e.createElement(ta.C,{dashboard:a,onChangeTimeZone:i,isOnCanvas:!0}),!r.isPanelOptionsVisible&&e.createElement(Ge,{panel:l}))))}renderEditorActions(){const t=y.v.featureToggles.topnav?"sm":"md";let a=[e.createElement(x.zx,{onClick:this.onDiscard,title:"Undo all changes",key:"discard",size:t,variant:"destructive",fill:"outline"},"Discard"),this.props.panel.libraryPanel?e.createElement(x.zx,{onClick:this.onSaveLibraryPanel,variant:"primary",size:t,title:"Apply changes and save library panel",key:"save-panel"},"Save library panel"):e.createElement(x.zx,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",key:"save",size:t,variant:"secondary"},"Save"),e.createElement(x.zx,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":v.wl.components.PanelEditor.applyButton,key:"apply",size:t},"Apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,e.createElement(st.JY,{key:"unlink-controller"},({showModal:r,hideModal:s})=>e.createElement(Re.h,{onClick:()=>{r(_n.i,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:s,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",key:"unlink"},"Unlink"))),a.pop()),a}renderOptionsPane(){const{plugin:t,dashboard:a,panel:r,instanceState:s}=this.props;return t?e.createElement(ar,{plugin:t,dashboard:a,panel:r,instanceState:s,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):e.createElement("div",null)}renderToolbar(){return y.v.featureToggles.topnav?e.createElement(Gn.A,{actions:e.createElement(Kn.R,{alignment:"right"},this.renderEditorActions())}):e.createElement(Qn.X,{title:this.props.dashboard.title,section:"Edit Panel",onGoBack:this.onGoBackToDashboard},this.renderEditorActions())}render(){const{initDone:t,uiState:a,theme:r,sectionNav:s,pageNav:i,className:l,updatePanelEditorUIState:c}=this.props,d=us(r,this.props);return t?e.createElement(D.T,{navModel:s,pageNav:i,"aria-label":v.wl.components.PanelEditor.General.content,layout:N.Qz.Custom,toolbar:this.renderToolbar(),className:l},e.createElement("div",{className:d.wrapper},e.createElement("div",{className:d.verticalSplitPanesWrapper},a.isPanelOptionsVisible?e.createElement(bt.U,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:m=>{m&&c({rightPaneSize:m/window.innerWidth})}},this.renderPanelAndEditor(a,d),this.renderOptionsPane()):this.renderPanelAndEditor(a,d)),this.state.showSaveLibraryPanelModal&&e.createElement(ot,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel}))):null}}const ds=(0,E.HE)(ls(cs)),us=(0,Zn.B)((n,t)=>{const{uiState:a}=t,r=n.spacing(2);return{wrapper:(0,p.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:y.v.featureToggles.topnav?n.spacing(2):0}),verticalSplitPanesWrapper:p.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      position: relative;
    `,mainPaneWrapper:p.css`
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
      padding-right: ${a.isPanelOptionsVisible?0:r};
    `,variablesWrapper:p.css`
      label: variablesWrapper;
      display: flex;
      flex-grow: 1;
      flex-wrap: wrap;
      gap: ${n.spacing(1,2)};
    `,panelWrapper:p.css`
      flex: 1 1 0;
      min-height: 0;
      width: 100%;
      padding-left: ${r};
    `,tabsWrapper:p.css`
      height: 100%;
      width: 100%;
    `,panelToolbar:p.css`
      display: flex;
      padding: 0 0 ${r} ${r};
      justify-content: space-between;
      flex-wrap: wrap;
    `,toolbarLeft:p.css`
      padding-left: ${n.spacing(1)};
    `,centeringContainer:p.css`
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      flex-direction: column;
    `,onlyPanel:p.css`
      height: 100%;
      position: absolute;
      overflow: hidden;
      width: 100%;
    `}});var ps=o(11543),ms=o(81764),gs=o(8861),hs=o(87865);const fs=({annotation:n,events:t,onEnabledChanged:a})=>{const[r,s]=(0,e.useState)(!1),i=(0,E.wW)(vs),l=()=>(0,hs.kt)().cancel(n);return(0,e.useEffect)(()=>{const c=t.getStream(U.z).subscribe({next:m=>{m.payload===n&&s(!0)}}),d=t.getStream(U.RB).subscribe({next:m=>{m.payload===n&&s(!1)}});return()=>{c.unsubscribe(),d.unsubscribe()}}),e.createElement("div",{key:n.name,className:i.annotation},e.createElement(ps.Z,null,e.createElement(ms._,{label:n.name,disabled:r},e.createElement(ae.x,{value:n.enable,onChange:()=>a(n),disabled:r})),e.createElement("div",{className:i.indicator},e.createElement(gs.T,{loading:r,onCancel:l}))))};function vs(n){return{annotation:p.css`
      display: inline-block;
      margin-right: ${n.spacing(1)};

      .fa-caret-down {
        font-size: 75%;
        padding-left: ${n.spacing(1)};
      }

      .gf-form-inline .gf-form {
        margin-bottom: 0;
      }
    `,indicator:p.css`
      align-self: center;
      padding: 0 ${n.spacing(.5)};
    `}}const Es=({annotations:n,onAnnotationChanged:t,events:a})=>{const[r,s]=(0,e.useState)([]);return(0,e.useEffect)(()=>{s(n.filter(i=>i.hide!==!0))},[n]),r.length===0?null:e.createElement(e.Fragment,null,r.map(i=>e.createElement(fs,{events:a,annotation:i,onEnabledChanged:t,key:i.name})))};var bs=o(58252),tt=o(68004),ys=o(18428),Ps=o(29930);const Cs=n=>{const{link:t,linkInfo:a}=n,r=(0,e.useRef)(null),[s,i]=(0,e.useState)("invisible"),[l,c]=(0,e.useState)(0),d=Ss(n,l),m=(0,E.wW)(Os);return(0,e.useLayoutEffect)(()=>{i(xs(r.current))},[d]),t.asDropdown?e.createElement(_t,{link:t,key:"dashlinks-dropdown","data-testid":v.wl.components.DashboardLinks.dropDown},e.createElement(e.Fragment,null,e.createElement(Re.h,{onClick:()=>c(Date.now()),className:(0,p.cx)("gf-form-label gf-form-label--dashlink",m.button),"data-placement":"bottom","data-toggle":"dropdown","aria-expanded":!!l,"aria-controls":"dropdown-list","aria-haspopup":"menu"},e.createElement(G.J,{"aria-hidden":!0,name:"bars",className:m.iconMargin}),e.createElement("span",null,a.title)),e.createElement("ul",{id:"dropdown-list",className:`dropdown-menu ${m.dropdown} ${s}`,role:"menu",ref:r},d.length>0&&d.map((u,g)=>e.createElement("li",{role:"none",key:`dashlinks-dropdown-item-${u.uid}-${g}`},e.createElement("a",{role:"menuitem",href:u.url,target:t.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":v.wl.components.DashboardLinks.link,"aria-label":`${u.title} dashboard`},u.title)))))):e.createElement(e.Fragment,null,d.length>0&&d.map((u,g)=>e.createElement(_t,{link:t,key:`dashlinks-list-item-${u.uid}-${g}`,"data-testid":v.wl.components.DashboardLinks.container},e.createElement("a",{className:"gf-form-label gf-form-label--dashlink",href:u.url,target:t.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":v.wl.components.DashboardLinks.link,"aria-label":`${u.title} dashboard`},e.createElement(G.J,{"aria-hidden":!0,name:"apps",style:{marginRight:"4px"}}),e.createElement("span",null,u.title)))))},_t=n=>{const{link:t,children:a,...r}=n;return e.createElement("div",{...r,className:"gf-form"},t.tooltip&&e.createElement(me.u,{content:t.tooltip},a),!t.tooltip&&e.createElement(e.Fragment,null,a))},Ss=({link:n,dashboardUID:t},a)=>{const{tags:r}=n,s=(0,be.Z)(()=>Ts(r),[r,a]);return s.value?Ds(t,n,s.value):[]};async function Ts(n,t={getBackendSrv:Ps.i}){return await t.getBackendSrv().search({tag:n,limit:100})}function Ds(n,t,a,r={getLinkSrv:Me.Bq,sanitize:tt.Nw,sanitizeUrl:tt.Nm}){return a.filter(s=>s.uid!==n).map(s=>{const i=s.uid,l=r.sanitize(s.title),c=r.getLinkSrv().getLinkUrl({...t,url:s.url}),d=r.sanitizeUrl(c);return{uid:i,title:l,url:d}})}function xs(n){if(!n)return"invisible";const t=n.parentElement.getBoundingClientRect(),a=n.getBoundingClientRect();return a.width===0?"invisible":t.left+a.width+10>window.innerWidth?"pull-left":"pull-right"}function Os(n){return{iconMargin:(0,p.css)({marginRight:n.spacing(.5)}),dropdown:(0,p.css)({maxWidth:"max(30vw, 300px)",maxHeight:"70vh",overflowY:"auto",a:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}),button:(0,p.css)({color:n.colors.text.primary})}}const ws=({dashboard:n,links:t})=>{const a=(0,Ft.N)();return(0,bs.Z)(()=>{const r=n.events.subscribe(Ut.md,a);return()=>r.unsubscribe()}),t.length?e.createElement(e.Fragment,null,t.map((r,s)=>{const i=(0,Me.Bq)().getAnchorInfo(r),l=`${r.title}-$${s}`;if(r.type==="dashboards")return e.createElement(Cs,{key:l,link:r,linkInfo:i,dashboardUID:n.uid});const c=ys.xy[r.icon],d=e.createElement("a",{className:"gf-form-label gf-form-label--dashlink",href:(0,tt.Nm)(i.href),target:r.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":v.wl.components.DashboardLinks.link},c&&e.createElement(G.J,{"aria-hidden":!0,name:c,style:{marginRight:"4px"}}),e.createElement("span",null,i.title));return e.createElement("div",{key:l,className:"gf-form","data-testid":v.wl.components.DashboardLinks.container},r.tooltip?e.createElement(me.u,{content:i.tooltip},d):d)})):null};class Is extends e.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=t=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const r=this.props.dashboard.annotations.list[a];if(r.name===t.name){r.enable=!r.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()}}render(){const{dashboard:t,variables:a,links:r,annotations:s}=this.props;if(!t.isSubMenuVisible())return null;const i=t.meta.isSnapshot??!1;return e.createElement("div",{className:"submenu-controls"},e.createElement("form",{"aria-label":"Template variables",className:Ns},e.createElement(yt,{variables:a,readOnly:i})),e.createElement(Es,{annotations:s,onAnnotationChanged:this.onAnnotationStateChanged,events:t.events}),e.createElement("div",{className:"gf-form gf-form--grow"}),t&&e.createElement(ws,{dashboard:t,links:r}))}}const Rs=(n,t)=>{const{uid:a}=t.dashboard,r=(0,Qe.AE)(a,n);return{variables:(0,Qe.IV)(a,r.variables)}},Ns=p.css`
  display: flex;
  flex-wrap: wrap;
  display: contents;
`,en=(0,I.connect)(Rs)(Is);en.displayName="SubMenu";var Ms=o(56130),As=o(6911),$s=o(86977);const tn=n=>({initPhase:n.dashboard.initPhase,initError:n.dashboard.initError,dashboard:n.dashboard.getModel(),navIndex:n.navIndex}),Ls={initDashboard:Oe.mV,cleanUpDashboardAndVariables:$s.lw,notifyApp:M.$l,cancelVariables:Ee.wX,templateVarsChangedInUrl:Ee.xs},Us=(0,I.connect)(tn,Ls);class nt extends e.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let t;this.props.dashboard?.liveNow&&(t=(0,ue.$t)().timeRange()),As.A.setLiveTimeRange(t)},this.onAddPanel=()=>{const{dashboard:t}=this.props;if(!t||t.panels.length>0&&t.panels[0].type==="add-panel")return;const a=8;for(const r of t.panelIterator())r.gridPos.y+=a;t.addPanel({type:"add-panel",gridPos:{x:0,y:0,w:12,h:a},title:"Panel Title"}),this.setState({updateScrollTop:0})},this.setScrollRef=t=>{this.setState({scrollElement:t})}}getCleanState(){return{editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:t,match:a,queryParams:r}=this.props;t&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.params.slug,urlUid:a.params.uid,urlType:a.params.type,urlFolderUid:r.folderUid,panelType:r.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(t,a){const{dashboard:r,match:s,templateVarsChangedInUrl:i}=this.props,l=this.props.history.location.state?.routeReloadCounter;if(r){if(t.match.params.uid!==s.params.uid||l!==void 0&&this.forceRouteReloadCounter!==l){this.initDashboard(),this.forceRouteReloadCounter=l;return}if(t.location.search!==this.props.location.search){const c=t.queryParams,d=this.props.queryParams;(d?.from!==c?.from||d?.to!==c?.to)&&((0,ue.$t)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!c?.refresh&&d?.refresh&&(0,ue.$t)().setAutoRefresh(d.refresh);const m=(0,rt.xT)(this.props.queryParams,t.queryParams);m&&i(r.uid,m)}this.state.editPanel&&!a.editPanel&&(R.H.setEditingState(!0),this.props.dashboard?.events.publish(new U.xF(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(R.H.setEditingState(!1),this.props.dashboard?.events.publish(new U.Yr(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,K.t_)("Permission to edit panel denied")),T.E1.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,K.t_)("Panel not found")),T.E1.partial({editPanel:null,viewPanel:null}))}}static getDerivedStateFromProps(t,a){const{dashboard:r,queryParams:s}=t,i=s.editPanel,l=s.viewPanel;if(!r)return a;const c={...a};if(!a.editPanel&&i){const d=r.getPanelByUrlId(i);d?r.canEditPanel(d)?(c.editPanel=d,c.rememberScrollTop=a.scrollElement?.scrollTop):c.editPanelAccessDenied=!0:c.panelNotFound=!0}else a.editPanel&&!i&&(c.editPanel=null,c.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&l){const d=r.getPanelByUrlId(l);d?(r.initViewPanel(d),c.viewPanel=d,c.rememberScrollTop=a.scrollElement?.scrollTop,c.updateScrollTop=0):c.panelNotFound=!0}else a.viewPanel&&!l&&(r.exitViewPanel(a.viewPanel),c.viewPanel=null,c.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!i)&&(c.panelNotFound=!1,c.editPanelAccessDenied=!1),Fs(t,c)}getInspectPanel(){const{dashboard:t,queryParams:a}=this.props,r=a.inspect;if(!t||!r)return null;const s=t.getPanelById(parseInt(r,10));return s||null}render(){const{dashboard:t,initError:a,queryParams:r}=this.props,{editPanel:s,viewPanel:i,updateScrollTop:l,pageNav:c,sectionNav:d}=this.state,m=(0,Q.U)(this.props.queryParams);if(!t||!c||!d)return e.createElement(oe.B,{initPhase:this.props.initPhase});const u=this.getInspectPanel(),g=!s&&!m&&!this.props.queryParams.editview,f=m!==O.KioskMode.Full&&!r.editview&&e.createElement("header",{"data-testid":v.wl.pages.Dashboard.DashNav.navV2},e.createElement(Fe.t,{dashboard:t,title:t.title,folderTitle:t.meta.folderTitle,isFullscreen:!!i,onAddPanel:this.onAddPanel,kioskMode:m,hideTimePicker:t.timepicker.hidden,shareModalActiveTab:this.props.queryParams.shareView})),h=(0,p.cx)({"panel-in-fullscreen":Boolean(i),"page-hidden":Boolean(r.editview||s)});return e.createElement(e.Fragment,null,e.createElement(D.T,{navModel:d,pageNav:c,layout:N.Qz.Canvas,toolbar:f,className:h,scrollRef:this.setScrollRef,scrollTop:l},e.createElement(ct,{dashboard:t}),a&&e.createElement(_.u,null),g&&e.createElement("section",{"aria-label":v.wl.pages.Dashboard.SubMenu.submenu},e.createElement(en,{dashboard:t,annotations:t.annotations.list,links:t.links})),e.createElement(Ms.Z,{dashboard:t,isEditable:!!t.meta.canEdit,viewPanel:i,editPanel:s}),u&&e.createElement(kn,{dashboard:t,panel:u})),s&&e.createElement(ds,{dashboard:t,sourcePanel:s,tab:this.props.queryParams.tab,sectionNav:d,pageNav:c}),r.editview&&e.createElement(vn.D,{dashboard:t,editview:r.editview,pageNav:c,sectionNav:d}))}}nt.contextType=A.h;function Fs(n,t){const{dashboard:a}=n;if(!a)return t;let r=t.pageNav,s=t.sectionNav;(!r||a.title!==r.text)&&(r={text:a.title,url:H.u.getUrlForPartial(n.history.location,{editview:null,editPanel:null,viewPanel:null})});const{folderTitle:i,folderUid:l}=a.meta;if(i&&l&&r&&r.parentItem?.text!==i&&(r={...r,parentItem:{text:i,url:`/dashboards/f/${a.meta.folderUid}`}}),n.route.routeName===O.DashboardRoutes.Path){s=(0,J.getRootContentNavModel)();const c=(0,J.getPageNavFromSlug)(n.match.params.slug);c?.parentItem&&(c.parentItem=c.parentItem)}else s=(0,B.ht)(n.navIndex,y.v.featureToggles.topnav?"dashboards/browse":"dashboards");return(t.editPanel||t.viewPanel)&&(r={...r,text:`${t.editPanel?"Edit":"View"} panel`,parentItem:r,url:void 0}),t.pageNav===r&&t.sectionNav===s?t:{...t,pageNav:r,sectionNav:s}}const at=(0,E.HE)(nt);at.displayName="DashboardPage";const zs=Us(at)},66959:(se,z,o)=>{o.r(z),o.d(z,{default:()=>y});var p=o(68404),e=o(35645),I=o(35287),N=o(87513),H=o(25e3),v=o(81168),T=o(53051);function y(E){const{isLoading:M}=(0,H.zJ)(),{hasDatasource:D}=(0,v.useSelector)(B=>({hasDatasource:B.dataSources.dataSourcesCount>0})),[A,K]=(0,p.useState)(!1);return D||A||!e.v.featureToggles.datasourceOnboarding?p.createElement(T.default,{...E}):p.createElement(N.O,{onCTAClick:()=>K(!0),loading:M,title:(0,I.t)("datasource-onboarding.welcome","Welcome to Grafana dashboards!"),CTAText:(0,I.t)("datasource-onboarding.sampleData","Or set up a new dashboard with sample data"),navId:"dashboards/browse",pageNav:{text:(0,I.t)("datasource-onboarding.new-dashboard","New dashboard"),url:"/dashboard/new"}})}},81704:(se,z,o)=>{o.r(z),o.d(z,{default:()=>v});var p=o(68404),e=o(86647),I=o(37932),N=o(79396),H=o(87464);function v(T){const[y,E]=(0,p.useState)(null),{datasourceUid:M}=T.match.params;return(0,p.useEffect)(()=>{const D=(0,e.F)().getInstanceSettings(M);if(!D){E("Data source not found");return}const A=(0,H.ZQ)(),{dashboard:K}=A;K.panels[0]={...K.panels[0],datasource:{uid:D.uid,type:D.type}},(0,H.$M)(A),I.E1.replace("/dashboard/new")},[M]),y?p.createElement(N.T,{navId:"dashboards"},p.createElement(N.T.Contents,null,p.createElement("div",null,'Data source with UID "',M,'" not found.'))):null}},60265:(se,z,o)=>{o.r(z),o.d(z,{StorageFolderPage:()=>M,default:()=>K,getPageNavFromSlug:()=>D,getRootContentNavModel:()=>A});var p=o(68404),e=o(22350),I=o(35645),N=o(72948),H=o(39904),v=o(67487),T=o(45253),y=o(79396),E=o(63163);function M(Q){const B=Q.match.params.slug??"",R=(0,e.Z)(()=>(0,E.$)().list("content/"+B),[B]),J=B.length>0?`g/${B}/`:"g/",O=D(B),U=()=>R.value?R.value.fields[0].values.toArray().map(Fe=>{let _=Fe;const oe=_.indexOf(".")<0,Z=!oe&&_.endsWith(".json"),ie=`${J}${_}`;return p.createElement(N.Z,{key:_,href:oe||Z?ie:void 0},p.createElement(N.Z.Heading,null,_),p.createElement(N.Z.Figure,null,p.createElement(H.J,{name:oe?"folder":Z?"gf-grid":"file-alt",size:"sm"})))}):R.loading?p.createElement(v.$,null):p.createElement("div",null,"?"),Ee=A();return p.createElement(y.T,{navModel:Ee,pageNav:O},!I.v.featureToggles.topnav&&p.createElement("div",null,p.createElement(T.b,{title:"Enable the topnav feature toggle"},"This page is designed assuming topnav is enabled")),U())}function D(Q){const B=Q.split("/");let R=[],J="g",O;for(let U=0;U<B.length;U++)J+=`/${B[U]}`,R.push({text:B[U],url:J,parentItem:O}),O=R[R.length-1];return O}function A(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const K=M},92465:(se,z,o)=>{o.d(z,{M:()=>v});var p=o(68404),e=o(89890),I=o(85854),N=o(53217);const H=(T,y,E)=>{if(!E)return;let M=T.find(D=>!y.some(A=>D===A));if(M)return M},v=({value:T,context:y,onChange:E,item:M})=>{const D=(0,p.useMemo)(()=>y.data.map(R=>({value:R.refId,label:`Query: ${R.refId} (size: ${R.length})`,description:R.fields.map(J=>(0,e.C)(J)).join(", ")})),[y.data]),[A,K]=(0,p.useState)({refIds:[],value:void 0}),Q=(0,p.useMemo)(()=>D.find(R=>R.value===T?.options)??H(D,A.refIds,A.value),[T,D,A]),B=(0,p.useCallback)(R=>{E(R?.value?{id:I.E4.byRefId,options:R.value}:void 0)},[E]);return(D!==A.refIds||Q?.value!==A.value)&&K({refIds:D,value:Q?.value}),p.createElement(N.Ph,{options:D,onChange:B,isClearable:!0,placeholder:"Change filter",value:Q})}}}]);

//# sourceMappingURL=DashboardPage.c3efbac91e4c45147658.js.map