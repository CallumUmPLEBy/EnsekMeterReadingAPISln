"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[794],{47138:(me,H,o)=>{o.d(H,{JX:()=>A,Wz:()=>U,oZ:()=>p,uG:()=>q});var C=o(52423),P=o(82897),a=o.n(P),K=o(68404),g=o(35645),Q=o(19426),k=o(2594),V=o(81764),ee=o(46967),ce=o(53217),J=o(92555);const q=[{value:J.EM.Range,label:"Range",description:"Run query over a range of time."},{value:J.EM.Instant,label:"Instant",description:'Run query against a single point in time. For this query, the "To" time is used.'}];g.v.featureToggles.lokiLive&&q.push({value:J.EM.Stream,label:"Stream",description:"Run a query and keep sending results on an interval"});const p=[{value:1,label:"1/1"}].concat((0,P.map)([2,3,4,5,10],N=>({value:N,label:"1/"+N})));function A(N){const{lineLimitValue:Y,resolution:te,onRunQuery:Z,runOnBlur:se,onChange:D}=N,T=N.query??{};let $=T.queryType??(T.instant?J.EM.Instant:J.EM.Range);function X(h){const l={...T,maxLines:U(h)};D(l)}function u(h){const{instant:l,range:O,...E}=T;D({...E,queryType:h})}function i(h){T.maxLines!==U(h.currentTarget.value)&&X(h.currentTarget.value)}function d(h){h.key==="Enter"&&Z()}function f(h){const l={...T,resolution:h.value};D(l)}return K.createElement("div",{"aria-label":"Loki extra field",className:"gf-form-inline"},K.createElement("div",{"data-testid":"queryTypeField",className:(0,C.cx)("gf-form explore-input-margin",C.css`
            flex-wrap: nowrap;
          `),"aria-label":"Query type field"},K.createElement(Q.c,{width:"auto"},"Query type"),K.createElement(k.S,{options:q,value:$,onChange:h=>{u(h),se&&Z()}})),K.createElement("div",{"data-testid":"lineLimitField",className:(0,C.cx)("gf-form",C.css`
            flex-wrap: nowrap;
          `),"aria-label":"Line limit field"},K.createElement(V._,{label:"Line limit",tooltip:"Upper limit for number of log lines returned by query."},K.createElement(ee.I,{className:"width-4",placeholder:"auto",type:"number",min:0,onChange:i,onKeyDown:d,value:Y,onBlur:()=>{se&&Z()}})),K.createElement(V._,{label:"Resolution",tooltip:"Resolution 1/1 sets step parameter of Loki metrics range queries such that each pixel corresponds to one data point. For better performance, lower resolutions can be picked. 1/2 only retrieves a data point for every other pixel, and 1/10 retrieves one data point per 10 pixels."},K.createElement(ce.Ph,{isSearchable:!1,onChange:f,options:p,value:te,"aria-label":"Select resolution"}))))}var W=(0,K.memo)(A);function U(N){return N.length===0?NaN:N.length>0&&(isNaN(+N)||+N<0)?0:+N}},85444:(me,H,o)=>{o.d(H,{KV:()=>vr,Ic:()=>xe,xf:()=>Tt,NZ:()=>Be,V8:()=>_t});var C=o(82897),P=o(37537),a=o(3363),K=o(53786),g=o(16313),Q=o(2101),k=o(94514),V=o(13016),ee=o(29236),ce=o(33180),J=o(49922),q=o(71895),z=o(14582),p=o(40400),A=o(46519),W=o(90595),U=o(69311),N=o(21053),Y=o(50235),te=o(22069),Z=o(35645),se=o(37959),D=o(55935),T=o(19349),$=o(98639),X=o(8878),u=o(81042),i=o(44332),d=o(44812),f=o(20707),h=o.n(f),l=o(57706),O=o.n(l),E=o(7238),x=o(51649),F=o(87826),y=o(19370),R=o(92555);const _=["job","namespace"],oe="{}",Te=10,St=1e3*60*60*24,Ae=1e6,Ie=[{label:"$__interval",sortValue:"$__interval"},{label:"$__range",sortValue:"$__range"},{label:"1m",sortValue:"00:01:00"},{label:"5m",sortValue:"00:05:00"},{label:"10m",sortValue:"00:10:00"},{label:"30m",sortValue:"00:30:00"},{label:"1h",sortValue:"01:00:00"},{label:"1d",sortValue:"24:00:00"}],Ft=1e3*30,_e=c=>({label:c,filterText:`"${c}"`});function $t(c,t){const e=Date.now()-St,r=t.filter(m=>m.ts>e&&m.query.expr===c.label);let n=`Queried ${r.length} times in the last 24h.`;const s=r[0];if(s){const m=(0,A.CQ)(s.ts).fromNow();n=`${n} Last queried ${m}.`}return{...c,documentation:n}}class Ct extends E.iL{constructor(t,e){super(),this.started=!1,this.lookupsDisabled=!1,this.seriesCache=new(h())({max:10}),this.labelsCache=new(h())({max:10}),this.cleanText=r=>r.replace(/[{}[\]="(),!~+\-*/^%\|]/g,"").trim(),this.request=async(r,n)=>{try{return await this.datasource.metadataRequest(r,n)}catch(s){console.error(s)}},this.start=()=>(this.startTask||(this.startTask=this.fetchLabels().then(()=>(this.started=!0,[]))),this.startTask),this.getBeginningCompletionItems=r=>({suggestions:[...this.getEmptyCompletionItems(r).suggestions,...this.getTermCompletionItems().suggestions]}),this.getTermCompletionItems=()=>{const r=[];return r.push({prefixMatch:!0,label:"Functions",items:y.r8.map(n=>({...n,kind:"function"}))}),{suggestions:r}},this.getPipeCompletionItem=()=>{const r=[];return r.push({label:"Operators",items:y.Rd.map(n=>({...n,kind:"operators"}))}),r.push({label:"Parsers",items:y.uR.map(n=>({...n,kind:"parsers"}))}),{suggestions:r}},this.fetchSeriesLabels=async r=>{const n=this.datasource.interpolateString(r),s="series",{start:m,end:b}=this.datasource.getTimeRangeParams(),v=this.generateCacheKey(s,m,b,n);let L=this.seriesCache.get(v);if(!L){this.seriesCache.set(v,{});const S={"match[]":n,start:m,end:b},w=await this.request(s,S),{values:G}=(0,x.DY)(w);L=G,this.seriesCache.set(v,L)}return L},this.fetchSeries=async r=>{const n="series",{start:s,end:m}=this.datasource.getTimeRangeParams(),b={"match[]":r,start:s,end:m};return await this.request(n,b)},this.datasource=t,this.labelKeys=[],this.labelFetchTs=0,Object.assign(this,e)}getSyntax(){return y.ZP}getLabelKeys(){return this.labelKeys}async provideCompletionItems(t,e){const{wrapperClasses:r,value:n,prefix:s,text:m}=t,b={suggestions:[]};if(!n)return b;const v=n?.document.text.length===0,L=n.document.getTextsAtRange(n.selection),S=L.size===1?L.first().getText():null,w=S?S[n.selection.anchor.offset]:null,G=r.length>3,B=s&&!G,j=!w||w===")",M=s&&!m.match(/^['"~=\]})\s]+$/)&&j,re=/[+\-*/^%]/,ae=m.match(re);return r.includes("context-range")?this.getRangeCompletionItems():r.includes("context-labels")?await this.getLabelCompletionItems(t):r.includes("context-pipe")?this.getPipeCompletionItem():v?this.getEmptyCompletionItems(e):B&&j&&!ae?this.getBeginningCompletionItems(e):B&&M?this.getTermCompletionItems():b}getEmptyCompletionItems(t){const e=t?.history,r=[];if(e?.length){const n=(0,C.chain)(e).map(s=>s.query.expr).filter().uniq().take(Te).map(_e).map(s=>$t(s,e)).value();r.push({prefixMatch:!0,skipSort:!0,label:"History",items:n})}return{suggestions:r}}getRangeCompletionItems(){return{context:"context-range",suggestions:[{label:"Range vector",items:[...Ie]}]}}async getLabelCompletionItems({text:t,wrapperClasses:e,labelKey:r,value:n}){let s="context-labels";const m=[];if(!n)return{context:s,suggestions:[]};const b=n.anchorBlock.getText(),v=n.selection.anchor.offset,L=t.match(/^(=|=~|!=|!~)/);let S,w;try{w=(0,x.rV)(b,v),S=w.selector}catch{S=oe}if(!r&&S===oe){await this.start();const j=this.getLabelKeys();return{context:s,suggestions:[{label:"Labels",items:j.map(_e)}]}}const G=w?w.labelKeys:[];let B;if(S)if(S===oe&&r){const j=await this.getLabelValues(r);B={[r]:j}}else B=await this.getSeriesLabels(S);if(!B)return console.warn(`Server did not return any values for selector = ${S}`),{context:s,suggestions:m};if(t&&L||e.includes("attr-value"))r&&B[r]&&(s="context-label-values",m.push({label:`Label values for "${r}"`,items:B[r].map(_e).filter(({filterText:j})=>j!==t)}));else{const j=B?Object.keys(B):_;if(j){const M=(0,C.difference)(j,G);if(M.length){const ae={label:"Labels",items:M.map(pe=>({label:pe}))};m.push(ae)}}}return{context:s,suggestions:m}}importFromAbstractQuery(t){return{refId:t.refId,expr:(0,x.PL)(t),queryType:R.EM.Range}}exportToAbstractQuery(t){const e=t.expr;if(!e||e.length===0)return{refId:t.refId,labelMatchers:[]};const r=O().tokenize(e,y.ZP);return{refId:t.refId,labelMatchers:(0,x.UO)(r)}}async getSeriesLabels(t){if(!this.lookupsDisabled)try{return await this.fetchSeriesLabels(t)}catch(e){console.error(e);return}}async fetchLabels(){const t="labels",e=this.datasource.getTimeRangeParams();this.labelFetchTs=Date.now().valueOf();const r=await this.request(t,e);if(Array.isArray(r)){const n=r.slice().sort().filter(s=>s!=="__name__");return this.labelKeys=n,this.labelKeys}return[]}async refreshLogLabels(t){(this.labelKeys&&Date.now().valueOf()-this.labelFetchTs>Ft||t)&&await this.fetchLabels()}generateCacheKey(t,e,r,n){return[t,this.roundTime(e),this.roundTime(r),n].join()}roundTime(t){return t?Math.floor(t/Ae/1e3/60/5):0}async getLabelValues(t){return await this.fetchLabelValues(t)}async fetchLabelValues(t){const e=encodeURIComponent(this.datasource.interpolateString(t)),r=`label/${e}/values`,n=this.datasource.getTimeRangeParams(),{start:s,end:m}=n,b=this.generateCacheKey(r,s,m,e),v={start:s,end:m};let L=this.labelsCache.get(b);if(!L){this.labelsCache.set(b,[]);const S=await this.request(r,v);Array.isArray(S)&&(L=S.slice().sort(),this.labelsCache.set(b,L))}return L??[]}async getParserAndLabelKeys(t){const e=await this.datasource.getDataSamples({expr:t,refId:"data-samples"});if(!e.length)return{extractedLabelKeys:[],unwrapLabelKeys:[],hasJSON:!1,hasLogfmt:!1};const{hasLogfmt:r,hasJSON:n}=(0,F.OP)(e[0]);return{extractedLabelKeys:(0,F.e8)(e[0]),unwrapLabelKeys:(0,F.zb)(e[0]),hasJSON:n,hasLogfmt:r}}}var Ne=o(4561),We=o(47994),Ke=o(98356),Dt=o(97218),Ve=o(9683),be=o(96209),Xe=o(97709),Se=o(46060),je=o(95484),Fe=o(16527),Bt={url:"",deserializer:function(c){return JSON.parse(c.data)},serializer:function(c){return JSON.stringify(c)}},Mt="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",Ut=function(c){(0,Ve.__extends)(t,c);function t(e,r){var n=c.call(this)||this;if(n._socket=null,e instanceof Se.y)n.destination=r,n.source=e;else{var s=n._config=(0,Ve.__assign)({},Bt);if(n._output=new be.x,typeof e=="string")s.url=e;else for(var m in e)e.hasOwnProperty(m)&&(s[m]=e[m]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");n.destination=new Fe.t}return n}return t.prototype.lift=function(e){var r=new t(this._config,this.destination);return r.operator=e,r.source=this,r},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new Fe.t),this._output=new be.x},t.prototype.multiplex=function(e,r,n){var s=this;return new Se.y(function(m){try{s.next(e())}catch(v){m.error(v)}var b=s.subscribe({next:function(v){try{n(v)&&m.next(v)}catch(L){m.error(L)}},error:function(v){return m.error(v)},complete:function(){return m.complete()}});return function(){try{s.next(r())}catch(v){m.error(v)}b.unsubscribe()}})},t.prototype._connectSocket=function(){var e=this,r=this._config,n=r.WebSocketCtor,s=r.protocol,m=r.url,b=r.binaryType,v=this._output,L=null;try{L=s?new n(m,s):new n(m),this._socket=L,b&&(this._socket.binaryType=b)}catch(w){v.error(w);return}var S=new je.w0(function(){e._socket=null,L&&L.readyState===1&&L.close()});L.onopen=function(w){var G=e._socket;if(!G){L.close(),e._resetState();return}var B=e._config.openObserver;B&&B.next(w);var j=e.destination;e.destination=Xe.Lv.create(function(M){if(L.readyState===1)try{var re=e._config.serializer;L.send(re(M))}catch(ae){e.destination.error(ae)}},function(M){var re=e._config.closingObserver;re&&re.next(void 0),M&&M.code?L.close(M.code,M.reason):v.error(new TypeError(Mt)),e._resetState()},function(){var M=e._config.closingObserver;M&&M.next(void 0),L.close(),e._resetState()}),j&&j instanceof Fe.t&&S.add(j.subscribe(e.destination))},L.onerror=function(w){e._resetState(),v.error(w)},L.onclose=function(w){L===e._socket&&e._resetState();var G=e._config.closeObserver;G&&G.next(w),w.wasClean?v.complete():v.error(w)},L.onmessage=function(w){try{var G=e._config.deserializer;v.next(G(w))}catch(B){v.error(B)}}},t.prototype._subscribe=function(e){var r=this,n=this.source;return n?n.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add(function(){var s=r._socket;r._output.observers.length===0&&(s&&(s.readyState===1||s.readyState===0)&&s.close(),r._resetState())}),e)},t.prototype.unsubscribe=function(){var e=this._socket;e&&(e.readyState===1||e.readyState===0)&&e.close(),this._resetState(),c.prototype.unsubscribe.call(this)},t}(be.u);function wt(c){return new Ut(c)}var At=o(25091),It=o(72847);const Nt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Wt(c){return typeof c=="string"&&Nt.test(c)}const Kt=Wt;function Ze(c){if(!Kt(c))throw TypeError("Invalid UUID");let t;const e=new Uint8Array(16);return e[0]=(t=parseInt(c.slice(0,8),16))>>>24,e[1]=t>>>16&255,e[2]=t>>>8&255,e[3]=t&255,e[4]=(t=parseInt(c.slice(9,13),16))>>>8,e[5]=t&255,e[6]=(t=parseInt(c.slice(14,18),16))>>>8,e[7]=t&255,e[8]=(t=parseInt(c.slice(19,23),16))>>>8,e[9]=t&255,e[10]=(t=parseInt(c.slice(24,36),16))/1099511627776&255,e[11]=t/4294967296&255,e[12]=t>>>24&255,e[13]=t>>>16&255,e[14]=t>>>8&255,e[15]=t&255,e}const Ge=Ze;function ze(c){c=unescape(encodeURIComponent(c));const t=[];for(let e=0;e<c.length;++e)t.push(c.charCodeAt(e));return t}const He="6ba7b810-9dad-11d1-80b4-00c04fd430c8",ke="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function qe(c,t,e){function r(n,s,m,b){var v;if(typeof n=="string"&&(n=ze(n)),typeof s=="string"&&(s=Ge(s)),((v=s)===null||v===void 0?void 0:v.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let L=new Uint8Array(16+n.length);if(L.set(s),L.set(n,s.length),L=e(L),L[6]=L[6]&15|t,L[8]=L[8]&63|128,m){b=b||0;for(let S=0;S<16;++S)m[b+S]=L[S];return m}return(0,It.S)(L)}try{r.name=c}catch{}return r.DNS=He,r.URL=ke,r}function Ye(c,t,e,r){switch(c){case 0:return t&e^~t&r;case 1:return t^e^r;case 2:return t&e^t&r^e&r;case 3:return t^e^r}}function ye(c,t){return c<<t|c>>>32-t}function Vt(c){const t=[1518500249,1859775393,2400959708,3395469782],e=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof c=="string"){const m=unescape(encodeURIComponent(c));c=[];for(let b=0;b<m.length;++b)c.push(m.charCodeAt(b))}else Array.isArray(c)||(c=Array.prototype.slice.call(c));c.push(128);const r=c.length/4+2,n=Math.ceil(r/16),s=new Array(n);for(let m=0;m<n;++m){const b=new Uint32Array(16);for(let v=0;v<16;++v)b[v]=c[m*64+v*4]<<24|c[m*64+v*4+1]<<16|c[m*64+v*4+2]<<8|c[m*64+v*4+3];s[m]=b}s[n-1][14]=(c.length-1)*8/Math.pow(2,32),s[n-1][14]=Math.floor(s[n-1][14]),s[n-1][15]=(c.length-1)*8&4294967295;for(let m=0;m<n;++m){const b=new Uint32Array(80);for(let B=0;B<16;++B)b[B]=s[m][B];for(let B=16;B<80;++B)b[B]=ye(b[B-3]^b[B-8]^b[B-14]^b[B-16],1);let v=e[0],L=e[1],S=e[2],w=e[3],G=e[4];for(let B=0;B<80;++B){const j=Math.floor(B/20),M=ye(v,5)+Ye(j,L,S,w)+G+t[j]+b[B]>>>0;G=w,w=S,S=ye(L,30)>>>0,L=v,v=M}e[0]=e[0]+v>>>0,e[1]=e[1]+L>>>0,e[2]=e[2]+S>>>0,e[3]=e[3]+w>>>0,e[4]=e[4]+G>>>0}return[e[0]>>24&255,e[0]>>16&255,e[0]>>8&255,e[0]&255,e[1]>>24&255,e[1]>>16&255,e[1]>>8&255,e[1]&255,e[2]>>24&255,e[2]>>16&255,e[2]>>8&255,e[2]&255,e[3]>>24&255,e[3]>>16&255,e[3]>>8&255,e[3]&255,e[4]>>24&255,e[4]>>16&255,e[4]>>8&255,e[4]&255]}const jt=qe("v5",80,Vt),Zt="6ec946da-0f49-47a8-983a-1d76d17e7c92";function Je(c,t){const e=c.streams;if(!e||!e.length)return;const r=t.fields[0],n=t.fields[1],s=t.fields[2],m={};for(const b of e){const v=Object.entries(b.stream).map(([L,S])=>`${L}="${S}"`).sort().join("");for(const[L,S]of b.values)r.values.add(new Date(parseInt(L.slice(0,-6),10)).toISOString()),n.values.add(S),s.values.add(et(L,v,S,m,t.refId))}}function et(c,t,e,r,n){let s=jt(`${c}_${t}_${e}`,Zt);if(s in r){const m=r[s]+1;r[s]=m,s=`${s}_${m}`}else r[s]=0;return n?`${s}_${n}`:s}class tt{constructor(){this.streams={}}getStream(t,e=5e3){let r=this.streams[t.url];if(r)return r;const n=new At.a({capacity:t.size});return n.addField({name:"Time",type:z.fS.time,config:{}}),n.addField({name:"Line",type:z.fS.string}),n.addField({name:"id",type:z.fS.string}),n.meta={...n.meta,preferredVisualisationType:"logs"},n.refId=t.refId,r=wt(t.url).pipe((0,Q.U)(s=>(Je(s,n),[n])),(0,We.a)(s=>s.pipe((0,Ke.z)((m,b)=>{const v=b+1;return m.code===1006&&v<30?(v>10&&console.warn(`Websocket connection is being disrupted. We keep reconnecting but consider starting new live tailing again. Error: ${m.reason}`),(0,Ne.H)(e)):(0,P._)(m)}))),(0,Dt.x)(()=>{delete this.streams[t.url]})),this.streams[t.url]=r,r}}var rt=o(16911),ve=o(19695),at=o(86647);function nt(c,t){if(!t.length)return[];const e=(0,C.groupBy)(t,"name"),r=Object.values(e).map(st),n=c.fields.find(s=>s.type===z.fS.string);if(n===void 0)throw new Error("invalid logs-dataframe, string-field missing");return n.values.toArray().forEach(s=>{for(const m of r){const b=s.match(e[m.name][0].matcherRegex);m.values.add(b&&b[1])}}),r}function st(c){const t=(0,at.F)(),e=c.reduce((r,n)=>{if(n.datasourceUid){const s=t.getInstanceSettings(n.datasourceUid);r.push({title:n.urlDisplayLabel||"",url:"",internal:{query:{query:n.url},datasourceUid:n.datasourceUid,datasourceName:s?.name??"Data source not found"}})}else n.url&&r.push({title:n.urlDisplayLabel||"",url:n.url});return r},[]);return{name:c[0].name,type:z.fS.string,config:{links:e},values:new ve.G([])}}function Gt(c){const t=c.filter(r=>r.refId!==void 0),e=(0,C.groupBy)(t,r=>r.refId);return Object.entries(e).map(([r,n])=>it(n,r))}function it(c,t){const e={name:"Time",config:{},values:new ve.G,type:z.fS.time},r={name:`Value #${t}`,config:{},values:new ve.G,type:z.fS.number},n=new Set(c.map(b=>b.fields.map(v=>Object.keys(v.labels??{})).flat()).flat()),m=Array.from(n).sort().map(b=>({name:b,config:{filterable:!0},values:new ve.G,type:z.fS.string}));return c.forEach(b=>{const v=b.fields.find(B=>B.type===z.fS.time),L=b.fields.find(B=>B.type===z.fS.number);if(v==null||L==null)return;const S=v.values.toArray(),w=L.values.toArray();for(let B of S)e.values.add(B);for(let B of w)r.values.add(B);const G=L.labels??{};for(let B of m){const j=G[B.name]??"";for(let M=0;M<w.length;M++)B.values.add(j)}}),{fields:[e,...m,r],refId:t,meta:{preferredVisualisationType:"table"},length:e.values.length}}var le=o(24666);function zt(c){return c.fields.every(t=>t.type===z.fS.time||t.type===z.fS.number)}function $e(c,t){const{meta:e,...r}=c,n={...e,...t};return{...r,meta:n}}function ot(c,t,e){const r={...c.meta?.custom,lokiQueryStatKey:"Summary: total bytes processed"};(0,F.vh)(c)&&(r.error="Error when parsing some of the logs");const n={preferredVisualisationType:"logs",limit:t?.maxLines,searchWords:t!==void 0?(0,le.n6)((0,le.x9)(t.expr)):void 0,custom:r},s=$e(c,n),m=nt(s,e);return{...s,fields:[...s.fields,...m]}}function lt(c,t,e){return c.map(r=>{const n=r.refId!==void 0?t.get(r.refId):void 0;return ot(r,n,e)})}function ct(c){return c.length>0?Gt(c):[]}function Ht(c){const t={preferredVisualisationType:"graph"};return c.map(e=>$e(e,t))}function kt(c,t){const e=[],r=[],n=[];return c.forEach(s=>{zt(s)?s.refId!=null&&t.get(s.refId)?.queryType===R.EM.Instant?r.push(s):n.push(s):e.push(s)}),{streamsFrames:e,metricInstantFrames:r,metricRangeFrames:n}}function qt(c,t){if(c===void 0)return c;const{refId:e,message:r}=c;if(e===void 0||r===void 0)return c;const n=t.get(e);return n===void 0?c:r.includes("escape")&&n.expr.includes("\\")?{...c,message:`${r}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`}:c}function Yt(c,t,e){const{data:r,error:n,...s}=c,m=r.map(w=>{if(!(0,rt.aY)(w))throw new Error("transformation only supports dataframe responses");return w}),b=new Map(t.map(w=>[w.refId,w])),{streamsFrames:v,metricInstantFrames:L,metricRangeFrames:S}=kt(m,b);return{...s,error:qt(n,b),data:[...Ht(S),...ct(L),...lt(v,b,e)]}}var I=o(68404),Pe=o(26418),Ee=o(46967),Jt=o(47138),er=o(91159);const tr=(0,I.memo)(function(t){const{annotation:e,onAnnotationChange:r,history:n}=t;if(e===void 0||r===void 0)return null;const s=b=>{const v=(0,le.Ib)(b).queryType===R.EM.Instant;r({...e,expr:b.expr,maxLines:b.maxLines,instant:v})},m={refId:"",expr:e.expr,maxLines:e.maxLines,instant:e.instant,queryType:e.queryType};return I.createElement(I.Fragment,null,I.createElement("div",{className:"gf-form-group"},I.createElement(er.n,{datasource:t.datasource,query:m,onChange:s,onRunQuery:()=>{},onBlur:()=>{},history:n,ExtraFieldElement:I.createElement(Jt.JX,{lineLimitValue:m?.maxLines?.toString()||"",resolution:m.resolution||1,query:m,onRunQuery:()=>{},onChange:s})})),I.createElement(Pe.EditorRow,null,I.createElement(Pe.EditorField,{label:"Title",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance."},I.createElement(Ee.I,{type:"text",placeholder:"alertname",value:e.titleFormat,onChange:b=>{r({...e,titleFormat:b.currentTarget.value})}})),I.createElement(Pe.EditorField,{label:"Tags"},I.createElement(Ee.I,{type:"text",placeholder:"label1,label2",value:e.tagKeys,onChange:b=>{r({...e,tagKeys:b.currentTarget.value})}})),I.createElement(Pe.EditorField,{label:"Text",tooltip:"Use either the name or a pattern. For example, {{instance}} is replaced with label value for the label instance."},I.createElement(Ee.I,{type:"text",placeholder:"instance",value:e.textFormat,onChange:b=>{r({...e,textFormat:b.currentTarget.value})}}))))});var Oe=o(52423),ut=o(58635),dt=o(22350),ge=o(41818),Ce=o(61860),mt=o(72648),pt=o(34719),ft=o(61744),Le=o(53217);function rr(c){return{labels:Oe.css`
      display: flex;
      gap: 2px;
    `,multiSelectWrapper:Oe.css`
      display: flex;
      flex-direction: column;
      flex: 1;
      margin-top: ${c.spacing(1)};
      gap: ${c.spacing(.5)};
    `,multiSelect:Oe.css`
      & .scrollbar-view {
        overscroll-behavior: contain;
      }
    `,loadingPlaceholder:Oe.css`
      margin-bottom: 0px;
      float: right;
      display: inline;
      margin-left: auto;
    `,textWrapper:Oe.css`
      display: flex;
      align-items: center;
    `,hidden:Oe.css`
      visibility: hidden;
    `}}const Ot=(0,ut.Z)(({label:c,description:t})=>I.createElement(Ce.u,{content:`${c}="${t}"`,placement:"top",interactive:!0},I.createElement("span",null,c)));function ar(c){const{row:t,languageProvider:e,updateFilter:r,onClose:n}=c,s=(0,mt.wW)(rr),[m,b]=(0,I.useState)([]),[v,L]=(0,I.useState)(!1),[S,w]=(0,I.useState)(!1),G=I.useRef(),B=I.useRef(!1),j=I.useRef([]);(0,I.useEffect)(()=>{if(v){if(!B.current){B.current=v;return}if(m.filter(({enabled:ie,fromParser:de})=>ie&&!de).length===0){b(j.current);return}return j.current=structuredClone(m),G.current&&clearTimeout(G.current),w(!0),G.current=window.setTimeout(()=>{r(m),w(!1)},1500),()=>{clearTimeout(G.current)}}},[m,v]),(0,I.useEffect)(()=>()=>{clearTimeout(G.current),n()},[n]),(0,dt.Z)(async()=>{await e.start();const ie=e.getLabelKeys(),de=[];Object.entries(t.labels).forEach(([ne,Re])=>{const Pr={label:ne,value:ne,enabled:ie.includes(ne),fromParser:!ie.includes(ne),description:Re};de.push(Pr)}),b(de),L(!0)}),(0,I.useEffect)(()=>((0,ge.ff)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:t.uid,type:"load"}),()=>{(0,ge.ff)("grafana_explore_logs_loki_log_context_loaded",{logRowUid:t.uid,type:"unload"})}),[t.uid]);const M=m.filter(({fromParser:ie})=>!ie),re=M.filter(({enabled:ie})=>ie),ae=m.filter(({fromParser:ie})=>ie),pe=ae.filter(({enabled:ie})=>ie);return I.createElement("div",{className:s.multiSelectWrapper},I.createElement("div",{className:s.textWrapper}," ",I.createElement(Ce.u,{content:"This feature is experimental and only works on log queries containing no more than 1 parser (logfmt, json).",placement:"top"},I.createElement(pt.V,{className:(0,Oe.css)({fontSize:10,padding:"1px 5px",verticalAlign:"text-bottom"}),name:"Experimental",colorIndex:1}))," ","Select labels to be included in the context query:",I.createElement(ft.u,{text:"",className:`${s.loadingPlaceholder} ${S?"":s.hidden}`})),I.createElement("div",null,I.createElement(Le.NU,{className:s.multiSelect,prefix:"Labels",options:M,value:re,formatOptionLabel:Ot,closeMenuOnSelect:!0,maxMenuHeight:200,menuShouldPortal:!1,noOptionsMessage:"No further labels available",onChange:(ie,de)=>(de.action==="select-option"&&(0,ge.ff)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"label",action:"select"}),de.action==="remove-value"&&(0,ge.ff)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"label",action:"remove"}),b(m.map(ne=>(ne.fromParser||(ne.enabled=ie.some(Re=>Re.value===ne.value)),ne))))})),ae.length>0&&I.createElement("div",null,I.createElement(Le.NU,{className:s.multiSelect,prefix:"Parsed Labels",options:ae,value:pe,formatOptionLabel:Ot,closeMenuOnSelect:!0,menuShouldPortal:!1,maxMenuHeight:200,noOptionsMessage:"No further labels available",isClearable:!0,onChange:(ie,de)=>{de.action==="select-option"&&(0,ge.ff)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"parsed_label",action:"select"}),de.action==="remove-value"&&(0,ge.ff)("grafana_explore_logs_loki_log_context_filtered",{logRowUid:t.uid,type:"parsed_label",action:"remove"}),b(m.map(ne=>(ne.fromParser&&(ne.enabled=ie.some(Re=>Re.value===ne.value)),ne)))}})))}var he=o(31439);const gt=/^label_names\(\)\s*$/,ht=/^label_values\((?:(.+),\s*)?([a-zA-Z_][a-zA-Z0-9_]*)\)\s*$/;function nr(c){if(typeof c!="string")return c;const t={refId:"LokiVariableQueryEditor-VariableQuery",type:R.Z3.LabelNames};if(c.match(gt))return{...t,type:R.Z3.LabelNames};const r=c.match(ht);return r?{...t,type:R.Z3.LabelValues,label:r[2]?r[2]:r[1],stream:r[2]?r[1]:void 0}:t}var ue=o(88590);function sr(c,t){if(t.length===0)return[];const e=[],{queryWithParser:r,parserCount:n}=(0,le.cQ)(c);if(!r){const{hasLogfmt:b,hasJSON:v}=(0,F.OP)(t[0]);v&&e.push({type:"ADD_JSON_PARSER",label:"Selected log stream selector has JSON formatted logs.",fix:{title:"add json parser",label:"Consider using JSON parser.",action:{type:"ADD_JSON_PARSER",query:c}}}),b&&e.push({type:"ADD_LOGFMT_PARSER",label:"Selected log stream selector has logfmt formatted logs.",fix:{title:"add logfmt parser",label:"Consider using logfmt parser to turn key-value pairs in your log lines to labels.",action:{type:"ADD_LOGFMT_PARSER",query:c}}})}if(r){if(n===1){const v=(0,le.N7)(c);(0,F.ki)(t[0])&&!v&&e.push({type:"ADD_NO_PIPELINE_ERROR",label:"Some logs in your selected log streams have parsing error.",fix:{title:"remove pipeline errors",label:"Consider filtering out logs with parsing errors.",action:{type:"ADD_NO_PIPELINE_ERROR",query:c}}})}(0,le.Iu)(c)||e.push({type:"ADD_LABEL_FILTER",label:"Consider filtering logs by their label and value.",fix:{title:"add label filter",label:"",action:{type:"ADD_LABEL_FILTER",query:c}}})}if(!(0,le.hI)(c)){const b=(0,F.EO)(t[0]),v=(0,F.Y)(t[0]);!b&&v&&e.push({type:"ADD_LEVEL_LABEL_FORMAT",label:`Some logs in your selected log stream have "${v}" label.`,fix:{title:"add label level format",label:`If ${v} label has level values, consider using label_format to rename it to "level". Level label can be then visualized in log volumes.`,action:{type:"ADD_LEVEL_LABEL_FORMAT",query:c,options:{renameTo:"level",originalLabel:v}}}})}return(0,le.Qh)(c)||e.push({type:"ADD_LINE_FILTER",label:"Consider filtering logs for specific string.",fix:{title:"add line filter",label:"",action:{type:"ADD_LINE_FILTER",query:c}}}),e}var ir=o(12022),vt=(c=>(c[c.Ascending=0]="Ascending",c[c.Descending=1]="Descending",c))(vt||{});function or(c,t){const e=c.values.toArray(),r=Array(e.length);for(let s=0;s<r.length;s++)r[s]=s;const n=t===0;return r.sort((s,m)=>{const b=e[s],v=e[m];return b<v?n?-1:1:b>v?n?1:-1:0}),r}function lr(c,t){const{fields:e,...r}=c,n=e.find(m=>m.name==="tsNs");if(n===void 0)throw new Error("missing nanosecond-timestamp field. should never happen");const s=or(n,t);return{...r,fields:e.map(m=>({...m,values:new ir.o(m.values,s)}))}}var cr=o(17505),bt=o(62626),yt=o(75118),ur=o(28625);async function Pt(c){const t=JSON.stringify({expr:c.expr}),e=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-1",e);return Array.from(new Uint8Array(r.slice(0,8))).map(s=>s.toString(16).padStart(2,"0")).join("")}function Et(c,t,e){const r=e.range,n=r.to.valueOf()-r.from.valueOf()+1e3;let s=e.maxDataPoints??1e3;s>100&&(s*=2);let m;const b=v=>{if(v?.message){const L=v.message;m?m.push(L):m=ur.Av.fromDataFrameJSON(L,{maxLength:s,maxDelta:n,displayNameFormat:c.legendFormat})}return m};return(0,cr.P)(()=>Pt(c)).pipe((0,Ke.z)(v=>(0,yt.gj)().getStream({scope:bt.z.DataSource,namespace:t.uid,path:`tail/${v}`,data:{...c,timeRange:{from:r.from.valueOf().toString(),to:r.to.valueOf().toString()}}}).pipe((0,Q.U)(L=>{const S=b(L);return{data:S?[S]:[],state:J.Gu.Streaming}}))))}var dr=o(32920),mr=o(85526),pr=o(59670),Lt=o(11543),De=o(81764);const xt=[{label:"Label names",value:R.Z3.LabelNames},{label:"Label values",value:R.Z3.LabelValues}],Qt="LokiVariableQueryEditor-VariableQuery",Rt=({onChange:c,query:t,datasource:e})=>{const[r,n]=(0,I.useState)(void 0),[s,m]=(0,I.useState)(""),[b,v]=(0,I.useState)([]),[L,S]=(0,I.useState)("");(0,I.useEffect)(()=>{if(!t)return;const M=typeof t=="string"?nr(t):t;n(M.type),m(M.label||""),S(M.stream||""),M.label&&v([{label:M.label,value:M.label}])},[t]),(0,I.useEffect)(()=>{r===R.Z3.LabelValues&&e.labelNamesQuery().then(M=>{v(M.map(({text:re})=>({label:re,value:re})))})},[e,r]);const w=M=>{n(M.value),M.value!==void 0&&c({type:M.value,label:s,stream:L,refId:Qt})},G=M=>{m(M.value||"")},B=M=>{S(M.currentTarget.value)},j=()=>{r!==void 0&&c({type:r,label:s,stream:L,refId:"LokiVariableQueryEditor-VariableQuery"})};return I.createElement(Lt.Z,null,I.createElement(De._,{label:"Query type",labelWidth:20},I.createElement(Le.Ph,{"aria-label":"Query type",onChange:w,onBlur:j,value:r,options:xt,width:16})),r===R.Z3.LabelValues&&I.createElement(I.Fragment,null,I.createElement(De._,{label:"Label",labelWidth:20},I.createElement(Le.Ph,{"aria-label":"Label",onChange:G,onBlur:j,value:s,options:b,width:16,allowCustomValue:!0})),I.createElement(De._,{label:"Stream selector",labelWidth:20,tooltip:I.createElement("div",null,'Optional. If defined, a list of values for the specified log stream selector is returned. For example: {label="value"} or {label="$variable"}')},I.createElement(Ee.I,{type:"text","aria-label":"Stream selector",placeholder:"Optional stream selector",value:L,onChange:B,onBlur:j,width:22}))))};class fr extends pr.Mg{constructor(t){super(),this.datasource=t,this.editor=Rt,this.query=this.query.bind(this)}async execute(t){return this.datasource.metricFindQuery(t)}query(t){const e=this.execute(t.targets[0]);return(0,mr.D)(e).pipe((0,Q.U)(r=>({data:r})))}}const Or=1e3,gr="/loki/api/v1",xe="loki-data-samples",Tt="annotation-",Be="log-row-context-query-",_t="log-volume-",hr="log-sample-",Qe=1e6;function Me(c,t,e,r,n){const s=ce.calculateInterval(t,1);return{targets:[c],requestId:r,interval:s.interval,intervalMs:s.intervalMs,range:t,scopedVars:{},timezone:"UTC",app:e,startTime:Date.now(),hideFromInspector:n}}class vr extends te.CK{constructor(t,e=(0,$.J)(),r=(0,T.$t)()){super(t),this.instanceSettings=t,this.templateSrv=e,this.timeSrv=r,this.streams=new tt,this.runLiveQuery=(s,m)=>{const b=this.createLiveTarget(s,m);return this.streams.getStream(b).pipe((0,Q.U)(v=>({data:v||[],key:`loki-${b.refId}`,state:J.Gu.Streaming})),(0,k.K)(v=>(0,P._)(()=>`Live tailing was stopped due to following error: ${v.reason}`)))},this.getLogRowContext=async(s,m,b)=>{const v=m&&m.direction||"BACKWARD",L=m&&m.limit||10,{query:S,range:w}=await this.prepareLogRowContextQueryTarget(s,L,v,b),G=M=>{const re=new q.N(M),ae=re.getFirstFieldOfType(z.fS.time),pe=re.getFirstFieldOfType(z.fS.string),ie=re.getFieldByName("id");return ae===void 0||pe===void 0||ie===void 0?{...M,fields:[]}:{...M,fields:[{...ae,name:"ts"},{...pe,name:"line"},{...ie,name:"id"}]}},B=M=>{const ae=M.data.map(pe=>lr(pe,vt.Descending)).map(pe=>G(pe));return{...M,data:ae}},j=p.zj.Explore;return(0,a.n)(this.query(Me(S,w,j,`${Be}${v}`)).pipe((0,k.K)(M=>{throw{message:"Error during context query. Please check JS console logs.",status:M.status,statusText:M.statusText}}),(0,V.w)(M=>(0,K.of)(B(M)))))},this.prepareLogRowContextQueryTarget=async(s,m,b,v)=>{let L=await this.prepareContextExpr(s,v);const S=2*60*60*1e3,w=b==="FORWARD"?R.sb.Forward:R.sb.Backward,G={expr:L,queryType:R.EM.Range,refId:`${Be}${s.dataFrame.refId||""}`,maxLines:m,direction:w},j=new q.N(s.dataFrame).getFirstFieldOfType(z.fS.time);if(j===void 0)throw new Error("loki: dataframe missing time-field, should never happen");const M=j.values.get(s.rowIndex),re=(0,A.zh)(M),ae=w===R.sb.Forward?{from:re,to:(0,A.zh)(s.timeEpochMs+S)}:{from:(0,A.zh)(s.timeEpochMs-S),to:re};return{query:G,range:{from:ae.from,to:ae.to,raw:ae}}},this.languageProvider=new Ct(this);const n=t.jsonData||{};this.maxLines=parseInt(n.maxLines??"0",10)||Or,this.annotations={QueryEditor:tr},this.variables=new fr(this)}getDataProvider(t,e){if(this.getSupportedSupplementaryQueryTypes().includes(t))switch(t){case W.v8.LogsVolume:return this.getLogsVolumeDataProvider(e);case W.v8.LogsSample:return this.getLogsSampleDataProvider(e);default:return}}getSupportedSupplementaryQueryTypes(){return[W.v8.LogsVolume,W.v8.LogsSample]}getSupplementaryQuery(t,e){if(!this.getSupportedSupplementaryQueryTypes().includes(t))return;const r=(0,le.Ib)(e),n=(0,ue.C6)(r.expr);let s=!1;switch(t){case W.v8.LogsVolume:return s=!!(e.expr&&(0,le.rE)(e.expr)&&e.queryType===R.EM.Range),s?{...r,refId:`${_t}${r.refId}`,instant:!1,supportingQueryType:R.$o.LogsVolume,expr:`sum by (level) (count_over_time(${n}[$__interval]))`}:void 0;case W.v8.LogsSample:return s=!!(e.expr&&!(0,le.rE)(e.expr)),s?{...r,refId:`${hr}${r.refId}`,expr:(0,le.SP)(n),maxLines:100}:void 0;default:return}}getLogsVolumeDataProvider(t){const e=(0,C.cloneDeep)(t),r=e.targets.map(n=>this.getSupplementaryQuery(W.v8.LogsVolume,n)).filter(n=>!!n);if(r.length)return(0,se.Bz)(this,{...e,targets:r},{extractLevel:br,range:t.range,targets:t.targets})}getLogsSampleDataProvider(t){const e=(0,C.cloneDeep)(t),r=e.targets.map(n=>this.getSupplementaryQuery(W.v8.LogsSample,n)).filter(n=>!!n);if(r.length)return(0,se.Ce)(this,{...e,targets:r})}query(t){const e=t.targets.map(le.Ib).map(s=>({...s,maxLines:s.maxLines??this.maxLines})),r={...t,targets:e},n=r.targets.filter(s=>s.queryType===R.EM.Stream);if(Z.v.featureToggles.lokiLive&&n.length>0&&r.rangeRaw?.to==="now"){const s={...r,targets:n};return(0,g.T)(...n.map(m=>Et(this.applyTemplateVariables(m,t.scopedVars),this,s)))}if(r.liveStreaming)return this.runLiveQueryThroughBackend(r);{const s=new Date;return super.query(r).pipe((0,Q.U)(m=>Yt(m,r.targets,this.instanceSettings.jsonData.derivedFields??[])),(0,ee.b)(m=>(0,dr.C)(m,r,s)))}}runLiveQueryThroughBackend(t){const e=t.targets.filter(n=>n.expr!==""&&(0,le.rE)(n.expr));if(e.length===0)return(0,K.of)({data:[],state:J.Gu.Done});const r=e.map(n=>{const s=n.maxLines||this.maxLines;return this.runLiveQuery(n,s)});return(0,g.T)(...r)}createLiveTarget(t,e){const r=t.expr,n=this.instanceSettings.url,s=(0,X.tW)({query:r});return{query:r,url:(0,D.F3)(`${n}/loki/api/v1/tail?${s}`),refId:t.refId,size:e}}getRangeScopedVars(t=this.getTimeRange()){const e=t.to.diff(t.from),r=Math.round(e/1e3);return{__range_ms:{text:e,value:e},__range_s:{text:r,value:r},__range:{text:r+"s",value:r+"s"}}}interpolateVariablesInQueries(t,e){let r=t;return t&&t.length&&(r=t.map(n=>({...n,datasource:this.getRef(),expr:this.addAdHocFilters(this.templateSrv.replace(n.expr,e,this.interpolateQueryExpr))}))),r}getQueryDisplayText(t){return t.expr}getTimeRange(){return this.timeSrv.timeRange()}getTimeRangeParams(){const t=this.getTimeRange();return{start:t.from.valueOf()*Qe,end:t.to.valueOf()*Qe}}async importFromAbstractQueries(t){await this.languageProvider.start();const e=this.languageProvider.labelKeys;return e&&e.length&&(t=t.map(r=>(r.labelMatchers=r.labelMatchers.filter(n=>e.includes(n.name)),r))),t.map(r=>this.languageProvider.importFromAbstractQuery(r))}async exportToAbstractQueries(t){return t.map(e=>this.languageProvider.exportToAbstractQuery(e))}async metadataRequest(t,e,r){if(t.startsWith("/"))throw new Error(`invalid metadata request url: ${t}`);const n=await this.getResource(t,e,r);return n.data??(n||[])}async getQueryStats(t){const{start:e,end:r}=this.getTimeRangeParams(),n=(0,le.QI)(t.expr);let s={streams:0,chunks:0,bytes:0,entries:0};for(const m of n)try{const b=await this.metadataRequest("index/stats",{query:m,start:e,end:r},{showErrorAlert:!1});s={streams:s.streams+b.streams,chunks:s.chunks+b.chunks,bytes:s.bytes+b.bytes,entries:s.entries+b.entries}}catch{break}return s}async metricFindQuery(t){if(!t)return Promise.resolve([]);if(typeof t=="string"){const r=this.interpolateString(t);return await this.legacyProcessMetricFindQuery(r)}const e={...t,label:this.interpolateString(t.label||""),stream:this.interpolateString(t.stream||"")};return await this.processMetricFindQuery(e)}async processMetricFindQuery(t){return t.type===R.Z3.LabelNames?this.labelNamesQuery():t.label?t.stream?this.labelValuesSeriesQuery(t.stream,t.label):this.labelValuesQuery(t.label):[]}async legacyProcessMetricFindQuery(t){if(t.match(gt))return await this.labelNamesQuery();const r=t.match(ht);return r?r[1]?await this.labelValuesSeriesQuery(r[1],r[2]):await this.labelValuesQuery(r[2]):Promise.resolve([])}async labelNamesQuery(){const t="labels",e=this.getTimeRangeParams();return(await this.metadataRequest(t,e)).map(n=>({text:n}))}async labelValuesQuery(t){const e=this.getTimeRangeParams(),r=`label/${t}/values`;return(await this.metadataRequest(r,e)).map(s=>({text:s}))}async labelValuesSeriesQuery(t,e){const n={...this.getTimeRangeParams(),"match[]":t},s="series",m=new Set;return(await this.metadataRequest(s,n)).forEach(v=>{v[e]&&m.add({text:v[e]})}),Array.from(m)}async getDataSamples(t){if(!(0,le.RT)(t.expr)||!(0,le.rE)(t.expr))return[];const e={expr:t.expr,queryType:R.EM.Range,refId:xe,maxLines:10},r=(0,U.JK)(),n=Me(e,r,p.zj.Unknown,xe,!0);return await(0,a.n)(this.query(n).pipe((0,V.w)(s=>(0,K.of)(s.data))))}async getTagKeys(){return await this.labelNamesQuery()}async getTagValues(t={}){return await this.labelValuesQuery(t.key)}interpolateQueryExpr(t,e){return!e.multi&&!e.includeAll?Ue(t):typeof t=="string"?we(t):(0,C.map)(t,we).join("|")}modifyQuery(t,e){let r=t.expr??"";switch(e.type){case"ADD_FILTER":{if(e.options?.key&&e.options?.value){const n=(0,he.Hk)(e.options.value);r=(0,ue.F2)(r,e.options.key,"=",n)}break}case"ADD_FILTER_OUT":{if(e.options?.key&&e.options?.value){const n=(0,he.Hk)(e.options.value);r=(0,ue.F2)(r,e.options.key,"!=",n)}break}case"ADD_LOGFMT_PARSER":{r=(0,ue.Pg)(r,"logfmt");break}case"ADD_JSON_PARSER":{r=(0,ue.Pg)(r,"json");break}case"ADD_NO_PIPELINE_ERROR":{r=(0,ue.cT)(r);break}case"ADD_LEVEL_LABEL_FORMAT":{e.options?.originalLabel&&e.options?.renameTo&&(r=(0,ue.NT)(r,{renameTo:e.options.renameTo,originalLabel:e.options.originalLabel}));break}case"ADD_LABEL_FILTER":{const n=(0,ue.qC)(t.expr),s=(0,ue.st)(t.expr),m=(0,ue.EF)([...n,...s]),b=(0,ue.y2)("","","=");r=(0,ue.g8)(r,[m],b);break}case"ADD_LINE_FILTER":{r=(0,ue.Ld)(r);break}default:break}return{...t,expr:r}}getTime(t,e){return typeof t=="string"&&(t=N.parse(t,e)),Math.ceil(t.valueOf()*1e6)}async prepareContextExprWithoutParsedLabels(t,e){await this.languageProvider.start();const r=this.languageProvider.getLabelKeys();return`{${Object.keys(t.labels).map(s=>r.includes(s)?`${s}="${(0,he.U9)(t.labels[s])}"`:"").filter(s=>!!s).join(",")}}`}async prepareContextExpr(t,e){return await this.prepareContextExprWithoutParsedLabels(t,e)}getLogRowContextUi(t,e){const r=n=>{this.prepareContextExpr=async(s,m)=>{await this.languageProvider.start();const b=this.languageProvider.getLabelKeys();let v=n.map(S=>{const w=S.value;return S&&!S.fromParser&&S.enabled&&b.includes(w)?`${w}="${(0,he.U9)(s.labels[w])}"`:""}).filter(S=>!!S).join(",");v=`{${v}}`;const L=n.filter(S=>S.fromParser&&S.enabled);if(L.length){if(m){const S=(0,le.oi)(m.expr);S&&(v=(0,ue.Pg)(v,S))}for(const S of L)S.enabled&&(v=(0,ue.F2)(v,S.label,"=",s.labels[S.label]))}return v},e&&e()};return this.onContextClose=this.onContextClose??(()=>{this.prepareContextExpr=this.prepareContextExprWithoutParsedLabels}),ar({row:t,updateFilter:r,languageProvider:this.languageProvider,onClose:this.onContextClose})}testDatasource(){const t=Date.now(),e={start:(t-10*60*1e3)*Qe,end:t*Qe};return this.metadataRequest("labels",e).then(r=>r.length>0?{status:"success",message:"Data source connected and labels found."}:{status:"error",message:"Data source connected, but no labels received. Verify that Loki and Promtail is configured properly."},r=>{const n=r?.data?.message??"";return{status:"error",message:`Unable to fetch labels from Loki${n!==""?` (${n})`:""}, please check the server logs for more details`}})}async annotationQuery(t){const{expr:e,maxLines:r,instant:n,tagKeys:s="",titleFormat:m="",textFormat:b=""}=t.annotation;if(!e)return[];const v=`${Tt}${t.annotation.name}`,L={refId:v,expr:e,maxLines:r,instant:n,queryType:n?R.EM.Instant:R.EM.Range},S=Me(L,t.range,p.zj.Dashboard,v),{data:w}=await(0,a.n)(this.query(S)),G=[],B=s.split(",").filter(j=>j!=="");for(const j of w)new Y.U(j).forEach(re=>{const{labels:ae}=re,pe=Object.entries(ae).map(([de,ne])=>[de,ne.trim()]).filter(([de,ne])=>!(ne===""||B.length&&!B.includes(de))).map(([de,ne])=>ne),ie=Array.from(new Set(pe));G.push({time:new Date(re.Time).valueOf(),title:(0,i.W)(m,ae),text:(0,i.W)(b,ae)||re.Line,tags:ie})});return G}showContextToggle(t){return(t&&t.searchWords&&t.searchWords.length>0)===!0}processError(t,e){let r=(0,C.cloneDeep)(t);return r.refId=e.refId,r.data&&t.data.message.includes("escape")&&e.expr.includes("\\")&&(r.data.message=`Error: ${t.data.message}. Make sure that all special characters are escaped with \\. For more information on escaping of special characters visit LogQL documentation at https://grafana.com/docs/loki/latest/logql/.`),r}addAdHocFilters(t){const e=this.templateSrv.getAdhocFilters(this.name);let r=(0,d.bU)(t);return r=e.reduce((n,s)=>{const{key:m,operator:b}=s;let{value:v}=s;return(0,he._z)(b)?v=Ue(v):v=(0,he.Hk)(v,b),(0,ue.F2)(n,m,b,v)},r),(0,d.Tt)(r)}filterQuery(t){return!(t.hide||t.expr==="")}applyTemplateVariables(t,e){const{__interval:r,__interval_ms:n,...s}=e||{},m=this.addAdHocFilters(t.expr);return{...t,legendFormat:this.templateSrv.replace(t.legendFormat,s),expr:this.templateSrv.replace(m,s,this.interpolateQueryExpr)}}interpolateString(t,e){return this.templateSrv.replace(t,e,this.interpolateQueryExpr)}getVariables(){return this.templateSrv.getVariables().map(t=>`$${t.name}`)}getQueryHints(t,e){return sr(t.expr,e)}}function Ue(c){return typeof c=="string"?c.replace(/'/g,"\\\\'"):c}function we(c){return typeof c=="string"?Ue(c.replace(/\\/g,"\\\\\\\\").replace(/[$^*{}\[\]+?.()|]/g,"\\\\$&")):c}function br(c){let t;try{t=new q.N(c).getFirstFieldOfType(z.fS.number)}catch{}return t?.labels?fe(t.labels):W.in.unknown}function fe(c){const t=["level","lvl","loglevel"];let e;for(let r of t)if(r in c){e=r;break}return e?(0,u.jx)(c[e]):W.in.unknown}},88590:(me,H,o)=>{o.d(H,{C6:()=>J,EF:()=>X,F2:()=>k,Ld:()=>D,NT:()=>ce,Pg:()=>V,Xw:()=>q,cT:()=>ee,g8:()=>te,qC:()=>p,st:()=>A,y2:()=>N});var C=o(82897),P=o.n(C),a=o(78252),K=o(31439),g=o(39682),Q=o(21745);function k(i,d,f,h){if(!d||!h)throw new Error("Need label to add to query.");const l=q(i),O=z(i),E=l.every(R=>O.some(_=>_.from>=R.from&&_.to<=R.to)),x=p(i),F=A(i);if(!l.length)return i;const y=N(d,h,f);if(E&&(F.length||x.length)){const R=X([...F,...x]);return te(i,[R],y)}else return Y(i,l,y)}function V(i,d){const f=W(i);if(f.length)return Z(i,f,d);{const h=q(i);return Z(i,h,d)}}function ee(i){const d=p(i);if(!d.length)return i;const f=N("__error__","","=");return te(i,d,f)}function ce(i,d){const f=U(i);return se(i,f,d)}function J(i){const d=T(i);if(!d.length)return i;let f="",h=0;for(let l of d)f=f+i.substring(h,l.from),h=l.to;return f}function q(i){const d=a.E2.parse(i),f=[];return d.iterate({enter:({type:h,from:l,to:O})=>{if(h.id===a.Qf)return f.push({from:l,to:O}),!1}}),f}function z(i){const d=a.E2.parse(i),f=[];return d.iterate({enter:({node:h})=>{h.type.id===a.Qf&&f.push(...u(i,h,a.xO))}}),f}function p(i){const d=a.E2.parse(i),f=[];return d.iterate({enter:({type:h,from:l,to:O})=>{if(h.id===a.Li||h.id===a.Lu)return f.push({from:l,to:O}),!1}}),f}function A(i){const d=a.E2.parse(i),f=[];return d.iterate({enter:({type:h,from:l,to:O})=>{if(h.id===a.pj)return f.push({from:l,to:O}),!1}}),f}function W(i){const d=a.E2.parse(i),f=[];return d.iterate({enter:({type:h,node:l})=>{if(h.id===a.wm)return f.push({from:l.from,to:l.to}),!1}}),f}function U(i){const d=a.E2.parse(i),f=[];return d.iterate({enter:({type:h,from:l,to:O,node:E})=>{if(h.id===a.bL)return f.push({from:l,to:O}),!1;if(h.id===a.UN){const x=[],F=E.getChild(a.Qf);F&&x.push({from:F.from,to:F.to});const y=E.getChild(a.iP);y&&x.push({from:y.from,to:y.to});const R=E.getChild(a.Xt);R&&x.push({from:R.from,to:R.to});const _=(0,C.sortBy)(x,oe=>oe.to);return f.push({from:_[0].from,to:_[_.length-1].to}),!1}}}),f}function N(i,d,f){return{label:i,op:f,value:d}}function Y(i,d,f){const h=new g.Y;let l="",O=0;for(let E=0;E<d.length;E++){const x=d[E],F=E===d.length-1,y=i.substring(O,x.from),R=F?i.substring(x.to):"",_=(0,Q._)(i.substring(x.from,x.to));$(_.query.labels,f)||_.query.labels.push(f);const oe=h.renderQuery(_.query);l+=y+oe+R,O=x.to}return l}function te(i,d,f){let h="",l=0;for(let O=0;O<d.length;O++){const E=d[O],x=O===d.length-1,F=i.substring(l,E.to),y=x?i.substring(E.to):"",R=` | ${f.label}${f.op}\`${(0,K.iS)(f.value)}\``;h+=F+R+y,l=E.to}return h}function Z(i,d,f){let h="",l=0;for(let O=0;O<d.length;O++){const E=d[O],x=O===d.length-1,F=i.substring(l,E.to),y=x?i.substring(E.to):"";h+=F+` | ${f}`+y,l=E.to}return h}function se(i,d,f){let h="",l=0;for(let O=0;O<d.length;O++){const E=d[O],x=O===d.length-1,F=i.substring(l,E.to),y=x?i.substring(E.to):"",R=` | label_format ${f.renameTo}=${f.originalLabel}`;h+=F+R+y,l=E.to}return h}function D(i){const f=q(i)[0].to;return i.slice(0,f)+" |= ``"+i.slice(f)}function T(i){const d=a.E2.parse(i),f=[];return d.iterate({enter:({type:h,from:l,to:O})=>{if(h.id===a.gD)return f.push({from:l,to:O}),!1}}),f}function $(i,d){return i.find(f=>f.label===d.label&&f.value===d.value)}function X(i){return i.reduce((d,f)=>d.to>f.to?d:f)}function u(i,d,f){if(d.type.id===f)return[{from:d.from,to:d.to}];const h=[];let l=0,O=d.childAfter(l);for(;O;)h.push(...u(i,O,f)),l=O.to,O=d.childAfter(l);return h}},24666:(me,H,o)=>{o.d(H,{H6:()=>q,Ib:()=>ee,Iu:()=>Z,N7:()=>N,QI:()=>D,Qh:()=>se,RT:()=>p,SP:()=>te,cQ:()=>W,dQ:()=>z,hI:()=>Y,n6:()=>V,oi:()=>U,rE:()=>A,x9:()=>k});var C=o(82897),P=o.n(C),a=o(78252),K=o(44812),g=o(88590),Q=o(92555);function k(T){return`${T||""}`.trim()}function V(T){const $=[],X=a.E2.parse(T),u=[];X.iterate({enter:({type:i,node:d})=>{i.id===a.yx&&u.push(d)}});for(let i of u){const d=i.getChild(a.wn)?.getChild(a.OC),f=i.getChild(a.wn)?.getChild(a.Ih),h=i.getChild(a.Ld);if(!d&&!f||!h)continue;const l=T.substring(h.from,h.to).trim(),O=l[0]==="`",E=l.substring(1,l.length-1);if(!E)continue;let x="";f?x=O?E:E.replace(/\\\\/g,"\\"):x=(0,C.escapeRegExp)(E),x&&$.push(x)}return $}function ee(T){const{queryType:$}=T;if($===Q.EM.Range||$===Q.EM.Instant||$===Q.EM.Stream){const{instant:f,range:h,...l}=T;return l}if(T.instant===!0){const{instant:f,range:h,...l}=T;return{...l,queryType:Q.EM.Instant}}const{instant:u,range:i,...d}=T;return{...d,queryType:Q.EM.Range}}const ce=["String","Identifier","LineComment","Number"],J=["__error__","__interval","__interval_ms"];function q(T){let $=T;return a.E2.parse(T).iterate({enter:({name:u,from:i,to:d})=>{const f=T.substring(i,d);ce.includes(u)&&!J.includes(f)&&($=$.replace(f,u))}}),$}function z(T){const $=[];return a.E2.parse(T).iterate({enter:({name:u})=>{$.push(u)}}),$}function p(T){let $=!0;return a.E2.parse(T).iterate({enter:({type:u})=>{u.id===K._A&&($=!1)}}),$}function A(T){let $=!0;return a.E2.parse(T).iterate({enter:({type:u})=>{u.id===a.cq&&($=!1)}}),$}function W(T){let $=0;return a.E2.parse(T).iterate({enter:({type:u})=>{(u.id===a.Li||u.id===a.Lu)&&$++}}),{queryWithParser:$>0,parserCount:$}}function U(T){const $=a.E2.parse(T);let X;return $.iterate({enter:u=>{if(u.type.id===a.Li||u.type.id===a.Lu)return X=T.substring(u.from,u.to).trim(),!1}}),X}function N(T){let $=!1;return a.E2.parse(T).iterate({enter:({type:u,node:i})=>{if(u.id===a.pj){const d=i.getChild(a.xO)?.getChild(a.xb);d&&T.substring(d.from,d.to)==="__error__"&&($=!0)}}}),$}function Y(T){let $=!1;return a.E2.parse(T).iterate({enter:({type:u})=>{u.id===a.zV&&($=!0)}}),$}function te(T){if(A(T))return T;const $=a.E2.parse(T);let X="";$.iterate({enter:({type:i,from:d,to:f})=>{if(i.id===a.Qf)return X=T.substring(d,f),!1}});let u="";return $.iterate({enter:({type:i,from:d,to:f})=>{if(i.id===a.iP)return u=T.substring(d,f),!1}}),X+u}function Z(T){const $=a.E2.parse(T);let X=!1;return $.iterate({enter:({type:u,node:i})=>{if(u.id===a.pj){X=!0;return}}}),X}function se(T){const $=a.E2.parse(T);let X=!1;return $.iterate({enter:({type:u})=>{if(u.id===a.yx){X=!0;return}}}),X}function D(T){return(0,g.Xw)(T).map(u=>T.slice(u.from,u.to))}},39682:(me,H,o)=>{o.d(H,{Y:()=>K,y:()=>g});var C=o(78625),P=o(58382),a=o(91720);class K extends C.x{constructor(){super(P._f),this.setOperationCategories([a.Ly.Aggregations,a.Ly.RangeFunctions,a.Ly.Formats,a.Ly.BinaryOps,a.Ly.LabelFilters,a.Ly.LineFilters])}renderLabels(k){return k.length===0?"{}":super.renderLabels(k)}getQueryPatterns(){return[{name:"Parse log lines with logfmt parser",type:a.Hv.Log,operations:[{id:a.B5.Logfmt,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]}]},{name:"Parse log lines with JSON parser",type:a.Hv.Log,operations:[{id:a.B5.Json,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]}]},{name:"Filter log line and parse with logfmt parser",type:a.Hv.Log,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.Logfmt,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]}]},{name:"Filter log lines and parse with json parser",type:a.Hv.Log,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.Json,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]}]},{name:"Parse log line with logfmt parser and use label filter",type:a.Hv.Log,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.Logfmt,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]},{id:a.B5.LabelFilter,params:["label","=","value"]}]},{name:"Parse log lines with nested json",type:a.Hv.Log,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.Json,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]},{id:a.B5.LineFormat,params:["{{.message}}"]},{id:a.B5.Json,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]}]},{name:"Reformat log lines",type:a.Hv.Log,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.Logfmt,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]},{id:a.B5.LineFormat,params:["{{.message}}"]}]},{name:"Rename lvl label to level",type:a.Hv.Log,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.Logfmt,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]},{id:a.B5.LabelFormat,params:["lvl","level"]}]},{name:"Query on value inside a log line",type:a.Hv.Metric,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.Logfmt,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]},{id:a.B5.Unwrap,params:[""]},{id:a.B5.LabelFilterNoErrors,params:[]},{id:a.B5.SumOverTime,params:["$__interval"]},{id:a.B5.Sum,params:[]}]},{name:"Total requests per label of streams",type:a.Hv.Metric,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.CountOverTime,params:["$__interval"]},{id:a.B5.Sum,params:[]}]},{name:"Total requests per parsed label or label of streams",type:a.Hv.Metric,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.Logfmt,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]},{id:a.B5.CountOverTime,params:["$__interval"]},{id:a.B5.Sum,params:[]}]},{name:"Bytes used by a log stream",type:a.Hv.Metric,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.BytesOverTime,params:["$__interval"]}]},{name:"Count of log lines per stream",type:a.Hv.Metric,operations:[{id:a.B5.LineContains,params:[""]},{id:a.B5.CountOverTime,params:["$__interval"]}]},{name:"Top N results by label or parsed label",type:a.Hv.Metric,operations:[{id:a.B5.Logfmt,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]},{id:a.B5.CountOverTime,params:["$__interval"]},{id:a.B5.Sum,params:[]},{id:a.B5.TopK,params:[10]}]},{name:"Extracted quantile",type:a.Hv.Metric,operations:[{id:a.B5.Logfmt,params:[]},{id:a.B5.LabelFilterNoErrors,params:[]},{id:a.B5.Unwrap,params:["latency"]},{id:a.B5.LabelFilterNoErrors,params:[]},{id:a.B5.QuantileOverTime,params:["$__interval",.5]},{id:a.B5.Sum,params:[]}]}]}}const g=new K},75215:(me,H,o)=>{o.d(H,{E:()=>K,i:()=>a});var C=o(8373),P=o(91720);const a=[{id:P.B5.Addition,name:"Add scalar",sign:"+"},{id:P.B5.Subtraction,name:"Subtract scalar",sign:"-"},{id:P.B5.MultiplyBy,name:"Multiply by scalar",sign:"*"},{id:P.B5.DivideBy,name:"Divide by scalar",sign:"/"},{id:P.B5.Modulo,name:"Modulo by scalar",sign:"%"},{id:P.B5.Exponent,name:"Exponent",sign:"^"},{id:P.B5.EqualTo,name:"Equal to",sign:"==",comparison:!0},{id:P.B5.NotEqualTo,name:"Not equal to",sign:"!=",comparison:!0},{id:P.B5.GreaterThan,name:"Greater than",sign:">",comparison:!0},{id:P.B5.LessThan,name:"Less than",sign:"<",comparison:!0},{id:P.B5.GreaterOrEqual,name:"Greater or equal to",sign:">=",comparison:!0},{id:P.B5.LessOrEqual,name:"Less or equal to",sign:"<=",comparison:!0}],K=a.map(Q=>{const k=[{name:"Value",type:"number"}],V=[2];return Q.comparison&&(k.unshift({name:"Bool",type:"boolean",description:"If checked comparison will return 0 or 1 for the value rather than filtering."}),V.unshift(!1)),{id:Q.id,name:Q.name,params:k,defaultParams:V,alternativesKey:"binary scalar operations",category:P.Ly.BinaryOps,renderer:g(Q.sign),addOperationHandler:C.PP}});function g(Q){return function(V,ee,ce){let J=V.params[0],q="";return V.params.length===2&&(J=V.params[1],q=V.params[0]?" bool":""),`${ce} ${Q}${q} ${J}`}}},58382:(me,H,o)=>{o.d(H,{j$:()=>h,kf:()=>d,XK:()=>f,_f:()=>u});var C=o(8373),P=o(75215),a=o(68404),K=o(63134),g=o(53217),Q=o(85444),k=o(24666),V=o(87826),ee=o(39682);function ce({onChange:l,index:O,operationIndex:E,value:x,query:F,datasource:y}){const[R,_]=(0,a.useState)({});return a.createElement(g.Ph,{inputId:(0,C.i1)(E,O),onOpenMenu:async()=>{if(y instanceof Q.KV){_({isLoading:!0});const oe=await J(F,y);_({options:oe,isLoading:void 0})}},isLoading:R.isLoading,allowCustomValue:!0,noOptionsMessage:"No labels found",loadingMessage:"Loading labels",options:R.options,value:x?(0,K.E)(x.toString()):null,onChange:oe=>{oe.value&&l(O,oe.value)}})}async function J(l,O){const E=ee.y.renderQuery(l),x=(0,k.SP)(E);if(!(0,k.RT)(x))return[];const F=await O.getDataSamples({expr:x,refId:"unwrap_samples"});return(0,V.zb)(F[0]).map(_=>({label:_,value:_}))}var q=o(31075),z=o(19370),p=o(91720);function A(l,O){const E=[X()],x=["$__interval"];let F;return l===p.B5.QuantileOverTime&&(x.push("0.95"),E.push({name:"Quantile",type:"number"})),O&&(E.push({name:"By label",type:"string",restParam:!0,optional:!0}),F=(0,C.ZI)(`__${l}_by`)),{id:l,name:(0,C.t7)(l),params:E,defaultParams:x,alternativesKey:"range function",category:p.Ly.RangeFunctions,orderRank:p.jK.RangeVectorFunction,renderer:N,addOperationHandler:D,paramChangedHandler:F,explainHandler:(y,R)=>{let _=z.r8.find(oe=>oe.insertText===y.id)?.documentation??"";return y.params[0]==="$__interval"?`${_} \`$__interval\` is a variable that will be replaced with the [calculated interval](https://grafana.com/docs/grafana/latest/dashboards/variables/add-template-variables/#__interval) based on the time range and width of the graph. In Dashboards, you can affect the interval variable using **Max data points** and **Min interval**. You can find these options under **Query options** right of the data source select dropdown.`:`${_} The [range vector](https://grafana.com/docs/loki/latest/logql/metric_queries/#range-vector-aggregation) is set to \`${y.params[0]}\`.`}}}function W(l){const O=A(l,!0),E=O.params.slice(0,-1);return[O,{id:`__${l}_by`,name:`${(0,C.t7)(l)} by`,params:[...E,{name:"Label",type:"string",restParam:!0,optional:!0,editor:q.g}],defaultParams:[...O.defaultParams,""],alternativesKey:"range function with grouping",category:p.Ly.RangeFunctions,renderer:U(l,"by"),paramChangedHandler:(0,C.j8)(l),explainHandler:(0,C.Sp)(l,"by"),addOperationHandler:D,hideFromList:!0},{id:`__${l}_without`,name:`${(0,C.t7)(l)} without`,params:[...E,{name:"Label",type:"string",restParam:!0,optional:!0,editor:q.g}],defaultParams:[...O.defaultParams,""],alternativesKey:"range function with grouping",category:p.Ly.RangeFunctions,renderer:U(l,"without"),paramChangedHandler:(0,C.j8)(l),explainHandler:(0,C.Sp)(l,"without"),addOperationHandler:D,hideFromList:!0}]}function U(l,O){return function(x,F,y){const R=F.params.findIndex(Te=>Te.restParam),_=x.params.slice(0,R),oe=x.params.slice(R);return _.length===2&&l===p.B5.QuantileOverTime?`${l}(${_[1]}, ${y} [${_[0]}]) ${O} (${oe.join(", ")})`:`${l}(${y} [${_[0]}]) ${O} (${oe.join(", ")})`}}function N(l,O,E){const x=l.params??[],F=x[0]??"$__interval";if(x.length===2&&l.id===p.B5.QuantileOverTime){const y=x[1];return`${l.id}(${y}, ${E} [${F}])`}return`${l.id}(${E} [${x[0]??"$__interval"}])`}function Y(l,O,E){return["<","<=",">",">="].includes(String(l.params[1]))?`${E} | ${l.params[0]} ${l.params[1]} ${l.params[2]}`:`${E} | ${l.params[0]} ${l.params[1]} \`${l.params[2]}\``}function te(l,O,E){return`${E} | ${l.id}`}function Z(l){return l.category===p.Ly.RangeFunctions}function se(l,O,E){const x=l.findIndex(F=>{const y=O.getOperationDef(F.id);return y?E(y):!1});return x===-1?l.length:x}function D(l,O,E){const x={id:l.id,params:l.defaultParams},F=[...O.operations],y=F.find(R=>{const _=E.getOperationDef(R.id);return _?Z(_):!1});switch(l.category){case p.Ly.Aggregations:case p.Ly.Functions:if(!y){const _=se(F,E,oe=>oe.category===p.Ly.Functions);F.splice(_,0,{id:p.B5.Rate,params:["$__interval"]})}F.push(x);break;case p.Ly.RangeFunctions:if(y){const _=F.indexOf(y);F[_]=x;break}default:const R=se(F,E,_=>(l.orderRank??100)<(_.orderRank??100));F.splice(R,0,x);break}return{...O,operations:F}}function T(l,O){return{...O,binaryQueries:[...O.binaryQueries??[],{operator:"/",query:O}]}}function $(l,O){return function(x,F,y){return O?`${y} ${l} \`(?i)${x.params[0]}\``:`${y} ${l} \`${x.params[0]}\``}}function X(){return{name:"Range",type:"string",options:["$__interval","$__range","1m","5m","10m","1h","24h"]}}function u(){const l=[p.B5.Sum,p.B5.Min,p.B5.Max,p.B5.Avg,p.B5.Stddev,p.B5.Stdvar,p.B5.Count].flatMap(y=>(0,C.IT)(y,{addOperationHandler:D,orderRank:p.jK.Last})),O=[p.B5.TopK,p.B5.BottomK].flatMap(y=>(0,C.Z3)(y,{params:[{name:"K-value",type:"number"}],defaultParams:[5]},{addOperationHandler:D,orderRank:p.jK.Last})),E=[A(p.B5.Rate),A(p.B5.RateCounter),A(p.B5.CountOverTime),A(p.B5.SumOverTime),A(p.B5.BytesRate),A(p.B5.BytesOverTime),A(p.B5.AbsentOverTime)],x=[...W(p.B5.AvgOverTime),...W(p.B5.MaxOverTime),...W(p.B5.MinOverTime),...W(p.B5.FirstOverTime),...W(p.B5.LastOverTime),...W(p.B5.StdvarOverTime),...W(p.B5.StddevOverTime),...W(p.B5.QuantileOverTime)];return[...l,...O,...E,...x,{id:p.B5.Json,name:"Json",params:[{name:"Expression",type:"string",restParam:!0,optional:!0,minWidth:18,placeholder:'server="servers[0]"',description:"Using expressions with your json parser will extract only the specified json fields to labels. You can specify one or more expressions in this way. All expressions must be quoted."}],defaultParams:[],alternativesKey:"format",category:p.Ly.Formats,orderRank:p.jK.LineFormats,renderer:(y,R,_)=>`${_} | json ${y.params.join(", ")}`.trim(),addOperationHandler:D,explainHandler:()=>"This will extract keys and values from a [json](https://grafana.com/docs/loki/latest/logql/log_queries/#json) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:p.B5.Logfmt,name:"Logfmt",params:[],defaultParams:[],alternativesKey:"format",category:p.Ly.Formats,orderRank:p.jK.LineFormats,renderer:te,addOperationHandler:D,explainHandler:()=>"This will extract all keys and values from a [logfmt](https://grafana.com/docs/loki/latest/logql/log_queries/#logfmt) formatted log line as labels. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:p.B5.Regexp,name:"Regexp",params:[{name:"String",type:"string",hideName:!0,placeholder:"<re>",description:"The regexp expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:p.Ly.Formats,orderRank:p.jK.LineFormats,renderer:(y,R,_)=>`${_} | regexp \`${y.params[0]}\``,addOperationHandler:D,explainHandler:()=>'The [regexp parser](https://grafana.com/docs/loki/latest/logql/log_queries/#regular-expression) takes a single parameter | regexp "<re>" which is the regular expression using the Golang RE2 syntax. The regular expression must contain a least one named sub-match (e.g (?P<name>re)), each sub-match will extract a different label. The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation.'},{id:p.B5.Pattern,name:"Pattern",params:[{name:"String",type:"string",hideName:!0,placeholder:"<pattern-expression>",description:"The expression that matches the structure of a log line.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:p.Ly.Formats,orderRank:p.jK.LineFormats,renderer:(y,R,_)=>`${_} | pattern \`${y.params[0]}\``,addOperationHandler:D,explainHandler:()=>"The [pattern parser](https://grafana.com/docs/loki/latest/logql/log_queries/#pattern) allows the explicit extraction of fields from log lines by defining a pattern expression (| pattern `<pattern-expression>`). The expression matches the structure of a log line. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:p.B5.Unpack,name:"Unpack",params:[],defaultParams:[],alternativesKey:"format",category:p.Ly.Formats,orderRank:p.jK.LineFormats,renderer:te,addOperationHandler:D,explainHandler:()=>"This will extract all keys and values from a JSON log line, [unpacking](https://grafana.com/docs/loki/latest/logql/log_queries/#unpack) all embedded labels in the pack stage. The extracted labels can be used in label filter expressions and used as values for a range aggregation via the unwrap operation."},{id:p.B5.LineFormat,name:"Line format",params:[{name:"String",type:"string",hideName:!0,placeholder:"{{.status_code}}",description:"A line template that can refer to stream labels and extracted labels.",minWidth:20}],defaultParams:[""],alternativesKey:"format",category:p.Ly.Formats,orderRank:p.jK.LineFormats,renderer:(y,R,_)=>`${_} | line_format \`${y.params[0]}\``,addOperationHandler:D,explainHandler:()=>`This will replace log line using a specified template. The template can refer to stream labels and extracted labels.

Example: \`{{.status_code}} - {{.message}}\`

[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#line-format-expression) for more.
        `},{id:p.B5.LabelFormat,name:"Label format",params:[{name:"Label",type:"string"},{name:"Rename to",type:"string"}],defaultParams:["",""],alternativesKey:"format",category:p.Ly.Formats,orderRank:p.jK.LineFormats,renderer:(y,R,_)=>`${_} | label_format ${y.params[1]}=${y.params[0]}`,addOperationHandler:D,explainHandler:()=>'This will change name of label to desired new label. In the example below, label "error_level" will be renamed to "level".\n\nExample: ``error_level=`level` ``\n\n[Read the docs](https://grafana.com/docs/loki/latest/logql/log_queries/#labels-format-expression) for more.\n        '},{id:p.B5.LineContains,name:"Line contains",params:[{name:"String",type:"string",hideName:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:20,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:p.Ly.LineFilters,orderRank:p.jK.LineFilters,renderer:$("|="),addOperationHandler:D,explainHandler:y=>`Return log lines that contain string \`${y.params[0]}\`.`},{id:p.B5.LineContainsNot,name:"Line does not contain",params:[{name:"String",type:"string",hideName:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:26,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:p.Ly.LineFilters,orderRank:p.jK.LineFilters,renderer:$("!="),addOperationHandler:D,explainHandler:y=>`Return log lines that does not contain string \`${y.params[0]}\`.`},{id:p.B5.LineContainsCaseInsensitive,name:"Line contains case insensitive",params:[{name:"String",type:"string",hideName:!0,placeholder:"Text to find",description:"Find log lines that contains this text",minWidth:33,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:p.Ly.LineFilters,orderRank:p.jK.LineFilters,renderer:$("|~",!0),addOperationHandler:D,explainHandler:y=>`Return log lines that match regex \`(?i)${y.params[0]}\`.`},{id:p.B5.LineContainsNotCaseInsensitive,name:"Line does not contain case insensitive",params:[{name:"String",type:"string",hideName:!0,placeholder:"Text to exclude",description:"Find log lines that does not contain this text",minWidth:40,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:p.Ly.LineFilters,orderRank:p.jK.LineFilters,renderer:$("!~",!0),addOperationHandler:D,explainHandler:y=>`Return log lines that does not match regex \`(?i)${y.params[0]}\`.`},{id:p.B5.LineMatchesRegex,name:"Line contains regex match",params:[{name:"Regex",type:"string",hideName:!0,placeholder:"Pattern to match",description:"Find log lines that match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:p.Ly.LineFilters,orderRank:p.jK.LineFilters,renderer:$("|~"),addOperationHandler:D,explainHandler:y=>`Return log lines that match a \`RE2\` regex pattern. \`${y.params[0]}\`.`},{id:p.B5.LineMatchesRegexNot,name:"Line does not match regex",params:[{name:"Regex",type:"string",hideName:!0,placeholder:"Pattern to exclude",description:"Find log lines that does not match this regex pattern",minWidth:30,runQueryOnEnter:!0}],defaultParams:[""],alternativesKey:"line filter",category:p.Ly.LineFilters,orderRank:p.jK.LineFilters,renderer:$("!~"),addOperationHandler:D,explainHandler:y=>`Return log lines that doesn't match a \`RE2\` regex pattern. \`${y.params[0]}\`.`},{id:p.B5.LineFilterIpMatches,name:"IP line filter expression",params:[{name:"Operator",type:"string",options:["|=","!="]},{name:"Pattern",type:"string",placeholder:"<pattern>",minWidth:16,runQueryOnEnter:!0}],defaultParams:["|=",""],alternativesKey:"line filter",category:p.Ly.LineFilters,orderRank:p.jK.LineFilters,renderer:(y,R,_)=>`${_} ${y.params[0]} ip(\`${y.params[1]}\`)`,addOperationHandler:D,explainHandler:y=>`Return log lines using IP matching of \`${y.params[1]}\``},{id:p.B5.LabelFilter,name:"Label filter expression",params:[{name:"Label",type:"string"},{name:"Operator",type:"string",options:["=","!="," =~","!~",">","<",">=","<="]},{name:"Value",type:"string"}],defaultParams:["","=",""],alternativesKey:"label filter",category:p.Ly.LabelFilters,orderRank:p.jK.LabelFilters,renderer:Y,addOperationHandler:D,explainHandler:()=>"Label expression filter allows filtering using original and extracted labels."},{id:p.B5.LabelFilterIpMatches,name:"IP label filter expression",params:[{name:"Label",type:"string"},{name:"Operator",type:"string",options:["=","!="]},{name:"Value",type:"string"}],defaultParams:["","=",""],alternativesKey:"label filter",category:p.Ly.LabelFilters,orderRank:p.jK.LabelFilters,renderer:(y,R,_)=>`${_} | ${y.params[0]} ${y.params[1]} ip(\`${y.params[2]}\`)`,addOperationHandler:D,explainHandler:y=>`Return log lines using IP matching of \`${y.params[2]}\` for \`${y.params[0]}\` label`},{id:p.B5.LabelFilterNoErrors,name:"No pipeline errors",params:[],defaultParams:[],alternativesKey:"label filter",category:p.Ly.LabelFilters,orderRank:p.jK.NoErrors,renderer:(y,R,_)=>`${_} | __error__=\`\``,addOperationHandler:D,explainHandler:()=>"Filter out all formatting and parsing errors."},{id:p.B5.Unwrap,name:"Unwrap",params:[{name:"Identifier",type:"string",hideName:!0,minWidth:16,placeholder:"Label key",editor:ce},{name:"Conversion function",hideName:!0,type:"string",options:["duration","duration_seconds","bytes"],optional:!0}],defaultParams:["",""],alternativesKey:"format",category:p.Ly.Formats,orderRank:p.jK.Unwrap,renderer:(y,R,_)=>`${_} | unwrap ${y.params[1]?`${y.params[1]}(${y.params[0]})`:y.params[0]}`,addOperationHandler:D,explainHandler:y=>{let R=String(y.params[0]).length>0?y.params[0]:"<label>";return`Use the extracted label \`${R}\` as sample values instead of log lines for the subsequent range aggregation.${y.params[1]?` Conversion function \`${y.params[1]}\` wrapping \`${R}\` will attempt to convert this label from a specific format (e.g. 3k, 500ms).`:""}`}},...P.E,{id:p.B5.NestedQuery,name:"Binary operation with query",params:[],defaultParams:[],category:p.Ly.BinaryOps,renderer:(y,R,_)=>_,addOperationHandler:T}]}const i=u();function d(l){return(i.find(x=>x.id===l)?.explainHandler?.({id:"",params:["<value>"]})||"").replace(/\[(.*)\]\(.*\)/g,"$1")}function f(l){return i.find(O=>O.id===l)}function h(l,O){return!(O.length<l.params.filter(E=>!E.optional).length)}},21745:(me,H,o)=>{o.d(H,{_:()=>k});var C=o(74899),P=o(78252),a=o(44812),K=o(75215),g=o(58382),Q=o(91720);function k(u){const i=(0,a.bU)(u),f=P.E2.parse(i).topNode,l={query:{labels:[],operations:[]},errors:[]};try{V(i,f,l)}catch(O){console.error(O),O instanceof Error&&l.errors.push({text:O.message})}return X(l.query)&&(l.errors=[]),l}function V(u,i,d){const f=d.query;switch(i.type.id){case P.xO:{f.labels.push(ee(u,i));const h=i.getChild(a._A);h&&d.errors.push((0,a.wf)(u,h));break}case P.yx:{const{operation:h,error:l}=ce(u,i);h&&f.operations.push(h),l&&d.errors.push($(u,i,l));break}case P.Li:{f.operations.push(J(u,i));break}case P.pj:{const{operation:h,error:l}=z(u,i);h&&f.operations.push(h),l&&d.errors.push($(u,i,l));break}case P.Lu:{f.operations.push(q(u,i));break}case P.PQ:{f.operations.push(p(u,i));break}case P.Md:{f.operations.push(A(u,i));break}case P.Xt:{const{operation:h,error:l}=W(u,i,d);h&&f.operations.push(h),l&&d.errors.push($(u,i,l));break}case P.Tr:{f.operations.push(U(u,i,d));break}case P.M0:{f.operations.push(N(u,i,d));break}case P.uf:{te(u,i,d);break}case a._A:{if(se(i))break;d.errors.push((0,a.wf)(u,i));break}default:{let h=i.firstChild;for(;h;)V(u,h,d),h=h.nextSibling}}}function ee(u,i){const d=i.getChild(P.xb),f=(0,a.KF)(u,d),h=(0,a.KF)(u,d.nextSibling);let l=(0,a.KF)(u,i.getChild(P.Ld));return l=l.substring(1,l.length-1),{label:f,op:h,value:l}}function ce(u,i){const d=(0,a.KF)(u,i.getChild(P.wn)),f=D((0,a.KF)(u,i.getChild(P.Ld)));return i.getChild(P.JX)?.getChild(P.Ip)?{operation:{id:Q.B5.LineFilterIpMatches,params:[d,f]}}:{operation:{id:{"|=":Q.B5.LineContains,"!=":Q.B5.LineContainsNot,"|~":Q.B5.LineMatchesRegex,"!~":Q.B5.LineMatchesRegexNot}[d],params:[f]}}}function J(u,i){const d=i.firstChild,f=(0,a.KF)(u,d),h=D((0,a.KF)(u,i.getChild(P.Ld)));let l=h?[h]:[];const O=(0,g.XK)(f);return O&&!(0,g.j$)(O,l)&&(l=O?.defaultParams||[]),{id:f,params:l}}function q(u,i){const d=i.getChild(P.Ph),f=(0,a.KF)(u,d),h=[...(0,a.ff)(u,i,P.uw)];return{id:f,params:h}}function z(u,i){if(i.getChild(P.Or)||i.getChild(P.W8)||i.getChild("Comma"))return{error:'Label filter with comma, "and", "or" not supported in query builder'};if(i.firstChild.type.id===P.Fo){const x=i.firstChild,F=x?.getChild(P.xb),y=F?.nextSibling,R=x?.getChild(P.Ld),_=D((0,a.KF)(u,R));return{operation:{id:Q.B5.LabelFilterIpMatches,params:[(0,a.KF)(u,F),(0,a.KF)(u,y),_]}}}const d=Q.B5.LabelFilter;if(i.firstChild.type.id===P.ai){const F=i.firstChild.firstChild.firstChild,y=F.nextSibling,R=y.nextSibling,_=D((0,a.KF)(u,R));return{operation:{id:d,params:[(0,a.KF)(u,F),(0,a.KF)(u,y),_]}}}const h=i.firstChild.firstChild,l=h.nextSibling,O=l.nextSibling,E=[(0,a.KF)(u,h),(0,a.KF)(u,l),D((0,a.KF)(u,O))];return E.join("")==="__error__="?{operation:{id:Q.B5.LabelFilterNoErrors,params:[]}}:{operation:{id:d,params:E}}}function p(u,i){const d=Q.B5.LineFormat,f=D((0,a.KF)(u,i.getChild(P.Ld)));return{id:d,params:[f]}}function A(u,i){const d=Q.B5.LabelFormat,f=i.getChild(P.xb),l=f.nextSibling.nextSibling;return{id:d,params:[(0,a.KF)(u,l),D((0,a.KF)(u,f))]}}function W(u,i,d){const f=i.getChild(P.Xt),h=i.getChild(P.pj),l=i.getChild(P.Z7);if(f&&V(u,f,d),h&&V(u,h,d),l){if(l.nextSibling?.type.id===P.h3){const O=l.nextSibling,E=O.nextSibling;return{operation:{id:Q.B5.Unwrap,params:[(0,a.KF)(u,E),(0,a.KF)(u,O)]}}}return{operation:{id:Q.B5.Unwrap,params:[(0,a.KF)(u,l?.nextSibling),""]}}}return{}}function U(u,i,d){const f=i.getChild(P.gQ),h=(0,a.KF)(u,f),l=i.getChild(P.Mr),O=i.getChild(P.UN),E=l!=null?[(0,a.KF)(u,l)]:[],x=O?.getChild(P.e6),F=x?(0,a.KF)(u,x):null;F&&E.unshift(F.substring(1,F.length-1));const y={id:h,params:E};return O&&V(u,O,d),y}function N(u,i,d){const f=i.getChild(P.Up);let h=(0,a.KF)(u,f);const l=i.getChild(P.Kz),O=[],E=i.getChild(P.Mr);E&&O.push(Number((0,a.KF)(u,E))),l&&(l.getChild(P.By)&&h&&(h=`__${h}_by`),l.getChild(P.yN)&&(h=`__${h}_without`),O.push(...(0,a.ff)(u,l,P.xb)));const x=i.getChild(P.cq),F={id:h,params:O};return x&&V(u,x,d),F}const Y=K.i.reduce((u,i)=>(u[i.sign]={id:i.id,comparison:i.comparison},u),{});function te(u,i,d){const f=d.query,h=i.firstChild,l=(0,a.KF)(u,h.nextSibling),O=Z(u,i.getChild(C.v3)),E=i.lastChild,x=Y[l],F=T(h,"MetricExpr.LiteralExpr.Number"),y=T(E,"MetricExpr.LiteralExpr.Number"),R=E.getChild(P.uf);if(F||V(u,h,d),y)f.operations.push((0,a.Es)(x,u,E,!!O?.isBool));else if(R){const _=(0,a.ge)(E);_?.name==="Number"&&f.operations.push((0,a.Es)(x,u,_,!!O?.isBool)),V(u,E,d)}else{f.binaryQueries=f.binaryQueries||[];const _={operator:l,query:{labels:[],operations:[]}};O?.isMatcher&&(_.vectorMatchesType=O.matchType,_.vectorMatches=O.matches),f.binaryQueries.push(_),V(u,E,{query:_.query,errors:d.errors})}}function Z(u,i){if(i){if(i.getChild(P.tW))return{isBool:!0,isMatcher:!1};{const d=i.getChild(C.Wc);return d?{isMatcher:!0,isBool:!1,matches:(0,a.KF)(u,d.getChild(P.XT)?.getChild(P.pQ)),matchType:d.getChild(P.On)?"on":"ignoring"}:void 0}}}function se(u){return u?.parent?.type.id===P.e6}function D(u){return u[0]==='"'&&u[u.length-1]==='"'?u.replace(/"/g,"").replace(/\\\\/g,"\\"):u.replace(/`/g,"")}function T(u,i){let d=u;const f=i.split(".");for(const h of f)if(d=d.getChild(h),!d)return null;return d}function $(u,i,d){const f=(0,a.wf)(u,i);return f.text=`${d}: ${f.text}`,f}function X(u){return u.labels.length===0&&u.operations.length===0}},91720:(me,H,o)=>{o.d(H,{B5:()=>a,Hv:()=>C,Ly:()=>P,jK:()=>K});var C=(g=>(g.Log="log",g.Metric="metric",g))(C||{}),P=(g=>(g.Aggregations="Aggregations",g.RangeFunctions="Range functions",g.Functions="Functions",g.Formats="Formats",g.LineFilters="Line filters",g.LabelFilters="Label filters",g.BinaryOps="Binary operations",g))(P||{}),a=(g=>(g.Json="json",g.Logfmt="logfmt",g.Regexp="regexp",g.Pattern="pattern",g.Unpack="unpack",g.LineFormat="line_format",g.LabelFormat="label_format",g.Rate="rate",g.RateCounter="rate_counter",g.CountOverTime="count_over_time",g.SumOverTime="sum_over_time",g.AvgOverTime="avg_over_time",g.MaxOverTime="max_over_time",g.MinOverTime="min_over_time",g.FirstOverTime="first_over_time",g.LastOverTime="last_over_time",g.StdvarOverTime="stdvar_over_time",g.StddevOverTime="stddev_over_time",g.QuantileOverTime="quantile_over_time",g.BytesRate="bytes_rate",g.BytesOverTime="bytes_over_time",g.AbsentOverTime="absent_over_time",g.Sum="sum",g.Avg="avg",g.Min="min",g.Max="max",g.Stddev="stddev",g.Stdvar="stdvar",g.Count="count",g.TopK="topk",g.BottomK="bottomk",g.LineContains="__line_contains",g.LineContainsNot="__line_contains_not",g.LineContainsCaseInsensitive="__line_contains_case_insensitive",g.LineContainsNotCaseInsensitive="__line_contains_not_case_insensitive",g.LineMatchesRegex="__line_matches_regex",g.LineMatchesRegexNot="__line_matches_regex_not",g.LineFilterIpMatches="__line_filter_ip_matches",g.LabelFilter="__label_filter",g.LabelFilterNoErrors="__label_filter_no_errors",g.LabelFilterIpMatches="__label_filter_ip_marches",g.Unwrap="unwrap",g.SumBy="__sum_by",g.SumWithout="__sum_without",g.Addition="__addition",g.Subtraction="__subtraction",g.MultiplyBy="__multiply_by",g.DivideBy="__divide_by",g.Modulo="__modulo",g.Exponent="__exponent",g.NestedQuery="__nested_query",g.EqualTo="__equal_to",g.NotEqualTo="__not_equal_to",g.GreaterThan="__greater_than",g.LessThan="__less_than",g.GreaterOrEqual="__greater_or_equal",g.LessOrEqual="__less_or_equal",g))(a||{}),K=(g=>(g[g.LineFilters=1]="LineFilters",g[g.LineFormats=2]="LineFormats",g[g.LabelFilters=3]="LabelFilters",g[g.Unwrap=4]="Unwrap",g[g.NoErrors=5]="NoErrors",g[g.RangeVectorFunction=5]="RangeVectorFunction",g[g.Last=6]="Last",g))(K||{})},87826:(me,H,o)=>{o.d(H,{EO:()=>V,vh:()=>k,ki:()=>q,e8:()=>ce,Y:()=>z,OP:()=>ee,zb:()=>J});var C=o(14582),P=o(37556),a=o(31439);function K(p){let A;try{A=JSON.parse(p)}catch{}return typeof A=="object"}const g=/(?:^|\s)([\w\(\)\[\]\{\}]+)=(""|(?:".*?[^\\]"|[^"\s]\S*))/;function Q(p){return g.test(p)}function k(p){return(p.fields.find(W=>W.name==="labels")?.values.toArray()??[]).some(W=>W.__error__!==void 0)}function V(p){return(p.fields.find(W=>W.name==="labels")?.values.toArray()??[]).some(W=>W.level!==void 0)}function ee(p){const A=p.fields.find(Y=>Y.type===C.fS.string);if(A==null)return{hasJSON:!1,hasLogfmt:!1};const W=A.values.toArray();let U=!1,N=!1;return W.forEach(Y=>{K(Y)&&(U=!0),Q(Y)&&(N=!0)}),{hasLogfmt:N,hasJSON:U}}function ce(p){const A=p?.fields?.find(W=>W.name==="labels")?.values.toArray()??[];return A?.length?Object.keys(A[0]):[]}function J(p){const A=p?.fields?.find(U=>U.name==="labels")?.values.toArray()??[];return A?.length?Object.keys(A[0]).filter(U=>{const N=A[0][U];return N?!isNaN(Number(N))||(0,P.IA)(N)||(0,a.aC)(N):!1}).filter(U=>A.every(N=>N[U])):[]}function q(p){const A=p.fields.find(U=>U.name==="labels"&&U.type===C.fS.other);return A==null?!1:A.values.toArray().some(U=>U.__error__)}function z(p){const A=p.fields.find(N=>N.name==="labels"&&N.type===C.fS.other);if(A==null)return null;const W=A.values.toArray().slice(0,2);let U=null;for(let N of W){const Y=Object.keys(N).find(te=>te==="lvl"||te.includes("level"));if(Y){U=Y;break}}return U}},19370:(me,H,o)=>{o.d(H,{$5:()=>C,EH:()=>K,Rd:()=>a,ZP:()=>V,r8:()=>g,uR:()=>P,xY:()=>k});const C=[{label:"avg",insertText:"avg",documentation:"Calculate the average over dimensions"},{label:"bottomk",insertText:"bottomk",documentation:"Smallest k elements by sample value"},{label:"count",insertText:"count",documentation:"Count number of elements in the vector"},{label:"max",insertText:"max",documentation:"Select maximum over dimensions"},{label:"min",insertText:"min",documentation:"Select minimum over dimensions"},{label:"stddev",insertText:"stddev",documentation:"Calculate population standard deviation over dimensions"},{label:"stdvar",insertText:"stdvar",documentation:"Calculate population standard variance over dimensions"},{label:"sum",insertText:"sum",documentation:"Calculate sum over dimensions"},{label:"topk",insertText:"topk",documentation:"Largest k elements by sample value"}],P=[{label:"json",insertText:"json",documentation:"Extracting labels from the log line using json parser."},{label:"regexp",insertText:'regexp ""',documentation:"Extracting labels from the log line using regexp parser.",move:-1},{label:"logfmt",insertText:"logfmt",documentation:"Extracting labels from the log line using logfmt parser."},{label:"pattern",insertText:"pattern",documentation:"Extracting labels from the log line using pattern parser. Only available in Loki 2.3+."},{label:"unpack",insertText:"unpack",detail:"unpack identifier",documentation:'Parses a JSON log line, unpacking all embedded labels in the pack stage. A special property "_entry" will also be used to replace the original log line. Only available in Loki 2.2+.'}],a=[{label:"unwrap",insertText:"unwrap",detail:"unwrap identifier",documentation:"Take labels and use the values as sample data for metric aggregations."},{label:"label_format",insertText:"label_format",documentation:"Use to rename, modify or add labels. For example, | label_format foo=bar ."},{label:"line_format",insertText:"line_format",documentation:'Rewrites log line content. For example, | line_format "{{.query}} {{.duration}}" .'}],K=[{insertText:"avg_over_time",label:"avg_over_time",detail:"avg_over_time(range-vector)",documentation:"The average of all values in the specified interval."},{insertText:"bytes_over_time",label:"bytes_over_time",detail:"bytes_over_time(range-vector)",documentation:"Counts the amount of bytes used by each log stream for a given range"},{insertText:"bytes_rate",label:"bytes_rate",detail:"bytes_rate(range-vector)",documentation:"Calculates the number of bytes per second for each stream."},{insertText:"first_over_time",label:"first_over_time",detail:"first_over_time(range-vector)",documentation:"The first of all values in the specified interval. Only available in Loki 2.3+."},{insertText:"last_over_time",label:"last_over_time",detail:"last_over_time(range-vector)",documentation:"The last of all values in the specified interval. Only available in Loki 2.3+."},{insertText:"sum_over_time",label:"sum_over_time",detail:"sum_over_time(range-vector)",documentation:"The sum of all values in the specified interval."},{insertText:"count_over_time",label:"count_over_time",detail:"count_over_time(range-vector)",documentation:"The count of all values in the specified interval."},{insertText:"max_over_time",label:"max_over_time",detail:"max_over_time(range-vector)",documentation:"The maximum of all values in the specified interval."},{insertText:"min_over_time",label:"min_over_time",detail:"min_over_time(range-vector)",documentation:"The minimum of all values in the specified interval."},{insertText:"quantile_over_time",label:"quantile_over_time",detail:"quantile_over_time(scalar, range-vector)",documentation:"The \u03C6-quantile (0 \u2264 \u03C6 \u2264 1) of the values in the specified interval."},{insertText:"rate",label:"rate",detail:"rate(v range-vector)",documentation:"Calculates the number of entries per second."},{insertText:"stddev_over_time",label:"stddev_over_time",detail:"stddev_over_time(range-vector)",documentation:"The population standard deviation of the values in the specified interval."},{insertText:"stdvar_over_time",label:"stdvar_over_time",detail:"stdvar_over_time(range-vector)",documentation:"The population standard variance of the values in the specified interval."}],g=[...C,...K],Q=[...g,...a,...P].map(ee=>ee.label),k={comment:{pattern:/#.*/},"context-aggregation":{pattern:/((without|by)\s*)\([^)]*\)/,lookbehind:!0,inside:{"label-key":{pattern:/[^(),\s][^,)]*[^),\s]*/,alias:"attr-name"},punctuation:/[()]/}},"context-labels":{pattern:/\{[^}]*(?=}?)/,greedy:!0,inside:{comment:{pattern:/#.*/},"label-key":{pattern:/[a-zA-Z_]\w*(?=\s*(=|!=|=~|!~))/,alias:"attr-name",greedy:!0},"label-value":{pattern:/"(?:\\.|[^\\"])*"/,greedy:!0,alias:"attr-value"},punctuation:/[{]/}},"context-pipe":{pattern:/\s\|[^=~]\s?\w*/i,inside:{"pipe-operator":{pattern:/\|/i,alias:"operator"},"pipe-operations":{pattern:new RegExp(`${[...P,...a].map(ee=>ee.label).join("|")}`,"i"),alias:"keyword"}}},function:new RegExp(`\\b(?:${g.map(ee=>ee.label).join("|")})(?=\\s*\\()`,"i"),"context-range":[{pattern:/\[[^\]]*(?=\])/,inside:{"range-duration":{pattern:/\b\d+[smhdwy]\b/i,alias:"number"}}},{pattern:/(offset\s+)\w+/,lookbehind:!0,inside:{"range-duration":{pattern:/\b\d+[smhdwy]\b/i,alias:"number"}}}],quote:{pattern:/"(?:\\.|[^\\"])*"/,alias:"string",greedy:!0},backticks:{pattern:/`(?:\\.|[^\\`])*`/,alias:"string",greedy:!0},number:/\b-?\d+((\.\d*)?([eE][+-]?\d+)?)?\b/,operator:/\s?(\|[=~]?|!=?|<(?:=>?|<|>)?|>[>=]?)\s?/i,punctuation:/[{}(),.]/},V=k},32920:(me,H,o)=>{o.d(H,{C:()=>W,u:()=>ce});var C=o(40400),P=o(41818),a=o(35645),K=o(92624),g=o(58079),Q=o(85444),k=o(93716),V=o(24666),ee=o(92555);const ce=({payload:{dashboardId:U,orgId:N,grafanaVersion:Y,queries:te}})=>{try{const Z=te[k.id].filter(O=>!O.hide).map(O=>(0,V.Ib)(O));if(!Z?.length)return;const se=Z.filter(O=>(0,V.rE)(O.expr)),D=Z.filter(O=>!(0,V.rE)(O.expr)),T=Z.filter(O=>O.queryType===ee.EM.Instant),$=Z.filter(O=>O.queryType===ee.EM.Range),X=Z.filter(O=>O.editorMode===g.c.Builder),u=Z.filter(O=>O.editorMode===g.c.Code),i=Z.filter(J),d=Z.filter(q),f=Z.filter(z),h=Z.filter(p),l={grafana_version:Y,dashboard_id:U,org_id:N,queries_count:Z.length,logs_queries_count:se.length,metric_queries_count:D.length,instant_queries_count:T.length,range_queries_count:$.length,builder_mode_queries_count:X.length,code_mode_queries_count:u.length,queries_with_template_variables_count:i.length,queries_with_changed_resolution_count:d.length,queries_with_changed_line_limit_count:f.length,queries_with_changed_legend_count:h.length};(0,P.ff)("grafana_loki_dashboard_loaded",l)}catch(Z){console.error("error in loki tracking handler",Z)}},J=U=>K.J7.test(U.expr),q=U=>U.resolution?U.resolution!==1:!1,z=U=>U.maxLines!==null&&U.maxLines!==void 0,p=U=>U.legendFormat?U.legendFormat!=="":!1,A=U=>{const N=[Q.xf,Q.NZ,Q.V8];return!!(U===Q.Ic||N.some(Y=>U.startsWith(Y)))};function W(U,N,Y){const{app:te,targets:Z}=N;if(te===C.zj.Dashboard||te===C.zj.PanelViewer)return;let se=0;for(const D of U.data){const T=D.meta?.custom?.lokiQueryStatKey;T&&(se+=D.meta?.stats?.find($=>$.displayName===T)?.value??0)}for(const D of Z){if(A(D.refId))return;(0,P.ff)("grafana_loki_query_executed",{app:te,grafana_version:a.v.buildInfo.version,editor_mode:D.editorMode,has_data:U.data.some(T=>T.length>0),has_error:U.error!==void 0,legend:D.legendFormat,line_limit:D.maxLines,parsed_query:(0,V.dQ)(D.expr).join(","),obfuscated_query:(0,V.H6)(D.expr),query_type:(0,V.rE)(D.expr)?"logs":"metric",query_vector_type:D.queryType,resolution:D.resolution,simultaneously_sent_query_count:Z.length,time_range_from:N?.range?.from?.toISOString(),time_range_to:N?.range?.to?.toISOString(),time_taken:Date.now()-Y.getTime(),bytes_processed:se})}}},92555:(me,H,o)=>{o.d(H,{$o:()=>g,EM:()=>P,Z3:()=>K,sb:()=>a});var C=(Q=>(Q.Stream="streams",Q.Vector="vector",Q.Matrix="matrix",Q))(C||{}),P=(Q=>(Q.Range="range",Q.Instant="instant",Q.Stream="stream",Q))(P||{}),a=(Q=>(Q.Backward="backward",Q.Forward="forward",Q))(a||{}),K=(Q=>(Q[Q.LabelNames=0]="LabelNames",Q[Q.LabelValues=1]="LabelValues",Q))(K||{}),g=(Q=>(Q.LogsVolume="logsVolume",Q.LogsSample="logsSample",Q.DataSample="dataSample",Q))(g||{})},58079:(me,H,o)=>{o.d(H,{c:()=>C});var C=(P=>(P.Code="code",P.Builder="builder",P))(C||{})},78252:(me,H,o)=>{o.d(H,{By:()=>be,E2:()=>y,Fo:()=>lt,Ih:()=>nt,Ip:()=>Ie,JX:()=>st,Kz:()=>Lt,Ld:()=>Xt,Li:()=>it,Lu:()=>le,M0:()=>xt,Md:()=>Ce,Mr:()=>Oe,OC:()=>at,On:()=>We,Or:()=>je,PQ:()=>ut,Ph:()=>R,Qf:()=>ke,Tr:()=>pt,UN:()=>bt,Up:()=>Qt,W8:()=>Se,WZ:()=>Ge,We:()=>et,XT:()=>gr,Xt:()=>Pt,Z7:()=>Ae,ai:()=>ct,bL:()=>He,cq:()=>mt,dh:()=>we,e6:()=>yt,gD:()=>Ze,gP:()=>qe,gQ:()=>ft,h3:()=>Et,iP:()=>Je,pQ:()=>xe,pj:()=>ot,tW:()=>Ne,uf:()=>Rt,uw:()=>$e,wi:()=>ze,wm:()=>tt,wn:()=>ve,xO:()=>Ye,xb:()=>ye,yN:()=>Xe,yx:()=>rt,zV:()=>dt});var C=o(27765);const P=1,a=2,K=3,g=4,Q=5,k=6,V=7,ee=8,ce=9,J=10,q=11,z=12,p=13,A=14,W=15,U=16,N=17,Y=18,te=19,Z=20,se=21,D=22,T=23,$=24,X=25,u=26,i=27,d=28,f=29,h=30,l={json:P,logfmt:a,unpack:K,pattern:g,regexp:Q,ip:V,label_format:ee,line_format:ce,label_replace:J,offset:q,bool:z,on:p,ignoring:A,group_left:W,group_right:U,unwrap:k},O=(fe,c)=>l[fe.toLowerCase()]||-1,E={by:N,without:Y,and:te,or:Z,unless:se,sum:D,avg:T,count:$,max:X,min:u,stddev:i,stdvar:d,bottomk:f,topk:h},x=(fe,c)=>E[fe.toLowerCase()]||-1,F={__proto__:null,count_over_time:257,rate:259,rate_counter:261,bytes_over_time:263,bytes_rate:265,avg_over_time:267,sum_over_time:269,min_over_time:271,max_over_time:273,stddev_over_time:275,stdvar_over_time:277,quantile_over_time:279,first_over_time:281,last_over_time:283,absent_over_time:285,bytes:291,duration:293,duration_seconds:295},y=C.WQ.deserialize({version:14,states:"AYOYQPOOO#YQPO'#DPO$iQPO'#DOOYQPO'#DOOOQO'#D{'#D{O$vQPO'#DzOOQO'#Eh'#EhO${QPO'#EgQ%WQPOOOOQO'#Ev'#EvO&XQPO'#EvO&^QPO'#EwOOQO'#Dy'#DyOOQO'#C}'#C}OOQO'#D|'#D|OOQO'#D}'#D}OOQO'#EO'#EOOOQO'#EP'#EPOOQO'#EQ'#EQOOQO'#ER'#EROOQO'#ES'#ESOOQO'#ET'#ETOOQO'#EU'#EUOOQO'#EV'#EVOOQO'#EW'#EWOOQO'#EX'#EXOOQO'#EY'#EYOOQO'#EZ'#EZOOQO'#E['#E[O&cQPO'#DROOQO'#DQ'#DQO&qQPO,59kOOQO'#D^'#D^O&yQPO'#D]OOQO'#D['#D[O'RQPO'#DZO(lQPO'#DZOOQO'#DY'#DYO*eQPO,59jO+sQPO,59jO+zQPO,5:eO,RQPO,5:fO,^QPO'#EeO.`QPO,5;RO.gQPO,5;RO.lQPO,5;TO.lQPO,5;TO.lQPO,5;TO.lQPO,5;TO.lQPO,5;TO.lQPO,5;TOOQO,5;b,5;bOYQPO,5;cO0uQPO,59mO0zQPO1G/VOOQO1G/V1G/VOOQO'#Da'#DaOOQO,59w,59wO1SQPO,59wOOQO,59v,59vO1XQPO'#DRO1vQPO'#DcOOQO'#Dc'#DcO3dQPO'#DcOOQO'#Di'#DiOOQO'#Dg'#DgO)RQPO'#DgO3iQPO,59uO5SQPO'#DuO5XQPO'#DvOOQO,59u,59uOOQO,59t,59tOOQO1G/U1G/UOOQO1G0P1G0PO5^QPO'#E]O,UQPO'#E]O5rQPO1G0QO5wQPO1G0QO5|QPO,5;PO6UQPO1G0mO7aQPO1G0mO7hQPO1G0mO7oQPO'#EkO9tQPO'#EjO:OQPO'#EjOYQPO1G0oOYQPO1G0oOYQPO1G0oOYQPO1G0oOYQPO1G0oOYQPO1G0oO:YQPO1G0}OOQO1G/X1G/XOOQO1G/W1G/WOOQO7+$q7+$qO:aQPO1G/cO:fQPO,59mO:lQPO,5:UO:wQPO'#DfOOQO'#De'#DeO:|QPO,5:OOOQO,59},59}O<gQPO,5:RO)RQPO,5:RO)RQPO,5:ROOQO,5:a,5:aO<uQPO'#DxOOQO'#Dw'#DwO<zQPO,5:bO>eQPO'#DZO5^QPO,5:wO>lQPO'#E^O>qQPO,5:wO?[QPO,5:wO?fQPO,5:wO?mQPO,5:wO?rQPO7+%lO,UQPO7+%lOOQO'#Ef'#EfOASQPO1G0kOOQO1G0k1G0kOA[QPO7+&XOYQPO7+&XOBlQPO7+&XOBsQPO7+&XOBzQQO'#ElOOQO,5;V,5;VOEPQPO,5;UOEWQPO,5;UOFiQPO7+&ZOFpQPO7+&ZOOQO7+&Z7+&ZOF}QPO7+&ZOGUQPO7+&ZOHZQPO7+&ZOHkQPO7+&iOHpQPO7+$}OHuQPO1G/nOOQO1G/p1G/pOOQO1G/w1G/wOOQO1G/y1G/yOHzQPO,5:QOIPQPO,5:POOQO1G/m1G/mOIUQPO1G/mOJoQPO,5:dO5XQPO,5:cOJwQPO,5:zO>qQPO1G0cOKVQPO1G0cOK_QPO,5:xO)RQPO,5:zOKdQPO1G0cOKkQPO'#E_OKpQPO1G0cOKdQPO1G0cOKxQPO1G0cOLPQPO1G0cO5mQPO1G0cOOQO1G0c1G0cOOQO<<IW<<IWOL[QPO<<IWOLaQPO,5;QOOQO7+&V7+&VOOQO<<Is<<IsOLfQPO<<IsOYQPO<<IsOOQO'#En'#EnOLmQPO,5;WOOQO'#Em'#EmOOQO,5;W,5;WOOQO1G0p1G0pOLuQPO1G0pONuQPO<<JTOOQO<<Hi<<HiONzQPO7+%YOOQO1G/l1G/lOOQO1G/k1G/kOOQO1G0O1G0OOOQO1G/}1G/}OOQO'#Ea'#EaOOQO1G0f1G0fO! PQPO1G0fOOQO'#Eb'#EbOOQO'#Ec'#EcOOQO'#Ed'#EdOOQO7+%}7+%}OOQO1G0d1G0dO! UQPO1G0fO! jQPO7+%}OOQO,5:y,5:yO! rQPO7+%}O5mQPO7+%}O! yQPO7+%}O!!UQPOAN>rOOQO1G0l1G0lO!#fQPOAN?_O!$vQPOAN?_O!$}QQO1G0rOOQO1G0r1G0rOOQO7+&[7+&[O!%VQPOAN?oO!%[QPO<<HtO!%aQPO7+&QO!%fQPO<<IiO!%nQPO<<IiO!%vQPO<<IiO!&OQPO'#E`OOQO<<Ii<<IiOOQOG24^G24^OOQOG24yG24yOOQO1G0s1G0sOOQO7+&^7+&^O!&TQPOG25ZOOQOAN>`AN>`O!&YQPO<<IlOOQOAN?TAN?TO!&_QPOAN?TO!&gQPOLD*uOOQOAN?WAN?WOOQO,5:b,5:bO!&lQPO!$'NaO!&qQPO!)9C{O!&vQPO!.K9gOOQO!4//R!4//RO5XQPO'#DvO!&{QPO'#DZO!'jQPO,59jO!'tQPO'#DOOYQPO1G0oOYQPO1G0oOYQPO1G0oOYQPO1G0oOYQPO1G0oOYQPO1G0oO.lQPO,5;TO.lQPO,5;TO.lQPO,5;TO.lQPO,5;TO.lQPO,5;TO.lQPO,5;TO!)PQPO7+&ZO!)WQPO7+&ZO!)eQPO7+&ZO!*mQPO7+&ZO!*tQPO7+&ZO!)lQPO'#Ei",stateData:"!+R~O#nOSoOS~OYZOfUOgUOhUOiUOjUOkUOlUOmUOnUO!hXO#dYO#eYO#oPO#rRO#t^O#u_O#v`O#waO#xbO#ycO#zdO#{eO#|fO#}gO$OhO$PiO$QjO$RkO$SlO~OvmO~OypO{pO!RpO!SpOcrXdrXerX!_rX!arX!brX!crX!drX#drX#erX#frX#grX#hrX#irX~O!UtO#lrX#srX~P#_O#ryO~OazObzO#r{O~Oc!OOd}Oe!OOy!SO!_!SO!a!SO!b!SO!c!SO!d!SO#d!PO#e!PO#f!QO#g!QO#h!QO#i!RO~O!h!TO~O#r!UO~Ow!VOy!VOz!VO{!VO~O#p!WO#q!XO~OV!YOx!ZO~OypO{pO!RpO!SpOc}Xd}Xe}X!U}X!_}X!a}X!b}X!c}X!d}X#d}X#e}X#f}X#g}X#h}X#i}X#l}X#s}X$T}X#p}X~OP!_OQ!`OR!`OS!aOT!aOW!gOX!fOv!^O#r!dO~OypO{pO!RpO!SpOcradraera!_ra!ara!bra!cra!dra#dra#era#fra#gra#hra#ira~O!UtO#lra#sra~P)ZOcqXdqXeqXyqX!_qX!aqX!bqX!cqX!dqX#dqX#eqX#fqX#gqX#hqX#iqX~O#s!jO~P*rO#s!kO~P*rO!h!oO#oPO#r!mO~O#r!pO~OYZOfUOgUOhUOiUOjUOkUOlUOmUOnUO#dYO#eYO#oPO#rRO#t^O#u_O#v`O#waO#xbO#ycO#zdO#{eO#|fO#}gO$OhO$PiO$QjO$RkO$SlO~O!h!rO~P,cO#r!sO~O[!vO]!tO^!tOY#^Pf#^Pg#^Ph#^Pi#^Pj#^Pk#^Pl#^Pm#^Pn#^P!h#^P#d#^P#e#^P#o#^P#r#^P#t#^P#u#^P#v#^P#w#^P#x#^P#y#^P#z#^P#{#^P#|#^P#}#^P$O#^P$P#^P$Q#^P$R#^P$S#^P~Ox#OO~OvmO#q#QO~O#r#RO~Ow#SOy#SOz!VO{!VO!_#TO!a#TO!b#TO!c#TO!d#TO~Ov#UOc!VXd!VXe!VXy!VX{!VX!R!VX!S!VX!U!VX!_!VX!a!VX!b!VX!c!VX!d!VX#d!VX#e!VX#f!VX#g!VX#h!VX#i!VX#l!VX#s!VX$T!VX#p!VX~Ox#XO~Oc#ZOd#[O#p#ZOe}ay}a{}a!R}a!S}a!U}a!_}a!a}a!b}a!c}a!d}a#d}a#e}a#f}a#g}a#h}a#i}a#l}a#s}a$T}a~Ox#]O~Ov#^O~OypO{pO!RpO!SpO!U#aO$T#cO~O#s#hO~O#p#iO~Ov#jO#s#lO~O#s#mO~P*rOc#jXd#jXe#jXy#jX!_#jX!a#jX!b#jX!c#jX!d#jX#d#jX#e#jX#f#jX#g#jX#h#jX#i#jX#s#jX~O#p#nO~P6]O!h#pO~P,cO#r#qO~OY#^Xf#^Xg#^Xh#^Xi#^Xj#^Xk#^Xl#^Xm#^Xn#^X!h#^X#d#^X#e#^X#o#^X#r#^X#t#^X#u#^X#v#^X#w#^X#x#^X#y#^X#z#^X#{#^X#|#^X#}#^X$O#^X$P#^X$Q#^X$R#^X$S#^X~O_#sO`#sO~P7tO]!tO^!tO~P7tO#p#{O~P*rOx#|O~OV#}Ox#OO!`$OO!f$PO!h$QO~Ow$RO~O#p$SOc!Wad!Wae!Way!Wa{!Wa!R!Wa!S!Wa!U!Wa!_!Wa!a!Wa!b!Wa!c!Wa!d!Wa#d!Wa#e!Wa#f!Wa#g!Wa#h!Wa#i!Wa#l!Wa#s!Wa$T!Wa~Oc#ZOd#[O#p#ZO#s$TO~Ow$VO~O#p$WOc!jad!jae!jay!ja{!ja!R!ja!S!ja!U!ja!_!ja!a!ja!b!ja!c!ja!d!ja#d!ja#e!ja#f!ja#g!ja#h!ja#i!ja#l!ja#s!ja$T!ja~OU$XO~P(lO!`$[O~O!U$]O$T#cO~OypO{pO!RpO!SpO!U#aO~OZ$_O#s#Pa~P>yO#s$dO~P5^O#s$eO~OazObzOc!nqd!nqe!nqy!nq!_!nq!a!nq!b!nq!c!nq!d!nq#d!nq#e!nq#f!nq#g!nq#h!nq#i!nq#l!nq#s!nq#p!nq~O#p$hO#s$iO~OazObzOc#Zqd#Zqe#Zqy#Zq!_#Zq!a#Zq!b#Zq!c#Zq!d#Zq#d#Zq#e#Zq#f#Zq#g#Zq#h#Zq#i#Zq#l#Zq#s#Zq#p#Zq~O#s$jO~P*rO#p$lO~P6]O#c$mO#s$pO~OY#^af#^ag#^ah#^ai#^aj#^ak#^al#^am#^an#^a!h#^a#d#^a#e#^a#o#^a#t#^a#u#^a#v#^a#w#^a#x#^a#y#^a#z#^a#{#^a#|#^a#}#^a$O#^a$P#^a$Q#^a$R#^a$S#^a~O#r#qO~PCSO_$rO`$rO#r#^a~PCSOc!OOe!OOy!SO!_!SO!a!SO!b!SO!c!SO!d!SO#d!PO#e!PO#f#]q#g#]q#h#]q#i#]q#l#]q#s#]q~Od#]q~PEeOc#]qd#]qe#]q~PEkOd}O~PEeO#l#]q#s#]q~P%WOc#]qd#]qe#]qy#]q!_#]q!a#]q!b#]q!c#]q!d#]q#f#]q#g#]q#h#]q#i#]q~O#d!PO#e!PO#l#]q#s#]q~PG`Ox$sO~O#s$tO~O#r$uO~Ox$vO~Ov#UO~Oc#ZO#p#ZOd!Zie!Ziy!Zi{!Zi!R!Zi!S!Zi!U!Zi!_!Zi!a!Zi!b!Zi!c!Zi!d!Zi#d!Zi#e!Zi#f!Zi#g!Zi#h!Zi#i!Zi#l!Zi#s!Zi$T!Zi~Ov$xOx$xO~Ov${O$V$}O$W%OO$X%PO~OZ$_O#s#Pi~O$U%RO~O#s#Pi~P>yO!`%UO~O!U$]O#s#Pi~O#s%WO~P5^O!U$]O#s%WO$T#cO~O#s%YO~Ov%ZO~O#s%[O~P*rO#p%^O#s%_O~O#r#qOY#^if#^ig#^ih#^ii#^ij#^ik#^il#^im#^in#^i!h#^i#d#^i#e#^i#o#^i#t#^i#u#^i#v#^i#w#^i#x#^i#y#^i#z#^i#{#^i#|#^i#}#^i$O#^i$P#^i$Q#^i$R#^i$S#^i~O#p%aO~Ox%bO~O#r%cO~Oc#ZOd#[O#p#ZO!U#Si$T#Si#s#Si~O!U$]O#s#Pq~O#s#Pq~P>yOZ%fO!U%gO#s#Pq~OazObzOc!n!Rd!n!Re!n!Ry!n!R!_!n!R!a!n!R!b!n!R!c!n!R!d!n!R#d!n!R#e!n!R#f!n!R#g!n!R#h!n!R#i!n!R#l!n!R#s!n!R#p!n!R~OazObzOc#Z!Rd#Z!Re#Z!Ry#Z!R!_#Z!R!a#Z!R!b#Z!R!c#Z!R!d#Z!R#d#Z!R#e#Z!R#f#Z!R#g#Z!R#h#Z!R#i#Z!R#l#Z!R#s#Z!R#p#Z!R~O#s%jO~P*rO#c$mO#s%lO~Ox%mO~O#s%nO~Ov%oO~O!U$]O#s#Py~OZ$_O#s#Py~O!U%gO!`%UO~OU$XO~O#p%rO~O#s%sO~O!U$]O#s#P!R~Ox%uO~O#p%vO~Ox%wO~O#s%xO~OP!_OQ!`OR!`OS!aOT!aOW%yOX!fOv!^O#r!dO~O!U%zO#pra~P)ZO!U%zO#prX~P#_Oc&UOe&UOy&YO!_&YO!a&YO!b&YO!c&YO!d&YO#d&VO#e&VO#f#]q#g#]q#h#]q#i#]q#p#]q~Od#]q~P!(OOc#]qd#]qe#]q~P!(UOd&TO~P!(OOc&UOd&TOe&UOy&YO!_&YO!a&YO!b&YO!c&YO!d&YO#d&VO#e&VO#f&WO#g&WO#h&WO#i&XO~O#p#]q~P!)lO#d&VO#e&VO#p#]q~PG`O",goto:"/^#lPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP#m$l%T%s%vPPPPPP&V&i&y'X'jPP'yP'|'|(R(U([(m(m(vPPPPPP(vP(mP'|'|)P)V)^*P*f*{*{*{*{*{*{*{*{*{*{*{*{*{*{*{+b+k,O,[,t,w,w,w,z-Z*P-^*P-s.i.z/T/WPPPPPPP*P*P[WOR{!s#n$lQ#u!wQ#v!xS#w!y&PQ#x!zQ#y!{Q#z!|Q&Z%}Q&[&OQ&]&QQ&^&RQ&_&SR&`!Ut]O{!U!s!w!x!y!z!{!|#n$l%}&O&P&Q&R&SRwRjQOR{!U!s!w!x!y!z!{!|#n$lS!ly#iQ#f!m]%|%}&O&P&Q&R&SRoPQnP^!ct!d#Z#[#a$]%zR#P!WQvQQ#b!lQ$^#eQ$b#fQ%V$aR%{%|[uQ!l#e#f$a%|]!iv#b$^$b%V%{isQv!l#b#e#f$^$a$b%V%{%|hrQv!l#b#e#f$^$a$b%V%{%|R!]skqQsv!l#b#e#f$^$a$b%V%{%|R![qV!ht#a%zR#W!_Q#V!_R$w$SU!et#a%zQ#Y!dQ$T#ZQ$U#[R%S$]_!ct!d#Z#[#a$]%z_!bt!d#Z#[#a$]%zQ#`!gR%t%yS#_!g%yR$y$Wj]O!w!x!y!z!{!|%}&O&P&Q&R&SQxRQ!q{Q!}!UQ#o!sQ$k#nR%]$lw[OR{!U!s!w!x!y!z!{!|#n$l%}&O&P&Q&R&SwTOR{!U!s!w!x!y!z!{!|#n$l%}&O&P&Q&R&SwSOR{!U!s!w!x!y!z!{!|#n$l%}&O&P&Q&R&SQ!nyQ#g!mR$g#iS#e!l#fW$Z#b#d$b$cQ%Q$YQ%X$dR%e%WQ$a#eQ%Q$ZQ%h%XR%p%eQ#d!lS$Y#b$bQ$`#eQ$c#fS%T$^$aS%d%V%XR%q%fR$|$XR$z$XQ|VQ$f#hQ$j#mQ%i%YR%j%[R#k!pwVOR{!U!s!w!x!y!z!{!|#n$l%}&O&P&Q&R&SQ!w}Q!x!OQ!y!PQ!z!QQ!{!RQ!|!SQ%}&TQ&O&UQ&P&VQ&Q&WQ&R&XR&S&Yh!u}!O!P!Q!R!S&T&U&V&W&X&YR#t!vQ#r!tQ$q#sR%`$rR$n#qQ$o#qR%k%^",nodeNames:"\u26A0 Json Logfmt Unpack Pattern Regexp Unwrap Ip LabelFormat LineFormat LabelReplace Offset Bool On Ignoring GroupLeft GroupRight By Without And Or Unless Sum Avg Count Max Min Stddev Stdvar Bottomk Topk LineComment LogQL Expr LogExpr Selector Matchers Matcher Identifier Eq String Neq Re Nre PipelineExpr PipelineStage LineFilters LineFilter Filter PipeExact PipeMatch FilterOp Pipe LabelParser JsonExpressionParser JsonExpressionList JsonExpression LabelFilter IpLabelFilter UnitFilter DurationFilter Gtr Duration Gte Lss Lte Eql BytesFilter Bytes NumberFilter Number LineFormatExpr LabelFormatExpr LabelsFormat LabelFormatMatcher MetricExpr RangeAggregationExpr RangeOp CountOverTime Rate RateCounter BytesOverTime BytesRate AvgOverTime SumOverTime MinOverTime MaxOverTime StddevOverTime StdvarOverTime QuantileOverTime FirstOverTime LastOverTime AbsentOverTime LogRangeExpr Range OffsetExpr UnwrapExpr ConvOp BytesConv DurationConv DurationSecondsConv Grouping Labels VectorAggregationExpr VectorOp BinOpExpr BinOpModifier OnOrIgnoringModifier GroupingLabels GroupingLabelList GroupingLabel LabelName Add Sub Mul Div Mod Pow LiteralExpr LabelReplaceExpr",maxTerm:147,skippedNodes:[0,31],repeatNodeCount:0,tokenData:"3X~RvX^#ipq#iqr$^rs$qst%cuv%nxy%syz%xz{%}{|&S|}&X}!O&^!O!P&c!P!Q'c!Q!R'h!R![)O![!]0O!^!_0d!_!`0q!`!a1W!c!}1e!}#O1{#P#Q2Q#Q#R2V#R#S1e#S#T2[#T#o1e#o#p2h#p#q2m#q#r3S#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~#nY#n~X^#ipq#i#y#z#i$f$g#i#BY#BZ#i$IS$I_#i$I|$JO#i$JT$JU#i$KV$KW#i&FU&FV#i~$aQ!_!`$g#r#s$l~$lOy~~$qO{~~$tUOY$qZr$qrs%Ws#O$q#O#P%]#P~$q~%]Ox~~%`PO~$q~%hQo~OY%cZ~%c~%sO#h~~%xO#r~~%}O#s~~&SO#f~~&XO#d~~&^O#p~~&cO#e~~&fP!Q![&i~&nR!h~!Q![&i!g!h&w#X#Y&w~&zR{|'T}!O'T!Q!['Z~'WP!Q!['Z~'`P!h~!Q!['Z~'hO#g~~'me!h~!O!P&i!Q![)O!g!h*c!i!j+Q!m!n+Q!o!p+Q!r!s+Q!v!w+Q#U#V*u#W#X+Z#X#Y-]#Z#[-o#[#]+r#_#`-o#a#b-x#d#e-o#g#h,z#h#i-o#k#l.Z#l#m/d#m#n.u~)Td!h~!O!P&i!Q![)O!g!h*c!i!j+Q!m!n+Q!o!p+Q!r!s+Q!v!w+Q#U#V*u#W#X+Z#X#Y-]#Z#[-o#[#]+r#_#`-o#a#b-x#d#e-o#g#h,z#h#i-o#k#l.Z#m#n.u~*fT{|'T}!O'T!Q!['Z!d!e*u#]#^*z~*zO!f~~*}P#U#V*u~+TQ!d!e*u#]#^*z~+`P!`~!Q![+c~+fS!Q![+c#[#]+r#a#b,W#g#h,z~+wP!`~!Q![+z~+}R!Q![+z#a#b,W#g#h,z~,]Q!`~!Q![,c#g#h,u~,fR!Q![,c#a#b,o#g#h,z~,rP#g#h,u~,zO!`~~-PP!`~!Q![-S~-VQ!Q![-S#a#b,o~-`T{|'T}!O'T!Q!['Z#U#V*u#]#^*z~-rQ#U#V*u#]#^*z~-}S!`~!Q![,c#U#V*u#]#^*z#g#h,u~.`P!`~!Q![.c~.fT!Q![.c#W#X+Z#[#]+r#a#b,W#g#h,z~.zP!`~!Q![.}~/QU!Q![.}#W#X+Z#[#]+r#a#b,W#g#h,z#k#l.Z~/gR!Q![/p!c!i/p#T#Z/p~/uR!h~!Q![/p!c!i/p#T#Z/pP0TTvP!Q![0O![!]0O!c!}0O#R#S0O#T#o0O~0iP!b~!_!`0l~0qO!c~~0vQw~!_!`0|#r#s1R~1RO!d~~1WOz~~1]P!_~!_!`1`~1eO!a~R1lTvP#cQ!Q![1e![!]0O!c!}1e#R#S1e#T#o1e~2QO$T~~2VO$U~~2[O#i~~2_RO#S2[#S#T%W#T~2[~2mO#o~~2rQ!U~!_!`2x#r#s2}~2}O!R~~3SO!S~~3XO#q~",tokenizers:[0,1],topRules:{LogQL:[0,32]},specialized:[{term:38,get:(fe,c)=>O(fe)<<1,external:O},{term:38,get:(fe,c)=>x(fe)<<1|1,external:x,extend:!0},{term:38,get:fe=>F[fe]||-1}],tokenPrec:0}),R=1,_=2,oe=3,Te=4,St=5,Ae=6,Ie=7,Ft=8,_e=9,$t=10,Ct=11,Ne=12,We=13,Ke=14,Dt=15,Ve=16,be=17,Xe=18,Se=19,je=20,Fe=21,Bt=22,Mt=23,Ut=24,wt=25,At=26,It=27,Nt=28,Wt=29,Kt=30,Ze=31,Ge=32,ze=33,He=34,ke=35,qe=36,Ye=37,ye=38,Vt=39,Xt=40,yr=41,jt=42,Zt=43,Je=44,et=45,tt=46,rt=47,ve=48,at=49,nt=50,st=51,Gt=52,it=53,le=54,zt=55,$e=56,ot=57,lt=58,ct=59,Ht=60,kt=61,qt=62,Yt=63,I=64,Pe=65,Ee=66,Jt=67,er=68,tr=69,Oe=70,ut=71,dt=72,ge=73,Ce=74,mt=75,pt=76,ft=77,Le=78,rr=79,Ot=80,ar=81,he=82,gt=83,ht=84,nr=85,ue=86,sr=87,ir=88,vt=89,or=90,lr=91,cr=92,bt=93,yt=94,ur=95,Pt=96,Et=97,dr=98,mr=99,pr=100,Lt=101,De=102,xt=103,Qt=104,Rt=105,fr=106,Or=107,gr=108,xe=109,Tt=110,Be=111,_t=112,hr=113,Qe=114,Me=115,vr=116,Ue=117,we=118,br=119}}]);

//# sourceMappingURL=794.a64353f276e28b3490d0.js.map