"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1477],{55887:(O,m,n)=>{n.d(m,{e:()=>e});var e=(c=>(c.OpenSource="Open Source",c.Pro="Pro",c.Enterprise="Enterprise",c))(e||{})},77632:(O,m,n)=>{n.d(m,{H:()=>oe});var e=n(68404),c=n(94929),p=n(86647),v=n(2555),f=n(81168),s=n(25e3),i=n(52423),g=n(68183),x=n(81764),P=n(46967),T=n(8944),F=n(72648),N=n(19985);function V({dataSourceName:t,isDefault:a,onDefaultChange:r,onNameChange:o,alertingSupported:l,disabled:u}){return e.createElement(e.Fragment,null,e.createElement(z,{enabled:l}),e.createElement("div",{className:"gf-form-group","aria-label":"Datasource settings page basic settings"},e.createElement("div",{className:"gf-form-inline"},e.createElement("div",{className:"gf-form max-width-30"},e.createElement(x._,{label:"Name",tooltip:`The name is used when you select the data source in panels. The default data source is
              'preselected in new panels.`,grow:!0,disabled:u},e.createElement(P.I,{id:"basic-settings-name",type:"text",value:t,placeholder:"Name",onChange:d=>o(d.currentTarget.value),required:!0,"aria-label":g.wl.pages.DataSource.name}))),e.createElement(x._,{label:"Default",labelWidth:8,disabled:u},e.createElement(T.x,{id:"basic-settings-default",value:a,onChange:d=>{r(d.currentTarget.checked)}})))))}function z({enabled:t}){const a=(0,F.wW)(w);return e.createElement("div",{className:a.badge},t?e.createElement(N.C,{color:"green",icon:"check-circle",text:"Alerting supported"}):e.createElement(N.C,{color:"orange",icon:"exclamation-triangle",text:"Alerting not supported"}))}const w=t=>({badge:i.css`
    margin-bottom: ${t.spacing(2)};
  `});var E=n(31403),Y=n(77582);function $({canSave:t,canDelete:a,onDelete:r,onSubmit:o,onTest:l,exploreUrl:u}){const d=Y.Vt.hasPermission(f.AccessControlAction.DataSourcesExplore);return e.createElement("div",{className:"gf-form-button-row"},e.createElement(E.zx,{variant:"secondary",fill:"solid",type:"button",onClick:()=>history.back()},"Back"),e.createElement(E.Qj,{variant:"secondary",fill:"solid",href:u,disabled:!d},"Explore"),e.createElement(E.zx,{type:"button",variant:"destructive",disabled:!a,onClick:r,"aria-label":g.wl.pages.DataSource.delete},"Delete"),t&&e.createElement(E.zx,{type:"submit",variant:"primary",disabled:!t,onClick:D=>o(D),"aria-label":g.wl.pages.DataSource.saveAndTest},"Save & test"),!t&&e.createElement(E.zx,{variant:"primary",onClick:l},"Test"))}var j=n(55887),S=n(45253),G=n(59796),H=n(47694);const Q="datasources.settings.cloudInfoBox.isDismissed";function X({dataSource:t}){let a="",r="";if(t.readOnly||(t.version??0)>2||H.vc.buildInfo.edition!==j.e.OpenSource)return null;switch(t.type){case"prometheus":a="Prometheus",r="Loki";break;case"loki":a="Loki",r="Prometheus";break;default:return null}return e.createElement(G.G,{storageKey:Q,defaultValue:!1},(o,l)=>o?null:e.createElement(S.b,{title:`Configure your ${a} data source below`,severity:"info",bottomSpacing:4,onRemove:()=>{l(!0)}},"Or skip the effort and get ",a," (and ",r,") as fully-managed, scalable, and hosted data sources from Grafana Labs with the"," ",e.createElement("a",{className:"external-link",href:`https://grafana.com/signup/cloud/connect-account?src=grafana-oss&cnt=${t.type}-settings`,target:"_blank",rel:"noreferrer",title:"The free plan includes 10k active metrics and 50gb storage."},"free-forever Grafana Cloud plan"),"."))}const Z="This data source was added by config and cannot be modified using the UI. Please contact your server admin to update this data source.";function U(){return e.createElement(S.b,{"aria-label":g.wl.pages.DataSource.readOnly,severity:"info",title:"Provisioned data source"},Z)}function k({dataSourceRights:t,onDelete:a}){const{readOnly:r,hasDeleteRights:o}=t,l=!r&&o,u=()=>history.back();return e.createElement(e.Fragment,null,r&&e.createElement(U,null),e.createElement("div",{className:"gf-form-button-row"},l&&e.createElement(E.zx,{type:"submit",variant:"destructive",onClick:a},"Delete"),e.createElement(E.zx,{variant:"secondary",fill:"outline",type:"button",onClick:u},"Back")))}const J="You are not allowed to modify this data source. Please contact your server admin to update this data source.";function q(){return e.createElement(S.b,{severity:"info",title:"Missing rights"},J)}function _({plugin:t,pageId:a}){if(!t||!t.configPages)return null;const r=t.configPages.find(({id:o})=>o===a);return r?e.createElement(r.body,{plugin:t,query:{}}):e.createElement("div",null,"Page not found: ",r)}var W=n(82897),ee=n(11484);class te extends e.PureComponent{constructor(a){super(a),this.element=null,this.onModelChanged=r=>{this.props.onModelChange(r)},this.scopeProps={ctrl:{datasourceMeta:a.dataSourceMeta,current:(0,W.cloneDeep)(a.dataSource)},onModelChanged:this.onModelChanged},this.onModelChanged=this.onModelChanged.bind(this)}componentDidMount(){const{plugin:a}=this.props;if(this.element&&!a.components.ConfigEditor){const r=(0,ee.w)(),o='<plugin-component type="datasource-config-ctrl" />';this.component=r.load(this.element,this.scopeProps,o)}}componentDidUpdate(a){const{plugin:r}=this.props;!r.components.ConfigEditor&&this.props.dataSource!==a.dataSource&&(this.scopeProps.ctrl.current=(0,W.cloneDeep)(this.props.dataSource),this.component?.digest())}componentWillUnmount(){this.component&&this.component.destroy()}render(){const{plugin:a,dataSource:r}=this.props;return a?e.createElement("div",{ref:o=>this.element=o},a.components.ConfigEditor&&e.createElement(a.components.ConfigEditor,{options:r,onOptionsChange:this.onModelChanged})):null}}var ae=n(81731);function ne({state:t}){return e.createElement("div",{className:"gf-form"},e.createElement("div",{className:"gf-form-label width-10"},"Plugin state"),e.createElement("div",{className:"gf-form-label gf-form-label--transparent"},e.createElement(ae.u,{state:t})))}function re({testingStatus:t}){const a=t?.status==="error",r=t?.message,o=t?.details?.message,l=t?.details?.verboseMessage;return r?e.createElement("div",{className:"gf-form-group p-t-2"},e.createElement(S.b,{severity:a?"error":"success",title:r,"aria-label":g.wl.pages.DataSource.alert},t?.details&&e.createElement(e.Fragment,null,o,l?e.createElement("details",{style:{whiteSpace:"pre-wrap"}},l):null))):null}function oe({uid:t,pageId:a}){(0,s.E)(t);const r=(0,f.useDispatch)(),o=(0,s.wl)(t),l=(0,s.Qs)(o.type),u=(0,s._l)(),d=(0,s.YY)(t),D=(0,s.Rz)(t),B=(0,s.q6)(),A=(0,s.hw)(t),b=(0,s.qj)(),I=h=>r((0,s.yr)(h)),y=h=>r((0,s.BX)(h)),R=h=>r((0,s.rl)(h));return e.createElement(se,{pageId:a,dataSource:o,dataSourceMeta:l,dataSourceSettings:u,dataSourceRights:d,exploreUrl:D,onDelete:B,onDefaultChange:I,onNameChange:y,onOptionsChange:R,onTest:A,onUpdate:b})}function se({pageId:t,dataSource:a,dataSourceMeta:r,dataSourceSettings:o,dataSourceRights:l,exploreUrl:u,onDelete:d,onDefaultChange:D,onNameChange:B,onOptionsChange:A,onTest:b,onUpdate:I}){const{plugin:y,loadError:R,testingStatus:h,loading:le}=o,{readOnly:M,hasWriteRights:L,hasDeleteRights:ce}=l,ie=a.id>0,C=(0,p.F)()?.getInstanceSettings(a.uid),ue=Boolean(C?.meta?.alerting??!1),de=C?.type==="alertmanager",me=ue||de,K=async ge=>{ge.preventDefault(),await I({...a}),b()};return R?e.createElement(k,{dataSourceRights:l,onDelete:d}):le?e.createElement(v.Z,null):!ie||!C?null:t?e.createElement(c.n,{instanceSettings:C},e.createElement(_,{pageId:t,plugin:y})):e.createElement("form",{onSubmit:K},!L&&e.createElement(q,null),M&&e.createElement(U,null),r.state&&e.createElement(ne,{state:r.state}),e.createElement(X,{dataSource:a}),e.createElement(V,{dataSourceName:a.name,isDefault:a.isDefault,onDefaultChange:D,onNameChange:B,alertingSupported:me,disabled:M||!L}),y&&e.createElement(c.n,{instanceSettings:C},e.createElement(te,{plugin:y,dataSource:a,dataSourceMeta:r,onModelChange:A})),e.createElement(re,{testingStatus:h}),e.createElement($,{onSubmit:K,onDelete:d,onTest:b,exploreUrl:u,canSave:!M&&L,canDelete:!M&&ce}))}},72443:(O,m,n)=>{n.r(m),n.d(m,{EditDataSourcePage:()=>f,default:()=>s});var e=n(68404),c=n(79396),p=n(77632),v=n(25e3);function f(i){const g=i.match.params.uid,P=new URLSearchParams(i.location.search).get("page"),T=(0,v.MF)(g,P);return e.createElement(c.T,{navId:"datasources",pageNav:T.main},e.createElement(c.T.Contents,null,e.createElement(p.H,{uid:g,pageId:P})))}const s=f},81731:(O,m,n)=>{n.d(m,{u:()=>v});var e=n(68404),c=n(24699),p=n(19985);const v=s=>{const i=f(s.state);return i?e.createElement(p.C,{color:i.color,title:i.tooltip,text:i.text,icon:i.icon}):null};function f(s){switch(s){case c.BV.deprecated:return{text:"Deprecated",color:"red",tooltip:"This feature is deprecated and will be removed in a future release"};case c.BV.alpha:return{text:"Alpha",color:"blue",tooltip:"This feature is experimental and future updates might not be backward compatible"};case c.BV.beta:return{text:"Beta",color:"blue",tooltip:"This feature is close to complete but not fully tested"};default:return null}}}}]);

//# sourceMappingURL=EditDataSourcePage.4d142bff550681bd3657.js.map